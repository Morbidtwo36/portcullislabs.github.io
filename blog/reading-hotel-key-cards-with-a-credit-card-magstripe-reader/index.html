<!DOCTYPE html>
<html lang="en-US" xmlns:fb="https://www.facebook.com/2008/fbml" xmlns:addthis="https://www.addthis.com/help/api-spec"  prefix="og: http://ogp.me/ns#">
<head>
<meta charset="UTF-8" />
<title>Reading hotel key cards with a credit card magstripe reader | Portcullis Labs</title>
<meta name="viewport" content="initial-scale = 1.0, maximum-scale = 1.0, user-scalable = no, width = device-width">
<!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

<link rel="stylesheet" href="https://labs.portcullis.co.uk/wp-content/themes/Portcullisfinal/style.css" media="screen" />


<!-- This site is optimized with the Yoast WordPress SEO plugin v1.4.7 - http://yoast.com/wordpress/seo/ -->
<link rel="canonical" href="https://labs.portcullis.co.uk/blog/reading-hotel-key-cards-with-a-credit-card-magstripe-reader/" />
<meta property='og:locale' content='en_US'/>
<meta property='og:type' content='article'/>
<meta property='og:title' content='Reading hotel key cards with a credit card magstripe reader - Portcullis Labs'/>
<meta property='og:url' content='https://labs.portcullis.co.uk/blog/reading-hotel-key-cards-with-a-credit-card-magstripe-reader/'/>
<meta property='og:site_name' content='Portcullis Labs'/>
<meta property='og:image' content='https://labs.portcullis.co.uk/wp-content/uploads/2018/04/myreader1-300x254.png'/>
<meta property='og:image' content='https://labs.portcullis.co.uk/wp-content/uploads/2018/04/readhead-300x160.png'/>
<meta property='og:image' content='https://labs.portcullis.co.uk/wp-content/uploads/2018/04/readheadback-300x149.png'/>
<meta property='og:image' content='https://labs.portcullis.co.uk/wp-content/uploads/2018/04/readheadsoldered-300x178.png'/>
<meta property='og:image' content='https://labs.portcullis.co.uk/wp-content/uploads/2018/04/chips1-300x105.png'/>
<meta property='og:image' content='https://labs.portcullis.co.uk/wp-content/uploads/2018/04/chips2-300x123.jpg'/>
<meta property='og:image' content='https://labs.portcullis.co.uk/wp-content/uploads/2018/04/square-300x69.png'/>
<meta property='og:image' content='https://labs.portcullis.co.uk/wp-content/uploads/2018/04/10-300x147.png'/>
<meta property='og:image' content='https://labs.portcullis.co.uk/wp-content/uploads/2018/04/csv-277x300.png'/>
<meta property='og:image' content='https://labs.portcullis.co.uk/wp-content/uploads/2018/04/example-graph-300x218.png'/>
<!-- / Yoast WordPress SEO plugin. -->

<link rel="alternate" type="application/rss+xml" title="Portcullis Labs &raquo; Feed" href="https://labs.portcullis.co.uk/feed/" />
<link rel='stylesheet' id='TheStyleSheets-css'  href='https://labs.portcullis.co.uk/wp-content/plugins/asm-brush/style.css?ver=3.8.5' type='text/css' media='all' />
<link rel='stylesheet' id='wpfb-css'  href='//labs.portcullis.co.uk/wp-content/plugins/wp-filebase/wp-filebase.css?t=1475825177&#038;ver=3.4.4' type='text/css' media='all' />
<link rel='stylesheet' id='contact-form-7-css'  href='https://labs.portcullis.co.uk/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=3.3.2' type='text/css' media='all' />
<link rel='stylesheet' id='css3lightbox_style-css'  href='https://labs.portcullis.co.uk/wp-content/plugins/css3lightbox/assets/style.css?ver=3.8.5' type='text/css' media='all' />
<link rel='stylesheet' id='addthis_all_pages-css'  href='https://labs.portcullis.co.uk/wp-content/plugins/addthis/frontend/build/addthis_wordpress_public.min.css?ver=3.8.5' type='text/css' media='all' />
<!--[if lte IE 7]>
<link rel='stylesheet' id='style.ie7.css-css'  href='https://labs.portcullis.co.uk/wp-content/themes/Portcullisfinal/style.ie7.css?ver=3.8.5' type='text/css' media='screen' />
<![endif]-->
<link rel='stylesheet' id='style.responsive.css-css'  href='https://labs.portcullis.co.uk/wp-content/themes/Portcullisfinal/style.responsive.css?ver=3.8.5' type='text/css' media='all' />
<script type='text/javascript' src='https://labs.portcullis.co.uk/wp-content/themes/Portcullisfinal/jquery.js?ver=3.8.5'></script>
<script type='text/javascript' src='https://labs.portcullis.co.uk/wp-content/themes/Portcullisfinal/script.js?ver=3.8.5'></script>
<script type='text/javascript' src='https://labs.portcullis.co.uk/wp-content/themes/Portcullisfinal/script.responsive.js?ver=3.8.5'></script>

 

<link rel="shortcut icon" href="https://labs.portcullis.co.uk/wp-content/themes/Portcullisfinal/favicon.ico" /><link rel='header_link' href='/' /><style type="text/css" id="syntaxhighlighteranchor"></style>
<script data-cfasync="false" type="text/javascript">if (window.addthis_product === undefined) { window.addthis_product = "wpp"; } if (window.wp_product_version === undefined) { window.wp_product_version = "wpp-6.1.4"; } if (window.wp_blog_version === undefined) { window.wp_blog_version = "3.8.5"; } if (window.addthis_share === undefined) { window.addthis_share = {}; } if (window.addthis_config === undefined) { window.addthis_config = {"data_track_clickback":false,"ignore_server_config":true,"ui_atversion":300}; } if (window.addthis_layers === undefined) { window.addthis_layers = {}; } if (window.addthis_layers_tools === undefined) { window.addthis_layers_tools = []; } else {  } if (window.addthis_plugin_info === undefined) { window.addthis_plugin_info = {"info_status":"enabled","cms_name":"WordPress","plugin_name":"Share Buttons by AddThis","plugin_version":"6.1.4","plugin_mode":"WordPress","anonymous_profile_id":"wp-3219ffbb80dfd9f649eb0d9d76c4d2e4","page_info":{"template":"posts","post_type":""},"sharing_enabled_on_post_via_metabox":false}; } 
                    (function() {
                      var first_load_interval_id = setInterval(function () {
                        if (typeof window.addthis !== 'undefined') {
                          window.clearInterval(first_load_interval_id);
                          if (typeof window.addthis_layers !== 'undefined' && Object.getOwnPropertyNames(window.addthis_layers).length > 0) {
                            window.addthis.layers(window.addthis_layers);
                          }
                          if (Array.isArray(window.addthis_layers_tools)) {
                            for (i = 0; i < window.addthis_layers_tools.length; i++) {
                              window.addthis.layers(window.addthis_layers_tools[i]);
                            }
                          }
                        }
                     },1000)
                    }());
                </script> <script data-cfasync="false" type="text/javascript"src="https://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-50cef03053621092" async="async"></script><meta name="norton-safeweb-site-verification" content="t4bvmzb47z4-fa69d4guwu4ud9-4fjyp-p5zu1zngnplt83xrfxxg18yea8ev95lh9h4vlzkclbcvyu37rz5etuoczh7z3827pjv3s73uannz0xkwzfw2iiu4ol7o83f" />
</head>
<body class="single single-post postid-6481 single-format-standard">

<div id="portcullis-main">


<!-- Cisco -->
<div id="cisco">
    <div id="cisco-container" class="clearfix">
        <div class="left">
            <a href="http://www.cisco.com/" target="_blank"><img class="cisco-logo" src="https://labs.portcullis.co.uk/wp-content/themes/Portcullisfinal/images/portcullis_cisco_logo.png" alt=""></a>
            <a href="http://www.cisco.com/web/about/ac49/ac0/ac1/ac259/portcullis.html" class="learnmore">Learn More <img src="https://labs.portcullis.co.uk/wp-content/themes/Portcullisfinal/images/more-triangle.png" alt=""></a>
        </div>
        <div class="right">
            <div class="move-right"><a href="http://www.cisco.com/web/about/index.html" target="_blank" class="move-right">About Cisco</a></div>
        </div>
    </div>
</div>
<!-- /#cisco -->

<header class="clearfix portcullis-header clickable">


    <div class="portcullis-shapes">
		<div class="portcullis-headline" data-left="14.6%">
    <a href="https://labs.portcullis.co.uk/">Portcullis Labs</a>
</div>
		<div class="portcullis-slogan" data-left="16.4%">Research and Development</div>
<div class="logo"><a href="https://www.portcullis-security.com"><img style="border:none;" src="/wp-content/themes/Portcullisfinal/images/logo.png" /></a></div>

<div class="portcullis-textblock portcullis-object1741532833" data-left="92.34%">
    
</div><div class="portcullis-textblock portcullis-object1269462037" data-left="97.93%">
    
</div>
            </div>

<nav class="portcullis-nav clearfix">
    
<ul class="portcullis-hmenu">
	<li class="menu-item-268"><a href="https://labs.portcullis.co.uk" title="Home">Home</a>
	</li>
	<li class="menu-item-6568"><a href="https://labs.portcullis.co.uk/advisories/" title="Advisories">Advisories</a>
	</li>
	<li class="menu-item-83"><a href="https://labs.portcullis.co.uk/blog/" title="Blog">Blog</a>
	</li>
	<li class="menu-item-66"><a href="https://labs.portcullis.co.uk/presentations/" title="Presentations">Presentations</a>
	</li>
	<li class="menu-item-62"><a href="https://labs.portcullis.co.uk/tools/" title="Tools">Tools</a>
	</li>
	<li class="menu-item-64"><a href="https://labs.portcullis.co.uk/whitepapers/" title="Whitepapers">Whitepapers</a>
	</li>
	<li class="menu-item-59"><a href="https://labs.portcullis.co.uk/downloads/" title="Downloads">Downloads</a>
	</li>
</ul>
 
    </nav>

                    
</header>

<div class="portcullis-sheet clearfix">
            <div class="portcullis-layout-wrapper clearfix">
                <div class="portcullis-content-layout">
                    <div class="portcullis-content-layout-row">
                        <div class="portcullis-layout-cell portcullis-content clearfix">
							<article id="post-6481"  class="portcullis-post portcullis-article  post-6481 post type-post status-publish format-standard hentry category-blog tag-hardhack tag-training">
                                <div class="portcullis-postmetadataheader"><h1 class="portcullis-postheader">Reading hotel key cards with a credit card magstripe reader</h1></div>                                                <div class="portcullis-postheadericons portcullis-metadata-icons"><span class="portcullis-postdateicon"><span class="date">Published</span> <span class="entry-date" title="07:01">04/07/2018</span></span> | <span class="portcullis-postauthoricon"><span class="author">By</span> <span class="author vcard"><a class="url fn n" href="https://labs.portcullis.co.uk/author/mrl/" title="View all posts by MRL">MRL</a></span></span></div>                <div class="portcullis-postcontent clearfix"><div class="at-above-post addthis_tool" data-url="https://labs.portcullis.co.uk/blog/reading-hotel-key-cards-with-a-credit-card-magstripe-reader/"></div><!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style "><a class="addthis_button_email"><a class="addthis_button_twitter"></a><a class="addthis_button_reddit"></a></a>
</div><p>In this post I describe how my cheap magstripe reader wouldn&#8217;t read all magstripes, only credit/debit cards. This did nothing to help me understand what data was on my hotel key card &#8211; which is what I really wanted to know. Rather than take the obvious next step or buying a better reader, I opted to open up the cheap magstripe reader, probed around a bit and found a way to read the raw data off the hotel magstripes. What that data means remains a mystery so there may be a part 2 at some stage.<span id="more-6481"></span></p>
<h2>About my magstripe reader</h2>
<p>I bought the following reader for £11.85 in 2017:</p>
<div id="attachment_6519" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6482"><div class="lb-album"><a href="#image-6482"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/myreader1-300x254.png" alt="Cheap reader from eBay" class="size-medium wp-image-6519"><span></span></a></div>              
<a href="#imageclose-6482" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6482">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/myreader1.png" alt="image-6482">
                   </div></a><p class="wp-caption-text">Cheap reader from eBay</p></div>
<p>It connects via USB and is detected as a keyboard. If you swipe a credit/debit card through the reader, the corresponding data from the magstripe will appear if your text editor as if it had been typed. If you don&#8217;t have a text editor open at the time, you&#8217;ll get the effect of whatever the keystrokes on the magstripe reader are!</p>
<p>It works fine under both Windows and Linux. But only for credit/debit cards. When I swiped a hotel key card through, I got no data at all.</p>
<h2>Why not just get a different reader?</h2>
<p>I could have taken a couple of different (and no doubt better) approaches to this project. Finding a better magstripe reader was one option. Googling around to better understand hotel magstripes would have no-doubt been fruitful, but potentially spoils some of problem solving. I can always google later when I&#8217;m properly stuck. <img src="https://labs.portcullis.co.uk/wp-includes/images/smilies/icon_smile.gif" alt=":-)" class="wp-smiley" /> </p>
<p>I since invested in an MSR605X reader/writer. I haven&#8217;t played with it much yet, but it is able to do raw reads. I&#8217;ll probably cover this reader in a future post.</p>
<h2>Plan for the cheap reader</h2>
<p>I figured that the magnetic read head in the cheap reader would almost certainly be able to read the data from from hotel cards or any other card with a magstripe. But the rest of the reader was only able to interpret payment card data. If I could probe the electrical signals in the right place within the reader, I should be able to see the 1&#8242;s and 0&#8242;s on the magstripe.</p>
<div id="attachment_6520" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6483"><div class="lb-album"><a href="#image-6483"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/readhead-300x160.png" alt="Magnetic read head inside card reader" class="size-medium wp-image-6520"><span></span></a></div>              
<a href="#imageclose-6483" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6483">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/readhead.png" alt="image-6483">
                   </div></a><p class="wp-caption-text">Magnetic read head inside card reader</p></div>
<p>I was a vague plan and certainly not the path of least resistance, but would ultimately work&#8230;</p>
<h2>Probing around</h2>
<p>I had two tools at my disposal to probe with (this was a home-based side project as opposed to an office-based project):</p>
<ul>
<li>A cheap handheld Oscilloscope (Sainsmart DS202)</li>
<li>A Saleae logic analyzer</li>
</ul>
<p>I quickly realized there were 7 points on the read head I could attach probes to.</p>
<div id="attachment_6521" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6484"><div class="lb-album"><a href="#image-6484"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/readheadback-300x149.png" alt="Connection points on back of read head" class="size-medium wp-image-6521"><span></span></a></div>              
<a href="#imageclose-6484" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6484">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/readheadback.png" alt="image-6484">
                   </div></a><p class="wp-caption-text">Connection points on back of read head</p></div>
<p>I figured if hooked the read head directly up to my scope, I&#8217;d be able to see an analogue signal when I swiped a card. Ultimately I hoped to do something with said signal to get the data I wanted.</p>
<div id="attachment_6522" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6485"><div class="lb-album"><a href="#image-6485"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/readheadsoldered-300x178.png" alt="Connections for scope soldered directly to read head" class="size-medium wp-image-6522"><span></span></a></div>              
<a href="#imageclose-6485" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6485">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/readheadsoldered.png" alt="image-6485">
                   </div></a><p class="wp-caption-text">Connections for scope soldered directly to read head</p></div>
<p>I tried hooking up various pairs from these 7 probe points to my scope, but didn&#8217;t find any signal at all. Maybe the signal&#8217;s too weak, or maybe (in retrospect) I did a rubbish job of identifying a suitable ground.</p>
<p>By this point I&#8217;d started googling the chip numbers. There were 2 x Op Amps and 1 x Analogue Comparator:</p>
<ul>
<li>2 x <a title="LM2902DG" href="https://www.mouser.co.uk/ProductDetail/ON-Semiconductor/LM2902DG">LM2902DG</a> (Op Amp)</li>
<li>1 x <a title="LM2901DG" href="https://www.mouser.co.uk/ProductDetail/ON-Semiconductor/LM2901DG">LM2901DG</a> (Analogue Comparator)</li>
</ul>
<div id="attachment_6523" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6486"><div class="lb-album"><a href="#image-6486"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/chips1-300x105.png" alt="2 x Op Amps" class="size-medium wp-image-6523"><span></span></a></div>              
<a href="#imageclose-6486" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6486">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/chips1.png" alt="image-6486">
                   </div></a><p class="wp-caption-text">2 x Op Amps</p></div>
<div id="attachment_6524" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6487"><div class="lb-album"><a href="#image-6487"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/chips2-300x123.jpg" alt="Analogue Comparator (left); STM32 Microcontroller (right)" class="size-medium wp-image-6524"><span></span></a></div>              
<a href="#imageclose-6487" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6487">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/chips2.jpg" alt="image-6487">
                   </div></a><p class="wp-caption-text">Analogue Comparator (left); STM32 Microcontroller (right)</p></div>
<p>These chips were responsible for amplifying the signal from the read head. So if hooked up to the output of each, I might see a signal I could use to determine the data on the magstripes. I use the datasheets to identify the output pins of each IC.</p>
<p>The output from the 2 x Op Amps was about 0.5 &#8211; 0.6v peak-to-peak. Easily viewable using my scope, but I&#8217;d be unable to feed this into my logic analyser. I&#8217;d need about 3v peak-to-peak for that. The signal was also quite scruffy looking. Not the nice square wave I&#8217;d hoped for.</p>
<p>The output from the analogue comparator was exactly what I was after. A nice 3 or 4v peak-to-peak square wave that appeared only when I swiped a card. There were 4 outputs from the comparator. One never produced a signal. This seemed reasonable for a read head that could read 3-track magstripes. Time to feed this into the logic analyser and start figuring what constituted a 0 or 1&#8230;</p>
<h2>1&#8242;s and 0&#8242;s</h2>
<p>Progress had been quite fast up to this point. This was shaping up to be an interesting project.</p>
<p>Here&#8217;s the output from the comparator viewed in the Saleae Logic software:</p>
<div id="attachment_6525" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6488"><div class="lb-album"><a href="#image-6488"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/square-300x69.png" alt="Comparator output viewed via logic analyser" class="size-medium wp-image-6525"><span></span></a></div>              
<a href="#imageclose-6488" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6488">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/square.png" alt="image-6488">
                   </div></a><p class="wp-caption-text">Comparator output viewed via logic analyser</p></div>
<p>Note that we&#8217;re only seeing 1 square wave, not 3. This is because this particular card only has data on 1 of the 3 tracks.</p>
<p>So we have a signal to analyse, but we don&#8217;t have 1&#8242;s and 0&#8242;s yet.</p>
<p><a title="Phrack37" http://phrack.org/issues/37/6.html#article">Phrack37</a> from 1992 helps us with that:</p>
<div id="attachment_6527" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6489"><div class="lb-album"><a href="#image-6489"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/10-300x147.png" alt="ASCII art explanation of how 1' class="size-medium wp-image-6527"><span></span></a></div>              
<a href="#imageclose-6489" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6489">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/10.png" alt="image-6489">
                   </div></a><p class="wp-caption-text">ASCII art explanation of how 1&#8242;s and 0&#8242;s are encoded on a magstripe</p></div>
<p>Essentially a 0 and 1 are both the same length when encoded. A 1 changed state half way through and a 0 doesn&#8217;t. Note that the 0 can be either high or low.</p>
<p>Rather than decode the 1&#8242;s and 0&#8242;s by eye, I wrote a Python script that parsed the exported data from the logic analyzer and dumped the 1&#8242;s and o&#8217;s. Here&#8217;s the format used by &#8220;Logic&#8221; (the Saleae software) when exporting to CSV:</p>
<div id="attachment_6528" style="width: 287px" class="wp-caption alignnone"><a name="imageclose-6490"><div class="lb-album"><a href="#image-6490"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/csv-277x300.png" alt="Format used in CSV export from Saleae' class="size-medium wp-image-6528"><span></span></a></div>              
<a href="#imageclose-6490" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6490">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/csv.png" alt="image-6490">
                   </div></a><p class="wp-caption-text">Format used in CSV export from Saleae&#8217;s Logic software</p></div>
<p>The Python code turned out to be a pain to write because the baud rate of the data wasn&#8217;t constant. It varies depending on how fast the card is moving past the read head. I took a few wrong turns when coding this up, but eventually found a solution that worked.</p>
<p>Here&#8217;s a scatter graph that shows that the duration of square wave pulse doesn&#8217;t have exactly 2 values as expected. Instead a wide range of values are seen. It&#8217;s still possible to tell 0&#8242;s (long pulses, green dots) from 1&#8242;s (short pulses, blue/purple dots) &#8211; see top graph. The ratio of each successive pulse to the last was a better way to tell o&#8217;s from 1&#8242;s &#8211; see bottom graph:</p>
<div id="attachment_6530" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6491"><div class="lb-album"><a href="#image-6491"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/example-graph-300x218.png" alt="Graph showing how much pulse duration (delta) takes a range of values, not just two as expected" class="size-medium wp-image-6530"><span></span></a></div>              
<a href="#imageclose-6491" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6491">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/example-graph.png" alt="image-6491">
                   </div></a><p class="wp-caption-text">Graph showing how much pulse duration (delta) takes a range of values, not just two as expected</p></div>
<h2>And finally, the bytes / characters</h2>
<p>This is where my problems started. My whole life, bits have made bytes. Specifically they&#8217;ve made 8-bit bytes. This is not the case on magstripes, it turned out.</p>
<p>As mentioned in the phrack paper, credit cards use 2 tracks, one where characters are composed of 5 bits (4 bits + 1 parity) and another where characters are composed of 7 bits (6 bits + 1 parity).</p>
<p>I spent quite a bit of time coding up a decoder for credit cards. Partly because I needed to be assured that I&#8217;d read the 1&#8242;s and o&#8217;s correctly and partly because I thought I&#8217;d need the code to see if the same character types were used in hotel cards.</p>
<p>One of the challenges in coding this up was knowing where the data started and the preamble ended. It seems that &#8220;sentinels&#8221; are used to mark the start/end of the data. These are special characters (bit patterns) that readers can look for at the start and end of a stripe&#8230; then it made sense. This is why the card reader only worked for credit cards!  The firmware is looking for the sentinels used by credit cards. It can&#8217;t decode the hotel cards because it&#8217;s not obvious where the data starts or ends; or what constitutes a character. Also, perhaps lack a valid <a title="Longitudinal Redundancy Check (LRC)" href="https://en.wikipedia.org/wiki/Longitudinal_redundancy_check">Longitudinal Redundancy Check (LRC)</a>.</p>
<h2>Identifying characters on hotel magstripes</h2>
<p>I ran my credit-card code over the hotel mag stripes to see if there was odd parity with all the 5 bit chunks or all the 7 bit chunks. No, unfortunately not. Another reason the cheap magstripe reader probably failed.</p>
<p>Then I ran some frequency analysis on the 1&#8242;s and 0&#8242;s. Maybe a lot of the 5-bit chunks are all the same value?  Or the 7-bit chunks?  I&#8217;d see something similar on the credit card magstripe. There were 20 spaces on the 7-bit magstripe. So, using frequency analysis, I should have been able to guess 7-bit characters were being used.</p>
<p>By splitting some of the hotels magstripe data into 8-bit chunks, we notice that the same string of 1&#8242;s and 0&#8242;s occurs many more times than you&#8217;d expect. So my best guess is that 8-bit characters are used.</p>
<p>Below is some example output from my Python script. Not that it outputs:</p>
<ul>
<li>Raw bits</li>
<li>Strings (with hex dumps) that would be right if 5-bit, 6-bit, 7-bit or 8-bit characters were used. Though &#8220;correctness&#8221; depends on parity, bit order and what character set the bit values map to. Plenty of room for error and improvement here</li>
<li>Checks for odd/even parity within characters</li>
<li>Frequency analysis looking for common characters &#8211; for varying character lengths</li>
</ul>
<pre class="brush: bash; gutter: false; title: ; notranslate" title="">
[+] Parsing file export.csv
 [-] Flips in channel 0: 3
 [-] Flips in channel 1: 1652
 [-] Flips in channel 2: 3
[+] Analysing swipes
 [-] Channel 0:
 [-] Channel 1:
 [-] Swipe 0: 693 bits
 [-] Swipe 1: 701 bits
 [-] Channel 2:
[+] Creating Plots
 [-] creating plots with dimensions (1637, 1637), (1637, 1637)
 [-] saving plot to file: export.csv-plot-channel-1.png
----------------------- CHANNEL 1 SWIPE 0 -----------------------
[+] Length (bits) = 266 (%5 = 1, %6 = 2, %7 = 0, % 8= 2)
[+] Data: 10100110001001100010011000100110001001100010011000100110001001100010011000100110001001100101011011100110101001001101100110100110001001100111110110111100111101100010000000100110011001101100001010010101001001001110110100000111001101011101100001100101101000101010011001
[+] Strings:
 [-] 5 bit: 5398621&lt;4398621&lt;43:&gt;62&lt;3539&lt;;&gt;&lt;=409&lt;615549=1&gt;6&gt;36=1:6
 [-] length: 53
 [-] hex: 
 35 33 39 38 36 32 31 3c 34 33 39 38 36 32 31 3c 5398621&lt;4398621&lt;
 34 33 3a 3e 36 32 3c 33 35 33 39 3c 3b 3e 3c 3d 43:&gt;62&lt;3539&lt;;&gt;&lt;=
 34 30 39 3c 36 31 35 35 34 39 3d 31 3e 36 3e 33 409&lt;615549=1&gt;6&gt;3
 36 3d 31 3a 36 6=1:6
[-] 6 bit: E(1C&amp;amp;,9RD(1CFM92;+1S;G;&quot;D,-**DMPLW8M4,
 [-] length: 38
 [-] hex: 
 45 28 31 43 26 2c 39 52 44 28 31 43 46 4d 39 32 E(1C&amp;amp;,9RD(1CFM92
 3b 2b 31 53 3b 47 3b 22 44 2c 2d 2a 2a 44 4d 50 ;+1S;G;&quot;D,-**DMP
 4c 57 38 4d 34 2c LW8M4,
[-] 7 bit: %..#...2$..#&amp;amp;-.....3.'..$....$-0,7.-.
 [-] length: 37
 [-] hex: 
 25 08 11 23 06 0c 19 32 24 08 11 23 26 2d 19 12 %..#...2$..#&amp;amp;-..
 1b 0b 11 33 1b 27 1b 02 24 0c 0d 0a 0a 24 2d 30 ...3.'..$....$-0
 2c 37 18 2d 14 ,7.-.
[-] 8 bit: .&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;V....&amp;amp;}.. &amp;amp;f..$..5.e..@
 [-] length: 34
 [-] hex: 
 a6 26 26 26 26 26 26 26 26 26 26 56 e6 a4 d9 a6 .&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;V....
 26 7d bc f6 20 26 66 c2 95 24 ed 07 35 d8 65 a2 &amp;amp;}.. &amp;amp;f..$..5.e.
 a6 40 .@
[+] Parity for 5 bit chars: odd: False, even: False)
[+] Parity for 6 bit chars: odd: False, even: False)
[+] Parity for 7 bit chars: odd: False, even: False)
[+] Parity for 8 bit chars: odd: False, even: False)
[+] Frequency analysis for potential char lengths:
 [-] 5 bits:
 10011: 5
 11000: 4
 01100: 4
 00110: 4
 00100: 4
 [-] 6 bits:
 100110: 5
 100010: 5
 011000: 5
 011001: 4
 001001: 4
 [-] 7 bits:
 1000100: 3
 0010011: 3
 1101100: 2
 1100010: 2
 1011010: 2
 [-] 8 bits:
 00100110: 12 &lt; common 8-bit patter implies 8-bit chars?
 10100110: 3
...snip...
</pre>
<p>The above data is from an actual hotel card (though the hotel as since switched to using RFID locks).</p>
<p>I also started to look at XORing, rotating of characters (rot13 style), bit order and offsetting the whole stream of bits (in case I started at the wrong place when  chunk the character up). All to no avail as yet.</p>
<p>That&#8217;s as far as I got. I&#8217;ll be sure to post again if I ever decode any of the data on the card. I was hoping to see my room number and checkout date in cleartext. But equally an opaque encrypted string wouldn&#8217;t surprise me either &#8211; which could be what I&#8217;m seeing on at least some of the cards.</p>
<h2>Conclusion</h2>
<p>Doing things the cheap and time-consuming way can be fun &#8211; and a good opportunity to write code, learn about <a title="matplotlib" href="https://matplotlib.org/">matplotlib</a> and dust off the logic analyser.</p>
<h2>Further reading/viewing</h2>
<p>If you want to know more about magstripes (before they become completely obsolete), take a look at:</p>
<ul>
<li><a title="Samy Kamkar's magspoof tool" href="https://samy.pl/magspoof/">Samy Kamkar&#8217;s magspoof tool</a> (<a title="video link" href="https://www.youtube.com/watch?v=UHSFf0Lz1qc">video link</a>) &#8211; could be useful if you need your PC to transmit bad data in through a magnetic read head.</li>
<li><a title="DEF CON 24 - Weston Hecker - Hacking Hotel Keys and Point of Sale Systems" href="https://www.youtube.com/watch?v=mV_0k9Fh590">DEF CON 24 &#8211; Weston Hecker &#8211; Hacking Hotel Keys and Point of Sale Systems</a></li>
</ul>
<p>I was pretty inspired by these projects.In this post I describe how my cheap magstripe reader wouldn&#8217;t read all magstripes, only credit/debit cards. This did nothing to help me understand what data was on my hotel key card &#8211; which is what I really wanted to know. Rather than take the obvious next step or buying a better reader, I opted to open up the cheap magstripe reader, probed around a bit and found a way to read the raw data off the hotel magstripes. What that data means remains a mystery so there may be a part 2 at some stage.<!--more--></p>
<h2>About my magstripe reader</h2>
<p>I bought the following reader for £11.85 in 2017:</p>
<div id="attachment_6519" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6482"><div class="lb-album"><a href="#image-6482"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/myreader1-300x254.png" alt="Cheap reader from eBay" class="size-medium wp-image-6519"><span></span></a></div>              
<a href="#imageclose-6482" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6482">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/myreader1.png" alt="image-6482">
                   </div></a><p class="wp-caption-text">Cheap reader from eBay</p></div>
<p>It connects via USB and is detected as a keyboard. If you swipe a credit/debit card through the reader, the corresponding data from the magstripe will appear if your text editor as if it had been typed. If you don&#8217;t have a text editor open at the time, you&#8217;ll get the effect of whatever the keystrokes on the magstripe reader are!</p>
<p>It works fine under both Windows and Linux. But only for credit/debit cards. When I swiped a hotel key card through, I got no data at all.</p>
<h2>Why not just get a different reader?</h2>
<p>I could have taken a couple of different (and no doubt better) approaches to this project. Finding a better magstripe reader was one option. Googling around to better understand hotel magstripes would have no-doubt been fruitful, but potentially spoils some of problem solving. I can always google later when I&#8217;m properly stuck. <img src="https://labs.portcullis.co.uk/wp-includes/images/smilies/icon_smile.gif" alt=":-)" class="wp-smiley" /> </p>
<p>I since invested in an MSR605X reader/writer. I haven&#8217;t played with it much yet, but it is able to do raw reads. I&#8217;ll probably cover this reader in a future post.</p>
<h2>Plan for the cheap reader</h2>
<p>I figured that the magnetic read head in the cheap reader would almost certainly be able to read the data from from hotel cards or any other card with a magstripe. But the rest of the reader was only able to interpret payment card data. If I could probe the electrical signals in the right place within the reader, I should be able to see the 1&#8242;s and 0&#8242;s on the magstripe.</p>
<div id="attachment_6520" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6483"><div class="lb-album"><a href="#image-6483"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/readhead-300x160.png" alt="Magnetic read head inside card reader" class="size-medium wp-image-6520"><span></span></a></div>              
<a href="#imageclose-6483" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6483">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/readhead.png" alt="image-6483">
                   </div></a><p class="wp-caption-text">Magnetic read head inside card reader</p></div>
<p>I was a vague plan and certainly not the path of least resistance, but would ultimately work&#8230;</p>
<h2>Probing around</h2>
<p>I had two tools at my disposal to probe with (this was a home-based side project as opposed to an office-based project):</p>
<ul>
<li>A cheap handheld Oscilloscope (Sainsmart DS202)</li>
<li>A Saleae logic analyzer</li>
</ul>
<p>I quickly realized there were 7 points on the read head I could attach probes to.</p>
<div id="attachment_6521" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6484"><div class="lb-album"><a href="#image-6484"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/readheadback-300x149.png" alt="Connection points on back of read head" class="size-medium wp-image-6521"><span></span></a></div>              
<a href="#imageclose-6484" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6484">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/readheadback.png" alt="image-6484">
                   </div></a><p class="wp-caption-text">Connection points on back of read head</p></div>
<p>I figured if hooked the read head directly up to my scope, I&#8217;d be able to see an analogue signal when I swiped a card. Ultimately I hoped to do something with said signal to get the data I wanted.</p>
<div id="attachment_6522" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6485"><div class="lb-album"><a href="#image-6485"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/readheadsoldered-300x178.png" alt="Connections for scope soldered directly to read head" class="size-medium wp-image-6522"><span></span></a></div>              
<a href="#imageclose-6485" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6485">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/readheadsoldered.png" alt="image-6485">
                   </div></a><p class="wp-caption-text">Connections for scope soldered directly to read head</p></div>
<p>I tried hooking up various pairs from these 7 probe points to my scope, but didn&#8217;t find any signal at all. Maybe the signal&#8217;s too weak, or maybe (in retrospect) I did a rubbish job of identifying a suitable ground.</p>
<p>By this point I&#8217;d started googling the chip numbers. There were 2 x Op Amps and 1 x Analogue Comparator:</p>
<ul>
<li>2 x <a title="LM2902DG" href="https://www.mouser.co.uk/ProductDetail/ON-Semiconductor/LM2902DG">LM2902DG</a> (Op Amp)</li>
<li>1 x <a title="LM2901DG" href="https://www.mouser.co.uk/ProductDetail/ON-Semiconductor/LM2901DG">LM2901DG</a> (Analogue Comparator)</li>
</ul>
<div id="attachment_6523" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6486"><div class="lb-album"><a href="#image-6486"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/chips1-300x105.png" alt="2 x Op Amps" class="size-medium wp-image-6523"><span></span></a></div>              
<a href="#imageclose-6486" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6486">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/chips1.png" alt="image-6486">
                   </div></a><p class="wp-caption-text">2 x Op Amps</p></div>
<div id="attachment_6524" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6487"><div class="lb-album"><a href="#image-6487"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/chips2-300x123.jpg" alt="Analogue Comparator (left); STM32 Microcontroller (right)" class="size-medium wp-image-6524"><span></span></a></div>              
<a href="#imageclose-6487" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6487">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/chips2.jpg" alt="image-6487">
                   </div></a><p class="wp-caption-text">Analogue Comparator (left); STM32 Microcontroller (right)</p></div>
<p>These chips were responsible for amplifying the signal from the read head. So if hooked up to the output of each, I might see a signal I could use to determine the data on the magstripes. I use the datasheets to identify the output pins of each IC.</p>
<p>The output from the 2 x Op Amps was about 0.5 &#8211; 0.6v peak-to-peak. Easily viewable using my scope, but I&#8217;d be unable to feed this into my logic analyser. I&#8217;d need about 3v peak-to-peak for that. The signal was also quite scruffy looking. Not the nice square wave I&#8217;d hoped for.</p>
<p>The output from the analogue comparator was exactly what I was after. A nice 3 or 4v peak-to-peak square wave that appeared only when I swiped a card. There were 4 outputs from the comparator. One never produced a signal. This seemed reasonable for a read head that could read 3-track magstripes. Time to feed this into the logic analyser and start figuring what constituted a 0 or 1&#8230;</p>
<h2>1&#8242;s and 0&#8242;s</h2>
<p>Progress had been quite fast up to this point. This was shaping up to be an interesting project.</p>
<p>Here&#8217;s the output from the comparator viewed in the Saleae Logic software:</p>
<div id="attachment_6525" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6488"><div class="lb-album"><a href="#image-6488"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/square-300x69.png" alt="Comparator output viewed via logic analyser" class="size-medium wp-image-6525"><span></span></a></div>              
<a href="#imageclose-6488" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6488">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/square.png" alt="image-6488">
                   </div></a><p class="wp-caption-text">Comparator output viewed via logic analyser</p></div>
<p>Note that we&#8217;re only seeing 1 square wave, not 3. This is because this particular card only has data on 1 of the 3 tracks.</p>
<p>So we have a signal to analyse, but we don&#8217;t have 1&#8242;s and 0&#8242;s yet.</p>
<p><a title="Phrack37" http://phrack.org/issues/37/6.html#article">Phrack37</a> from 1992 helps us with that:</p>
<div id="attachment_6527" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6489"><div class="lb-album"><a href="#image-6489"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/10-300x147.png" alt="ASCII art explanation of how 1' class="size-medium wp-image-6527"><span></span></a></div>              
<a href="#imageclose-6489" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6489">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/10.png" alt="image-6489">
                   </div></a><p class="wp-caption-text">ASCII art explanation of how 1&#8242;s and 0&#8242;s are encoded on a magstripe</p></div>
<p>Essentially a 0 and 1 are both the same length when encoded. A 1 changed state half way through and a 0 doesn&#8217;t. Note that the 0 can be either high or low.</p>
<p>Rather than decode the 1&#8242;s and 0&#8242;s by eye, I wrote a Python script that parsed the exported data from the logic analyzer and dumped the 1&#8242;s and o&#8217;s. Here&#8217;s the format used by &#8220;Logic&#8221; (the Saleae software) when exporting to CSV:</p>
<div id="attachment_6528" style="width: 287px" class="wp-caption alignnone"><a name="imageclose-6490"><div class="lb-album"><a href="#image-6490"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/csv-277x300.png" alt="Format used in CSV export from Saleae' class="size-medium wp-image-6528"><span></span></a></div>              
<a href="#imageclose-6490" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6490">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/csv.png" alt="image-6490">
                   </div></a><p class="wp-caption-text">Format used in CSV export from Saleae&#8217;s Logic software</p></div>
<p>The Python code turned out to be a pain to write because the baud rate of the data wasn&#8217;t constant. It varies depending on how fast the card is moving past the read head. I took a few wrong turns when coding this up, but eventually found a solution that worked.</p>
<p>Here&#8217;s a scatter graph that shows that the duration of square wave pulse doesn&#8217;t have exactly 2 values as expected. Instead a wide range of values are seen. It&#8217;s still possible to tell 0&#8242;s (long pulses, green dots) from 1&#8242;s (short pulses, blue/purple dots) &#8211; see top graph. The ratio of each successive pulse to the last was a better way to tell o&#8217;s from 1&#8242;s &#8211; see bottom graph:</p>
<div id="attachment_6530" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-6491"><div class="lb-album"><a href="#image-6491"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/example-graph-300x218.png" alt="Graph showing how much pulse duration (delta) takes a range of values, not just two as expected" class="size-medium wp-image-6530"><span></span></a></div>              
<a href="#imageclose-6491" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6491">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2018/04/example-graph.png" alt="image-6491">
                   </div></a><p class="wp-caption-text">Graph showing how much pulse duration (delta) takes a range of values, not just two as expected</p></div>
<h2>And finally, the bytes / characters</h2>
<p>This is where my problems started. My whole life, bits have made bytes. Specifically they&#8217;ve made 8-bit bytes. This is not the case on magstripes, it turned out.</p>
<p>As mentioned in the phrack paper, credit cards use 2 tracks, one where characters are composed of 5 bits (4 bits + 1 parity) and another where characters are composed of 7 bits (6 bits + 1 parity).</p>
<p>I spent quite a bit of time coding up a decoder for credit cards. Partly because I needed to be assured that I&#8217;d read the 1&#8242;s and o&#8217;s correctly and partly because I thought I&#8217;d need the code to see if the same character types were used in hotel cards.</p>
<p>One of the challenges in coding this up was knowing where the data started and the preamble ended. It seems that &#8220;sentinels&#8221; are used to mark the start/end of the data. These are special characters (bit patterns) that readers can look for at the start and end of a stripe&#8230; then it made sense. This is why the card reader only worked for credit cards!  The firmware is looking for the sentinels used by credit cards. It can&#8217;t decode the hotel cards because it&#8217;s not obvious where the data starts or ends; or what constitutes a character. Also, perhaps lack a valid <a title="Longitudinal Redundancy Check (LRC)" href="https://en.wikipedia.org/wiki/Longitudinal_redundancy_check">Longitudinal Redundancy Check (LRC)</a>.</p>
<h2>Identifying characters on hotel magstripes</h2>
<p>I ran my credit-card code over the hotel mag stripes to see if there was odd parity with all the 5 bit chunks or all the 7 bit chunks. No, unfortunately not. Another reason the cheap magstripe reader probably failed.</p>
<p>Then I ran some frequency analysis on the 1&#8242;s and 0&#8242;s. Maybe a lot of the 5-bit chunks are all the same value?  Or the 7-bit chunks?  I&#8217;d see something similar on the credit card magstripe. There were 20 spaces on the 7-bit magstripe. So, using frequency analysis, I should have been able to guess 7-bit characters were being used.</p>
<p>By splitting some of the hotels magstripe data into 8-bit chunks, we notice that the same string of 1&#8242;s and 0&#8242;s occurs many more times than you&#8217;d expect. So my best guess is that 8-bit characters are used.</p>
<p>Below is some example output from my Python script. Not that it outputs:</p>
<ul>
<li>Raw bits</li>
<li>Strings (with hex dumps) that would be right if 5-bit, 6-bit, 7-bit or 8-bit characters were used. Though &#8220;correctness&#8221; depends on parity, bit order and what character set the bit values map to. Plenty of room for error and improvement here</li>
<li>Checks for odd/even parity within characters</li>
<li>Frequency analysis looking for common characters &#8211; for varying character lengths</li>
</ul>
<pre class="brush: bash; gutter: false; title: ; notranslate" title="">
[+] Parsing file export.csv
 [-] Flips in channel 0: 3
 [-] Flips in channel 1: 1652
 [-] Flips in channel 2: 3
[+] Analysing swipes
 [-] Channel 0:
 [-] Channel 1:
 [-] Swipe 0: 693 bits
 [-] Swipe 1: 701 bits
 [-] Channel 2:
[+] Creating Plots
 [-] creating plots with dimensions (1637, 1637), (1637, 1637)
 [-] saving plot to file: export.csv-plot-channel-1.png
----------------------- CHANNEL 1 SWIPE 0 -----------------------
[+] Length (bits) = 266 (%5 = 1, %6 = 2, %7 = 0, % 8= 2)
[+] Data: 10100110001001100010011000100110001001100010011000100110001001100010011000100110001001100101011011100110101001001101100110100110001001100111110110111100111101100010000000100110011001101100001010010101001001001110110100000111001101011101100001100101101000101010011001
[+] Strings:
 [-] 5 bit: 5398621&lt;4398621&lt;43:&gt;62&lt;3539&lt;;&gt;&lt;=409&lt;615549=1&gt;6&gt;36=1:6
 [-] length: 53
 [-] hex: 
 35 33 39 38 36 32 31 3c 34 33 39 38 36 32 31 3c 5398621&lt;4398621&lt;
 34 33 3a 3e 36 32 3c 33 35 33 39 3c 3b 3e 3c 3d 43:&gt;62&lt;3539&lt;;&gt;&lt;=
 34 30 39 3c 36 31 35 35 34 39 3d 31 3e 36 3e 33 409&lt;615549=1&gt;6&gt;3
 36 3d 31 3a 36 6=1:6
[-] 6 bit: E(1C&amp;amp;,9RD(1CFM92;+1S;G;&quot;D,-**DMPLW8M4,
 [-] length: 38
 [-] hex: 
 45 28 31 43 26 2c 39 52 44 28 31 43 46 4d 39 32 E(1C&amp;amp;,9RD(1CFM92
 3b 2b 31 53 3b 47 3b 22 44 2c 2d 2a 2a 44 4d 50 ;+1S;G;&quot;D,-**DMP
 4c 57 38 4d 34 2c LW8M4,
[-] 7 bit: %..#...2$..#&amp;amp;-.....3.'..$....$-0,7.-.
 [-] length: 37
 [-] hex: 
 25 08 11 23 06 0c 19 32 24 08 11 23 26 2d 19 12 %..#...2$..#&amp;amp;-..
 1b 0b 11 33 1b 27 1b 02 24 0c 0d 0a 0a 24 2d 30 ...3.'..$....$-0
 2c 37 18 2d 14 ,7.-.
[-] 8 bit: .&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;V....&amp;amp;}.. &amp;amp;f..$..5.e..@
 [-] length: 34
 [-] hex: 
 a6 26 26 26 26 26 26 26 26 26 26 56 e6 a4 d9 a6 .&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;V....
 26 7d bc f6 20 26 66 c2 95 24 ed 07 35 d8 65 a2 &amp;amp;}.. &amp;amp;f..$..5.e.
 a6 40 .@
[+] Parity for 5 bit chars: odd: False, even: False)
[+] Parity for 6 bit chars: odd: False, even: False)
[+] Parity for 7 bit chars: odd: False, even: False)
[+] Parity for 8 bit chars: odd: False, even: False)
[+] Frequency analysis for potential char lengths:
 [-] 5 bits:
 10011: 5
 11000: 4
 01100: 4
 00110: 4
 00100: 4
 [-] 6 bits:
 100110: 5
 100010: 5
 011000: 5
 011001: 4
 001001: 4
 [-] 7 bits:
 1000100: 3
 0010011: 3
 1101100: 2
 1100010: 2
 1011010: 2
 [-] 8 bits:
 00100110: 12 &lt; common 8-bit patter implies 8-bit chars?
 10100110: 3
...snip...
</pre>
<p>The above data is from an actual hotel card (though the hotel as since switched to using RFID locks).</p>
<p>I also started to look at XORing, rotating of characters (rot13 style), bit order and offsetting the whole stream of bits (in case I started at the wrong place when  chunk the character up). All to no avail as yet.</p>
<p>That&#8217;s as far as I got. I&#8217;ll be sure to post again if I ever decode any of the data on the card. I was hoping to see my room number and checkout date in cleartext. But equally an opaque encrypted string wouldn&#8217;t surprise me either &#8211; which could be what I&#8217;m seeing on at least some of the cards.</p>
<h2>Conclusion</h2>
<p>Doing things the cheap and time-consuming way can be fun &#8211; and a good opportunity to write code, learn about <a title="matplotlib" href="https://matplotlib.org/">matplotlib</a> and dust off the logic analyser.</p>
<h2>Further reading/viewing</h2>
<p>If you want to know more about magstripes (before they become completely obsolete), take a look at:</p>
<ul>
<li><a title="Samy Kamkar's magspoof tool" href="https://samy.pl/magspoof/">Samy Kamkar&#8217;s magspoof tool</a> (<a title="video link" href="https://www.youtube.com/watch?v=UHSFf0Lz1qc">video link</a>) &#8211; could be useful if you need your PC to transmit bad data in through a magnetic read head.</li>
<li><a title="DEF CON 24 - Weston Hecker - Hacking Hotel Keys and Point of Sale Systems" href="https://www.youtube.com/watch?v=mV_0k9Fh590">DEF CON 24 &#8211; Weston Hecker &#8211; Hacking Hotel Keys and Point of Sale Systems</a></li>
</ul>
<p>I was pretty inspired by these projects.</p>
<br /> <div class="wpcf7" id="wpcf7-f375-p238-o1"><form action="/contact/" method="post" class="wpcf7-form">
<div style="display: none;">
<input type="hidden" name="_wpcf7" value="323" />
<input type="hidden" name="_wpcf7_version" value="3.3.2" />
<input type="hidden" name="_wpcf7_unit_tag" value="wpcf7-f375-p238-o1" />
<input type="hidden" name="_wpnonce" value="4c6cc9abab" />
</div>
<style>.portcullis-content .layout-item-0 { background: ; padding: 10px;  }
.portcullis-content .layout-item-1 {  border-collapse: separate;  }
.portcullis-content .layout-item-2 { border-top-style:solid;border-right-style:solid;border-bottom-style:solid;border-left-style:solid;border-top-width:1px;border-right-width:1px;border-bottom-width:1px;border-left-width:1px;border-top-color:#C7C7C7;border-right-color:#C7C7C7;border-bottom-color:#C7C7C7;border-left-color:#C7C7C7; color: #1C1C1C; background: #FAFAFA url('https://www.portcullis-security.com/wp-content/uploads/2013/01/983aa2.png') scroll; padding: 10px; border-radius: 5px;  }
.ie7 .post .layout-cell {border:none !important; padding:0 !important; }
.ie6 .post .layout-cell {border:none !important; padding:0 !important; }</p>
</style>
<div class="portcullis-content-layout layout-item-1">
<div class="portcullis-content-layout-row">
<div class="portcullis-layout-cell layout-item-2" style="width: 80%" >
</p>
</p>
<h3>Request to be added to the Portcullis Labs newsletter</h3>
<p>
 We will email you whenever a new tool, or post is added to the site.</p>
<p>Your Name (required)<br />
    <span class="wpcf7-form-control-wrap your-name"><input type="text" name="your-name" value="" class="wpcf7-form-control wpcf7-text wpcf7-validates-as-required" size="40" required="required" /></span> </p>
<p>Your Email (required)<br />
    <span class="wpcf7-form-control-wrap your-email"><input type="text" name="your-email" value="" class="wpcf7-form-control wpcf7-text wpcf7-email wpcf7-validates-as-required wpcf7-validates-as-email" size="40" required="required" /></span> </p>
<p><input type="hidden" name="porpoise" value="newsletter" /><br />
<input type="hidden" name="contact_form_7_recaptcha" value="g-recaptcha-YKWtrzAw6Xpcf4W" class="g-recaptcha-explicit-id"><div id="g-recaptcha-YKWtrzAw6Xpcf4W"></div><span class="wpcf7-form-control-wrap g-recaptcha-explicit" data-sitekey="6LdFERITAAAAAJKGS2TEXuWsyOxc-KxvAZBC8zE2"></span></p>
<p><input type="submit" value="Subscribe" class="wpcf7-form-control  wpcf7-submit" /></p>
</div>
</div>
</div>
<div class="wpcf7-response-output wpcf7-display-none"></div></form></div></br ><div style="clear:both;"></div><!-- AddThis Advanced Settings above via filter on the_content --><!-- AddThis Advanced Settings below via filter on the_content --><!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_toolbox addthis_default_style addthis_32x32_style"><a class="addthis_button_email"><a class="addthis_button_twitter"></a><a class="addthis_button_reddit"></a></a>
</div><!-- AddThis Advanced Settings generic via filter on the_content --><!-- AddThis Share Buttons above via filter on the_content --><!-- AddThis Share Buttons below via filter on the_content --><div class="at-below-post addthis_tool" data-url="https://labs.portcullis.co.uk/blog/reading-hotel-key-cards-with-a-credit-card-magstripe-reader/"></div><!-- AddThis Share Buttons generic via filter on the_content --></div>
                                                                
</article>
				

                        </div>
                                            </div>
                </div>
            </div><footer class="portcullis-footer clearfix"><div class="portcullis-content-layout">
    <div class="portcullis-content-layout-row">
    <div class="portcullis-layout-cell" style="width: 100%">
        <p><br></p>
    </div>
    </div>
</div>
<div class="portcullis-content-layout">
    <div class="portcullis-content-layout-row">
    <div class="portcullis-layout-cell" style="width: 33%">
        <p style="text-align: left;"><span style="font-size: 17px; padding-left:40px; font-family: Tahoma;"><span style="color: #ffffff;">Research and Development</span><br></span></p>
        <ul>
        <li style="text-align: left;padding-left:50px;"><span style="font-size: 12px; font-family: Tahoma;"><a href="https://labs.portcullis.co.uk/advisories/">Advisories</a><br></span></li>
        <li style="text-align: left;padding-left:50px;"><span style="font-size: 12px; font-family: Tahoma;"><a href="https://labs.portcullis.co.uk/blog/">Blog</a><br></span></li>
        <li style="text-align: left;padding-left:50px;"><span style="font-size: 12px; font-family: Tahoma;"><a href="https://labs.portcullis.co.uk/presentations/">Presentations</a><br></span></li>
        <li style="text-align: left; padding-left:50px;"><span style="font-size: 12px; font-family: Tahoma;"><a href="https://labs.portcullis.co.uk/tools/">Tools</a><br></span></li>
        <li style="text-align: left;padding-left:50px;"><span style="font-size: 12px; font-family: Tahoma;"><a href="https://labs.portcullis.co.uk/whitepapers/">Whitepapers</a><br></span></li>
        <li style="text-align: left;padding-left:50px;"><span style="font-size: 12px; font-family: Tahoma;"><a href="https://labs.portcullis.co.uk/downloads/">Downloads</a><br></span></li>
               </ul>
        <p><br></p>
    </div><div class="portcullis-layout-cell" style="width: 34%">
        <p style="text-align: left;"><span style="font-size: 17px;"><span style="font-family: Tahoma;"><span style="font-weight: normal; color: #ffffff;">Company</span><br></span></span></p>
        <ul>
       <li style="text-align: left;"><span style="font-family: Tahoma;"><a href="https://labs.portcullis.co.uk/contact-us/">Contact Us</a><span style="font-size: 12px;"><br></span></span></li>
        <li style="text-align: left;"><span style="font-family: Tahoma;"><a href="https://www.portcullis-security.com">Portcullis Computer Security Services</a><span style="font-size: 12px;"><br></span></span></li>
                </ul>
        <br>
    </div><div class="portcullis-layout-cell" style="width: 33%">
       <span style="color: #ffffff;"><br>
        <br>
        <p style="text-align: left;"><span style="color: #ffffff; font-family: Tahoma;"><span style="color: #ffffff;"><span style="font-size: 15px; color: #ffffff;">Follow Us</span> <span style="font-weight: bold;"> <a href="http://www.twitter.com/portcullislabs" target="_blank"><img width="16" height="16" style=" border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px;" alt="Portcullis Twitter" class="" src="https://labs.portcullis.co.uk/wp-content/themes/Portcullisfinal/images/twitterfooter.png"></a> <a href="http://www.linkedin.com/company/portcullis?trk=hb_tab_compy_id_505813" target="_blank"><img width="16" height="16" style=" border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px;" alt="Portcullis Linkedin" class="" src="https://labs.portcullis.co.uk/wp-content/themes/Portcullisfinal/images/linkedinfooter.png"></a> <a href="http://www.facebook.com/PortcullisCSL" target="_blank"><img width="16" height="16" style=" border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px;" alt="Portcullis Facebook" class="" src="https://labs.portcullis.co.uk/wp-content/themes/Portcullisfinal/images/facebookfooter.png"></a> <a href="https://plus.google.com/114151721382021849037/posts" target="_blank"><img width="16" height="16" style=" border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px;" alt="Google Plus" class="" src="https://labs.portcullis.co.uk/wp-content/themes/Portcullisfinal/images/googleplusfooter.png"></a> <a href="/rss" target="_blank"><img width="16" height="16" style=" border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px;" alt="Portcullis Rss" class=""img src="https://labs.portcullis.co.uk/wp-content/uploads/2013/04/rss.png"></a></span></span></span></p>
        <p><br></p>
    </div>
    </div>
</div>
<div class="portcullis-content-layout">
    <div class="portcullis-content-layout-row">
    <div class="portcullis-layout-cell" style="width: 100%">
        <p><br></p>
        <hr>
    </div>
    </div>
</div>
<div class="portcullis-content-layout">
    <div class="portcullis-content-layout-row">
    <div class="portcullis-layout-cell" style="width: 50%">
      <p style="text-align: left;"><span style="color: #ffffff; font-size: 12px; font-family: Tahoma;">© Portcullis Computer Security Ltd & Portcullis Inc. All rights reserved. ® 1992 - 2017.</span></p>
    </div><div class="portcullis-layout-cell" style="width: 50%">
        <p style="text-align: right;"><span style="color: #ffffff; font-size: 12px; font-family: Tahoma;"><a href="https://labs.portcullis.co.uk/terms-of-use/">Terms of Use</a> </span>| <span style="color: #ffffff; font-size: 12px; font-family: Tahoma;"><a href="https://labs.portcullis.co.uk/privacy-and-cookies/">Privacy and Cookies</a></span></p>
    </div>
    </div>
</div></footer>

    </div>
</div>



<div id="wp-footer">
	<script type='text/javascript' src='https://labs.portcullis.co.uk/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.9b'></script>
<script type='text/javascript' src='https://labs.portcullis.co.uk/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushBash.js?ver=3.0.9b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "https://labs.portcullis.co.uk/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "https://labs.portcullis.co.uk/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeMidnight.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
<script type='text/javascript' src='https://labs.portcullis.co.uk/wp-content/plugins/contact-form-7/includes/js/jquery.form.min.js?ver=3.23'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var _wpcf7 = {"loaderUrl":"https:\/\/labs.portcullis.co.uk\/wp-content\/plugins\/contact-form-7\/images\/ajax-loader.gif","sending":"Sending ..."};
/* ]]> */
</script>
<script type='text/javascript' src='https://labs.portcullis.co.uk/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=3.3.2'></script>
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js?onload=contact_form_7_recaptcha_callback&#038;render=explicit&#038;ver=1.0.0'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var contact_form_7_recaptcha_data = {"sitekey":"6LdFERITAAAAAJKGS2TEXuWsyOxc-KxvAZBC8zE2"};
/* ]]> */
</script>
<script type='text/javascript' src='https://labs.portcullis.co.uk/wp-content/plugins/contact-form-7-recaptcha/script.js?ver=1.0.0'></script>
	<!-- 63 queries. 0.104 seconds. -->
</div>
</body>
</html>

