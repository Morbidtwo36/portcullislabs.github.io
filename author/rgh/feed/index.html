<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Portcullis Labs &#187; RGH</title>
	<atom:link href="https://labs.portcullis.co.uk/author/rgh/feed/" rel="self" type="application/rss+xml" />
	<link>https://labs.portcullis.co.uk</link>
	<description>Research and Development</description>
	<language>en-US</language>
		<sy:updatePeriod>hourly</sy:updatePeriod>
		<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.8.5</generator>
	<item>
		<title>Windows 10’s &#8220;Controlled Folder Access&#8221; feature</title>
		<link>https://labs.portcullis.co.uk/blog/windows-10s-controlled-folder-access-feature/</link>
		<comments>https://labs.portcullis.co.uk/blog/windows-10s-controlled-folder-access-feature/#comments</comments>
		<pubDate>Thu, 16 Nov 2017 09:44:52 +0000</pubDate>
		<dc:creator><![CDATA[RGH]]></dc:creator>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[auditing]]></category>
		<category><![CDATA[blue team]]></category>
		<category><![CDATA[red team]]></category>
		<category><![CDATA[training]]></category>
		<category><![CDATA[Windows]]></category>

		<guid isPermaLink="false">https://labs.portcullis.co.uk/?p=6110</guid>
		<description><![CDATA[<p>Microsoft released a rolling upgrade of Windows 10 in October 2017. The &#8220;Fall Creators&#8221; edition (version 1709, codename Redstone 3) contains a new feature called &#8220;Controlled Folder Access&#8221;, which is designed to combat ransomware attacks. Controlled Folder Access is part of Windows Defender Security Centre that works with Windows Defender Anti-Virus to prevent &#8220;suspicious&#8221; executable [&#8230;]</p><p>The post <a href="https://labs.portcullis.co.uk/blog/windows-10s-controlled-folder-access-feature/">Windows 10’s &#8220;Controlled Folder Access&#8221; feature</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Microsoft released a rolling upgrade of Windows 10 in October 2017. The &#8220;Fall Creators&#8221; edition (version 1709, codename Redstone 3) contains a new feature called &#8220;Controlled Folder Access&#8221;, which is designed to combat ransomware attacks.<span id="more-6110"></span></p>
<p>Controlled Folder Access is part of Windows Defender Security Centre that works with Windows Defender Anti-Virus to prevent &#8220;suspicious&#8221; executable files, DLLs, and scripts from writing to (or encrypting) files within certain folders.</p>
<h2>What folders are protected?</h2>
<p>While additional folders can be added, the following locations will always be monitored when Controlled Folder Access is enabled:</p>
<ul>
<li>User: Documents, Pictures, Videos, Music, Desktop, Favorites</li>
<li>Public: Documents, Pictures, Videos, Music, Desktop</li>
</ul>
<h2>How does Windows determine what `suspicious&#8217; code is?</h2>
<p>It’s what Windows Defender Anti-Virus identifies. As such Controlled Folder Access relies on Windows Defender Anti-Virus to be running.</p>
<h2>What about application false positives?</h2>
<p>It may be the case that legitimate applications are incorrectly flagged by Windows Defender Anti-Virus as being `suspicious&#8217; preventing or hindering legitimate use. Such applications can be white-listed.</p>
<p>To facilitate this, Controlled Folder Access supports an `audit&#8217; mode, where an event is generated when the application would normally be prevented from writing to a protected folder. Those events can be reviewed to identify legitimate applications that can be added to the white-list.</p>
<h2>Is Controlled Folder Access enabled by default? How do I configure it?</h2>
<p>Controlled Folder Access is not enabled by default and can be configured via:</p>
<ul>
<li>The User Interface</li>
<li>Group Policy (a Group Policy would need to be configured on a system that contains the correct administrative templates for the options to be available for selection): Computer Configuration > Administrative Templates > Windows Components > Windows Defender Anti-Virus > Windows Defender Exploit Guard > Controlled Folder Access</li>
<li>Manual Registry modification (i.e. via a script)</li>
<li>PowerShell cmdlets:</li>
</ul>
<pre class="brush: powershell; gutter: false; title: ; notranslate">
Set-MpPreference -EnableControlledFolderAccess [Enable | Disable | Audit]
Add-MpPreference -ControlledFolderAccessProtectedFolders c:\path\to\protect,c:\other\path
Remove-MpPreference -ControlledFolderAccessProtectedFolders c:\path\to\no\longer\protect
</pre>
<p>Note: Set-MpPreference can also be used to specify folder items but will clear the list first, whereas Add-MpPreference adds to the list.</p>
<h2>What Registry keys are used by Controlled Folder Access?</h2>
<h3>Is Controlled Folder Access enabled?</h3>
<pre class="brush: bash; gutter: false; title: ; notranslate">
Registry path: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Defender\Exploit Guard\Controlled Folder Access
Registry Key: GuardMyFolders
Key Type: REG_DWORD
Key Value: 0
</pre>
<h3>Protected Folders</h3>
<pre class="brush: bash; gutter: false; title: ; notranslate">
Registry path: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Defender\Exploit Guard\Controlled Folder Access\ProtectedFolders
Registry Key: audit
Key Type: REG_DWORD
Key Value: 0
</pre>
<h3>To specify protected folders:</h3>
<pre class="brush: bash; gutter: false; title: ; notranslate">
Registry path: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Defender\Exploit Guard\Controlled Folder Access\ProtectedFolders
Registry Key: Full path to protect, i.e. c:\test
Key Type: REG_DWORD
Key Value: 0&lt;/code&gt;
</pre>
<h2>What can be protected? Any limitations?</h2>
<p>Network shares and mapped drives can be protected, but Controlled Folder Access does not support the use of:</p>
<ul>
<li>Environment Variables</li>
<li>Wildcards</li>
<li>The Windows drive (typically C:\)</li>
</ul>
<p>Seriously, don’t protect the entire Windows drive as Windows will be unable to function correctly and strange behaviour will result.</p>
<h3>What happens when write access is blocked?</h3>
<p>A notification is displayed that provides the path of the executable that was blocked, and the path of protected folder that the write attempt was for. This information is also recorded in the event log, using the following event values:</p>
<ul>
<li>Event ID: 5007: Event when settings are changed</li>
<li>Event ID: 1124: Audited Controlled folder access event</li>
<li>Event ID: 1123: Blocked Controlled folder access event</li>
</ul>
<p>The following image shows the notification of a write action being blocked:</p>
<p><a name="imageclose-6111"><div class="lb-album"><a href="#image-6111"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2017/11/VirtualBox_Win10_Ent_90days_02_11_2017_14_17_19-300x225.png" alt="Blocked write access notification" class="size-medium wp-image-6121"><span></span></a></div>              
<a href="#imageclose-6111" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-6111">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2017/11/VirtualBox_Win10_Ent_90days_02_11_2017_14_17_19.png" alt="image-6111">
                   </div></a></p>
<h3>Can the blocked write notification message be customised?</h3>
<p>Yes, at least for Enterprise environments. Providing details of who to contact (service desk, IT Security, etc.) can be included in the notification message via the following Group Policy settings:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
Computer Configuration &gt; Policies &gt; Adminstrative Templates &gt; Windows Components &gt; Windows Defender Security Center &gt; Enterprise Customization
</pre>
<ul>
<li> Set &#8220;Configure customized contact information&#8221; to &#8220;Enabled&#8221;</li>
<li> Set &#8220;Configure customized notifications&#8221; to &#8220;Enabled&#8221;</li>
<li> Set &#8220;Specify contact compant name&#8221; to &#8220;Enabled&#8221; and add the company details</li>
<li> Enable and set at least one of the following:
<ul>
<li>&#8220;Specify contact email address or EmailID&#8221;</li>
<li>&#8220;Specify contact phone number or Skype ID&#8221;</li>
<li>&#8220;Specify contact web site&#8221;</li>
</ul>
</li>
</ul>
<h3>Does Controlled Folder Access work with third-party Anti-Virus applications?</h3>
<p>No, or at least not in the tests performed when writing this post. Controlled Folder Access requires the use of Windows Defender Anti-Virus to be active.</p>
<p>Most third-party Anti-Virus solutions replace existing products, and attempting to run multiple Anti-Virus solutions at the same time can significantly hinder system performance, or even lead to each one preventing the other from being able to scan files or removable drives which could lower protections. One Anti-Virus program might flag others as being infected (i.e. triggering on the detection patterns) or malicious, and quarantine key files – potentially breaking that product.</p>
<h3>How can I tell Controlled Folder Access and Notifications are configured and working?</h3>
<p>Microsoft have produced an ExploitGuard CFA File Creator tool to trigger Controlled Folder Access actions, which causes notifications to be displayed.</p>
<p>Details on the <a href="https://docs.microsoft.com/en-us/windows/threat-protection/windows-defender-exploit-guard/evaluate-controlled-folder-access#use-the-demo-tool-to-see-how-controlled-folder-access-works" title="ExploitGuard CFA Demo Tool">ExploitGuard CFA Demo Tool</a>, and a link to download it, can be found on Microsoft&#8217;s web site.</p>
<h2>Conclusion</h2>
<p>For home users or business that do not have a corporate Anti-Virus solution, Windows Defender Anti-Virus and Controlled Folder Access will be better than nothing.<br />
However, larger businesses typically have existing enterprise-wide Anti-Virus solutions in which significant time and effort (and money) has been invested. It would be difficult to convince the IT Security teams of such companies to throw out that investment, so I don’t expect Controlled Folder Access to be used much in large businesses.</p>
<p>Controlled Folder Access is a new feature, and it may be that Microsoft modify it to work with third-party Anti-Virus products in the future.</p>
<p>The post <a href="https://labs.portcullis.co.uk/blog/windows-10s-controlled-folder-access-feature/">Windows 10’s &#8220;Controlled Folder Access&#8221; feature</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://labs.portcullis.co.uk/blog/windows-10s-controlled-folder-access-feature/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Hindering Lateral Movement</title>
		<link>https://labs.portcullis.co.uk/blog/hindering-lateral-movement/</link>
		<comments>https://labs.portcullis.co.uk/blog/hindering-lateral-movement/#comments</comments>
		<pubDate>Fri, 27 Oct 2017 12:53:52 +0000</pubDate>
		<dc:creator><![CDATA[RGH]]></dc:creator>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[auditing]]></category>
		<category><![CDATA[blue team]]></category>
		<category><![CDATA[red team]]></category>
		<category><![CDATA[training]]></category>
		<category><![CDATA[Windows]]></category>

		<guid isPermaLink="false">https://labs.portcullis.co.uk/?p=6092</guid>
		<description><![CDATA[<p>Lateral Movement is a method used by attackers (or malware) against a network Domain. After an initial device is compromised (typically, a user&#8217;s workstation), the attacker extracts passwords from memory, or obtains encrypted password hashes from the system for cracking or direct use (i.e. Pass the Hash). The attacker then attempts to login to other [&#8230;]</p><p>The post <a href="https://labs.portcullis.co.uk/blog/hindering-lateral-movement/">Hindering Lateral Movement</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Lateral Movement is a method used by attackers (or malware) against a network Domain. After an initial device is compromised (typically, a user&#8217;s workstation), the attacker extracts passwords from memory, or obtains encrypted password hashes from the system for cracking or direct use (i.e. Pass the Hash). The attacker then attempts to login to other systems using those credentials to search for cached passwords of privileged Domain accounts. Usually, the local Administrator account is targeted as the password is often the same on all systems (due to the common practice of deploying systems from a master image), but service accounts, etc. can also be targeted.<span id="more-6092"></span></p>
<p>In some cases, an attacker is able to move from having local Administrator access on a workstation to gaining full Domain Admin rights on the Domain in under an hour.</p>
<p>Since Active Directory typically controls access to highly sensitive information, it is important to try and prevent lateral attacks from working. Being able to spot these attacks would also be good.</p>
<h2>Limit workstation to workstation communications</h2>
<p>It is highly unusual for network users to need to directly communicate with other users’ workstations.</p>
<p>Configure each workstation to use a local firewall to block incoming Windows network traffic (139/TCP, 445/TCP and 137/UDP) from any workstation subnet. </p>
<p>If using a firewall that supports different network zones (such as the Windows Firewall), ensure the appropriate zone profiles are configured, or simply configure all profiles. If your organisation uses VoIP telephones, prevent those subnets from connecting as well to protect against either a malicious internal employee, or in case the attacker is able to convince a user to try changing network connections.</p>
<h2>Prevent local users from logging in over the network</h2>
<p>If an attacker finds that they cannot directly connect to other workstations to hunt for privileged cached credentials, they may attempt to compromise a server and try to login to workstations from there. To protect against this, configure the User Rights policy &#8216;Deny access to this computer from the network&#8217; by adding local user accounts.</p>
<h2>Use a local Administrator password management tool</h2>
<p>Tools, such as Microsoft LAPS, exist that set unique passwords for the local administrator account. By using such tools, when a password exceeds its expiration date the password will be changed automatically when the Group Policy is refreshed. Avoid writing a custom password management system, as it is very difficult to implement such things without error; if an attacker is able to determine a pattern to setting the password, then that defence is gone.</p>
<h2>Configure systems via Group Policy</h2>
<p>To reduce the risk of credentials being captured, avoid logging into systems where not necessary. Use Group Policies to configure workstations and servers instead of directly logging into them, where possible. Systems may be configured to cache credentials when users login, and this information can be obtained by an attacker and then cracked offline to reveal the plain text password for that user account. If an attacker already has a foothold on a system and a Domain Administrator logs in, the attacker may be able to impersonate the Domain Administrator in order to utilise their privileges within the network Domain.</p>
<h2>Use dedicated administrative accounts and workstations</h2>
<p>An attacker can only extract privileged password data if it is present on the system. Ensure administrative users have user accounts that are separate from their day-to-day user accounts and configure them so that they cannot login to normal workstations or servers; they should only be used to login to Active Directory servers to manage them, and configure Group Policies to manage other systems.</p>
<p>Dedicated management workstations should not be able to access the Internet or email.</p>
<h2>Disable &#8216;WDigest&#8217;</h2>
<p>Windows supports several Security Support Providers (SSPs), used to handle authentication requests (including Single Sign On). Until recently (Window 8.1 and Server 2012 R2 or higher), Windows used by default an SSP called &#8216;WDigest&#8217; &#8211; which stored user credentials in plain text in memory, allowing a process with local Administrator privileges to extract the passwords of all logged-in users.</p>
<p>To help address this issue, Microsoft created a new Registry key for &#8216;WDigest&#8217; to disable storing plain text passwords, which can be applied to Windows, prior to 8.1 and Server 2012 R2 by installing KB2871997 and configuring the following Registry setting:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
Registry Path: HKLM\System\CurrentControlSet\Control\SecurityProviders\Wdigest
Key Name: UseLogonCredential
Key Type: REG_DWORD
Key Value: 0
</pre>
<p>Alternatively, KB2871997 can be configured via Group Policy by installing the PtH.admx/adml files provided with the Microsoft Security Compliance Manager (SCM) via:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
Local Policies &gt; Administrative Templates &gt; SCM: Pass the Hash Mitigations &gt; Wdigest Authentication
</pre>
<h2>Apply enhanced credentials protection updates</h2>
<p>In addition to the protections added by KB2871997, Microsoft have released an updated that further protects against Pass the Hash (PtH) attacks for Windows 7, Windows 8, Server 2008 R2 and Server 2012. </p>
<h2>KB3126593 (MS16-014)</h2>
<p>This update adds support for the TokenLeakDetectDelaySecs Registry setting which can be used to force credentials to be cleared after a user logs off. To set clearing credentials 30 seconds after user logout (the default behaviour in Windows 8.1 and Windows 10), configure the following Registry setting:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
Registry Path: HKLM\System\CurrentControlSet\Control\Lsa
Key Name: TokenLeakDetectDelaySecs
Key Type: REG_DWORD
Key Value: 30
</pre>
<h2>Upgrade Windows servers and workstations</h2>
<p>With each new version of Windows, Microsoft adds additional security features, including protections for the LSASS service to protect against credential stealing and adding additional logging options. Upgrade servers to Server 2016 and upgrade workstations to Windows 10 and configure them to make use of these new features. </p>
<h2>Enable event monitoring and investigate alerts</h2>
<p>A centralised logging and monitoring solution provides an opportunity for recording actions and events that take place on systems, and prevents a successful attacker from clearing the event log to hide their actions.</p>
<p>Configure all Windows systems to log events to a centralised system and monitor for account login attempts (both successful and unsuccessful).<br />
Any events that reference local accounts (or Domain Administrator/privileged accounts) and not Domain accounts should be investigated as a matter of priority. </p>
<p>The following Windows event codes are generated by Windows 2008 and later:</p>
<ul>
<li>Event ID: 4624: Account login successful</li>
<li>Event ID: 4625: Account login failed</li>
</ul>
<p>The corresponding events for Windows 2003 and earlier:</p>
<ul>
<li>Event ID: 528: Account login successful</li>
<li>Event ID: 540: Network account login successful</li>
<li>Event ID: 529: Login failure &#8211; Unknown user or bad password</li>
</ul>
<p>Other potentially interesting event code are:</p>
<ul>
<li>Event ID: 4625: An account failed to login (Windows 2008 and later)</li>
<li>Event ID: 531: Login failure &#8211; Account currently disabled (Windows 2003 and earlier)</li>
</ul>
<h2>Conclusion</h2>
<p>A number of options have been presented to hinder Lateral Movement attacks, and some readers might be wondering which option to implement. The answer is &#8220;all of them, where possible&#8221;. Security is a &#8220;defence in depth&#8221; game, and every obstacle that an attacker has to work around is worth implementing.</p>
<p>In addition to hindering lateral movement, monitoring for attacks or suspicious behaviour and investigating alerts will help identify more sophisticated attacks, as well as indicating that suspicious activities are occurring.</p>
<p>A <a href="https://blogs.cisco.com/security/can-your-organisation-be-breached-find-out-with-a-red-team" title="Red Team">Red Team Assessment</a> can be undertaken to determine the effectiveness of the security controls in place during an attack against your network. Whilst the assessment is taking place it also provides an opportunity to determine whether the internal monitoring and response capabilities intended to detect and alert when a potential attack is occurring within your network are effective. Following completion of the assessment you will have a clear view of any additional measures that should be implemented to improve both defence and monitoring capabilities within your network.</p>
<p>The post <a href="https://labs.portcullis.co.uk/blog/hindering-lateral-movement/">Hindering Lateral Movement</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://labs.portcullis.co.uk/blog/hindering-lateral-movement/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Detecting windows horizontal password guessing attacks in near real-time</title>
		<link>https://labs.portcullis.co.uk/blog/detecting-windows-horizontal-password-guessing-attacks-in-near-real-time/</link>
		<comments>https://labs.portcullis.co.uk/blog/detecting-windows-horizontal-password-guessing-attacks-in-near-real-time/#comments</comments>
		<pubDate>Mon, 16 Feb 2015 13:37:49 +0000</pubDate>
		<dc:creator><![CDATA[RGH]]></dc:creator>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[auditing]]></category>
		<category><![CDATA[blue team]]></category>
		<category><![CDATA[training]]></category>
		<category><![CDATA[Windows]]></category>

		<guid isPermaLink="false">https://labs.portcullis.co.uk/?p=3914</guid>
		<description><![CDATA[<p>When attempting to gain a foothold into a Windows Domain, an attacker will often attempt one or two likely passwords against every user in the Active Directory, a so-called horizontal password guessing attack. A small number of failed logons per user will usually not trigger a user account lockout policy and can be very effective. [&#8230;]</p><p>The post <a href="https://labs.portcullis.co.uk/blog/detecting-windows-horizontal-password-guessing-attacks-in-near-real-time/">Detecting windows horizontal password guessing attacks in near real-time</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>When attempting to gain a foothold into a Windows Domain, an attacker will often attempt one or two likely passwords against every user in the Active Directory, a so-called horizontal password guessing attack. A small number of failed logons per user will usually not trigger a user account lockout policy and can be very effective. This post will provide an example solution to detecting such attacks in near real time, using only native Windows tools.<span id="more-3914"></span></p>
<p>Even with password complexity requirements and custom filters there is no built-in way to stop users choosing poor passwords. It is scary how may user accounts are identified with the password Password1 for example. We need a method of detecting password guessing attacks, preferably before someone takes control of the Domain.</p>
<p>By following the instructions below you can get hourly (can be trivially customised) notifications of such horizontal password guessing attacks.</p>
<p>Note: The following method has been developed using Windows 2012.</p>
<h2>Configuring the Domain Controller</h2>
<p>First we need to configure the Active Directory Domain Controller to log failed logon attempts:</p>
<ul>
<li>From the Server Manager tool click Tools and select Group Policy Management, as shown in the screenshot below:
<div id="attachment_3906" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-3915"><div class="lb-album"><a href="#image-3915"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2014/02/01-run-gpmgmt-300x225.png" alt="Server Manager..Tools..Group Policy Management" class="size-medium wp-image-3906"><span></span></a></div>              
<a href="#imageclose-3915" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-3915">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2014/02/01-run-gpmgmt.png" alt="image-3915">
                   </div></a><p class="wp-caption-text">Figure 1. Opening the Group Policy Management tool</p></div></li>
<li>Expand the nodes in the left hand pane so you can see the policy Default Domain Controllers Policy for Domain Controllers within the Domain. Right-click it and select Edit, as shown below:
<div id="attachment_3907" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-3916"><div class="lb-album"><a href="#image-3916"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2014/02/02-edit-default-policy-300x225.png" alt="Expand ' class="size-medium wp-image-3907"><span></span></a></div>              
<a href="#imageclose-3916" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-3916">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2014/02/02-edit-default-policy.png" alt="image-3916">
                   </div></a><p class="wp-caption-text">Figure 2. Edit the &#8216;Default Domain Controllers Policy&#8217;</p></div></li>
<li>In the Group Policy Management Editor expand &#8220;Computer Configuration &gt; Policies &gt; Windows Settings &gt; Security Settings &gt; Local Policies&#8221; and then click &#8220;Audit Policy&#8221;</li>
<li>Right-click &#8220;Audit account logon events&#8221; and select &#8220;Properties&#8221;, as shown below:
<div id="attachment_3908" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-3917"><div class="lb-album"><a href="#image-3917"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2014/02/03-computer-audit-policy-properties-300x225.png" alt="Expand ' class="size-medium wp-image-3908"><span></span></a></div>              
<a href="#imageclose-3917" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-3917">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2014/02/03-computer-audit-policy-properties.png" alt="image-3917">
                   </div></a><p class="wp-caption-text">Figure 3. Editing the policy setting for &#8216;Audit account logon events&#8217;</p></div></li>
<li>Ensure that both &#8220;Define these policy settings&#8221; and &#8220;Failure&#8221; are enabled then click &#8220;OK&#8221;. The following screenshot shows both &#8220;Success&#8221; and &#8220;Failure&#8221; are selected:
<div id="attachment_3909" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-3918"><div class="lb-album"><a href="#image-3918"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2014/02/04-audit-policy-success-failure-300x225.png" alt="Tick ' class="size-medium wp-image-3909"><span></span></a></div>              
<a href="#imageclose-3918" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-3918">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2014/02/04-audit-policy-success-failure.png" alt="image-3918">
                   </div></a><p class="wp-caption-text">Figure 4. Enabling failure events for the &#8216;Audit account logon events&#8217; properties</p></div></li>
<li>When you click &#8220;OK&#8221; the updated policy settings will be visible. Next we force the server to recognise the updated policy settings by running the command gpupdate /force by pressing Windows key + r, as shown below:
<div id="attachment_3911" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-3919"><div class="lb-album"><a href="#image-3919"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2014/02/05-run-gpupdate_-force-300x225.png" alt="Run ' class="size-medium wp-image-3911"><span></span></a></div>              
<a href="#imageclose-3919" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-3919">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2014/02/05-run-gpupdate_-force.png" alt="image-3919">
                   </div></a><p class="wp-caption-text">Figure 5. Forcing the updated policy to take effect</p></div></li>
<li>To test that the policy has taken affect we make a failed logon attempts (from another system). Note the IP address of the machine used in the screenshot below:
<div id="attachment_3949" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-3920"><div class="lb-album"><a href="#image-3920"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2014/02/07-client-logon-failure-300x225.png" alt="Run ' class="size-medium wp-image-3949"><span></span></a></div>              
<a href="#imageclose-3920" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-3920">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2014/02/07-client-logon-failure.png" alt="image-3920">
                   </div></a><p class="wp-caption-text">Figure 6. Triggering a failed logon event with a &#8220;net use&#8221; command</p></div></li>
<li>By viewing the Event Viewer on the Domain Controller we can see in the following screenshot that failed logon attempts now generate <em>Audit Failure</em> events (in this case EventID 4771) and that the IPAddress shown matches the host from which the logon attempt was made:
<div id="attachment_3913" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-3921"><div class="lb-album"><a href="#image-3921"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2014/02/08-dc-event-logon-failure-300x225.png" alt="View the Domain event log to verify an ' class="size-medium wp-image-3913"><span></span></a></div>              
<a href="#imageclose-3921" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-3921">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2014/02/08-dc-event-logon-failure.png" alt="image-3921">
                   </div></a><p class="wp-caption-text">Figure 7. Confirming a failed logon generates an event</p></div></li>
</ul>
<p>Ok. That&#8217;s the Domain Controller logging configured. Now we need a method of parsing the event log to detect failed logon attempts&#8230;</p>
<h2>Parsing the event logs</h2>
<p>PowerShell has a cmdlet called get-WinEvent that allows us to filter out all events with a specific EventId within a given timespan.</p>
<pre class="brush: powershell; title: ; notranslate">
$events = get-winevent -EA silentlycontinue -filterhashtable @{LogName='Security';id=4771; `
starttime=(Get-Date).AddHours(-1);endtime=(Get-Date) }
</pre>
<p>Note: The backtick at the end of the first line is PowerShell&#8217;s multiline indicator and is required.</p>
<p>By running the above PowerShell command we get all events from the Security log with an ID value of 4771 from the past hour. If we wanted to change the timespan we could replace AddHours(-1) with AddMinutes(-30) for the last 30 minutes, or AddDays(-1) for the last 24 hours. Those events will be accessed via the $events variable.</p>
<p>If we want to check additional EventIds we simply add extra calls to get-WinEvent like so:</p>
<pre class="brush: powershell; title: ; notranslate">
$events += get-winevent -EA silentlycontinue -filterhashtable @{LogName='Security';id=1234; `
starttime=(Get-Date).AddHours(-1);endtime=(Get-Date) }
</pre>
<p>Note the use of += to append the extra events.</p>
<p>We specify the parameter <em>-EA silentlycontinue</em> to avoid error messages if there are no events returned.</p>
<p>Of course some of those events might well be innocent users who mis-typed their password. Someone performing a horizontal password guessing attack against Active Directory users will be running that attack from a single host on the network (E.g. an IP address). Or several hosts might be being used, each testing a sub-set of user accounts and/or passwords. We want to identify any IP address that failed to logon more than a specified number of times within our timespan.</p>
<p>In order to obtain information from the event entry message we need to convert the event to XML so that we can parse it. We will make a note of each IP address that generated the failed logon event by looping through each event (remember we filtered only those events we are interested in) and increment a counter specific for each unique IP address we encounter.</p>
<p>Once we have counted each failed logon attempt originating from all the source IPs referenced in the log event we simply report on any IP where the counted value exceeds our specified threshold value by sending an email alert.</p>
<h2>The complete script</h2>
<p>The following PowerShell script implements the complete process:</p>
<pre class="brush: powershell; title: ; notranslate">
# Script: detect-horizontal-user-brute-froce-attack.ps1
# Author: Richard Hatch, 2014 - RGH@Portcullis-Security.com

# Number of failed logons within the defined time span
# Total events -gt this value will trick the response action
$threshold = 4

#The email server to use when sending alerts
$EmailServer = &quot;127.0.0.1&quot;

#The email address to send from
$mail_domainSrc = &quot;alerts@mydomain.com&quot;

#clean-up any data from a previous run
Remove-Variable events

#get the events from the local system. RUN ON DC (or central log server)
$events = get-winevent -EA silentlycontinue -filterhashtable @{LogName='Security';id=4771; `
starttime=(Get-Date).AddHours(-1);endtime=(Get-Date)  }

# Copy the following line for each required ID value (and update the ID param!)

# $events += get-winevent -EA silentlycontinue -filterhashtable @{LogName='Security'; `
#id=4771;starttime=(Get-Date).AddHours(-1);endtime=(Get-Date) }

#declare our data hash
$scares = @{}

#process each event
ForEach ($evt in $events)
{
	#convert the event data to xml so we can get items
	$evtxml =
1
$evt.ToXML() $curTargetUserName = &quot;&quot; $curServiceName = &quot;&quot; $curIPAddress = &quot;&quot; $curEventTime = $evtxml.Event.System.TimeCreated.SystemTime #need to loop through each 'data' properties for ($i=0; $i -lt $evtxml.Event.EventData.childNodes.count; $i++) { if ($evtxml.Event.EventData.Data[$i].name -eq &quot;IpAddress&quot;) { $curIPAddress = $evtxml.Event.EventData.Data[$i].'#text' } } #end for ($i=0; $i -lt $evtxml.Event.EventData.count; $i++) #If we have never seen this IP failing to logon create a new entry # #Without this check the code attempts to repeatedly create the #same hash entry, causing an error. if (!($scares.ContainsKey($curIPAddress))) { $scares.Add($curIPAddress, 0); #init to 0 } #count this failed logon attempt $scares[&quot;$curIPAddress&quot;] += 1 } #end ForEach ($evt in $events) $scares.GetEnumerator() | % { if ( $($_.value) -gt $threshold ) { $attackerIP = $($_.key) $attackerFailedTimes = $($_.value) Write-Host &quot;[!] IP: $($_.key) failed to login $($_.value) times in the last hour&quot; #$mail_domainSrc = [string]([adsi]'').distinguishedName $mail_subject = &quot;ALERT ${mail_domainSrc}: Host $($_.key) may be attacking ActiveDirectory user accounts&quot; $mail_body = &quot; ALERT! A possible brute-force password guessing attack detected within the last hour from the host with the IP $attackerIP. Failed logon count was $attackerFailedTimes $mail_domainSrc &quot; Send-MailMessage -To ITSecurity@mydomain.com -From $mail_domainSrc ` -Subject $mail_subject -Body $mail_body -SmtpServer $EmailServer ` -Priority High } #end if ( $($_.value) -gt $threshold ) } #end $scares.GetEnumerator() | % {
</pre>
<p>The PowerShell script will diplay information to the PowerShell Console (if visible) and send an email, in this case to ITSecurity@mydomain.com from alerts@mydomain.com, using the <em>Send-MailMessage</em> cmdlet.</p>
<p>We can test the script with the following command:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
c:\&gt; powershell -File Detect-horizontal-user-brute-force-attack.ps1
[!] IP: ::ffff:10.1.2.3 failed to login 6 times in the last hour
</pre>
<p>Note: You may need to first enable external scripting within PowerShell:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
PS&gt; Set-ExecutionPolicy unrestricted
</pre>
<p>For a more secure configuration of PowerShell you can specify <em>Signed</em> instead of <em>Unrestricted</em>. More details on this can be found on Microsoft&#8217;s web site.</p>
<h2>Running the script automatically</h2>
<p>Now we need a method of running the script on the Domain Controller each hour. We can use the task scheduler (as an Administrator):</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
c:\&gt; schtasks /create /tn AD_PwdGuess_Alerter /tr &quot;powershell -NoLogo -WindowStyle hidden -File detect-horizontal-user-brute-force-attack.ps1 /sc hour /mo 1 /ru &quot;NT AUTHORITY\LOCALSERVICE&quot;
</pre>
<p>Once we create the scheduled task we need to start it:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
c:\&gt; schtasks /run /tn AD_PwdGuess_Alerter
</pre>
<p>Note: For extra security you should create a service account with the minimum privileges required to access the event log and send Emails, and specify that account in the /ru parameter, in place of NT AUTHORITY\LOCALSERVICE.</p>
<p>And that&#8217;s it. You may want to tweak the time period settings and the $mail_domainSr value, and the email settings will need to be updated.</p>
<p>This solution can also be used to cover password attacks on local user accounts through the use of Centralised Event Logging. Also see the National Security Agency&#8217;s (NSA) <a title="detailed paper" href="http://www.nsa.gov/ia/_files\app/Spotting_the_Adversary_with_Windows_Event_Log_Monitoring.pdf">detailed paper</a> on configuring centralised event logging.</p>
<div class="wpfilebase-file-default" onclick="if('undefined' == typeof event.target.href) document.getElementById('wpfb-file-link-1').click();">
  <div class="icon"><a href="https://labs.portcullis.co.uk/download/detect-horizontal-user-brute-force-attack.zip" target="_blank" title="Download Detect-horizontal-user-brute-force-attack"><img align="middle" src="https://labs.portcullis.co.uk/wp-includes/images/crystal/archive.png" alt="Detect-horizontal-user-brute-force-attack" /></a></div>
  <div class="filetitle">
    <a href="https://labs.portcullis.co.uk/download/detect-horizontal-user-brute-force-attack.zip" title="Download detect-horizontal-user-brute-force-attack.zip" target="_blank" id="wpfb-file-link-1">detect-horizontal-user-brute-force-attack.zip</a>
    
    <br />
    February 25, 2014<br />
    
  </div>
  <div class="info">
    1.8 KiB<br />
    MD5 hash: 08629677479f0cfd01b9fe960b632949 <br />
    <a href="#" onclick="return wpfilebase_filedetails(1);">Details</a>
  </div>
  <div class="details" id="wpfilebase-filedetails1" style="display: none;">
  
  <table border="0">
   
   
   
   
   
   
   <tr><td><strong>Date:</strong></td><td>February 25, 2014</td></tr>
  </table>
  </div>
 <div style="clear: both;"></div>
</div>
<p>The post <a href="https://labs.portcullis.co.uk/blog/detecting-windows-horizontal-password-guessing-attacks-in-near-real-time/">Detecting windows horizontal password guessing attacks in near real-time</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://labs.portcullis.co.uk/blog/detecting-windows-horizontal-password-guessing-attacks-in-near-real-time/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Investigating the TimeLive application</title>
		<link>https://labs.portcullis.co.uk/blog/investigating-the-timelive-application/</link>
		<comments>https://labs.portcullis.co.uk/blog/investigating-the-timelive-application/#comments</comments>
		<pubDate>Fri, 04 Apr 2014 12:13:07 +0000</pubDate>
		<dc:creator><![CDATA[RGH]]></dc:creator>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[analysis]]></category>
		<category><![CDATA[CVE-2014-1217]]></category>
		<category><![CDATA[CVE-2014-2042]]></category>
		<category><![CDATA[exploit]]></category>
		<category><![CDATA[TimeLive]]></category>

		<guid isPermaLink="false">https://labs.portcullis.co.uk/?p=3493</guid>
		<description><![CDATA[<p>Some time ago I was on an internal infrastructure pentest job where I found a web server that hosted the TimeLive application. I had never heard of this application, and since I was looking at a login page, I opened a browser to my favourite search engine. The following is a brief explanation of things [&#8230;]</p><p>The post <a href="https://labs.portcullis.co.uk/blog/investigating-the-timelive-application/">Investigating the TimeLive application</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Some time ago I was on an internal infrastructure pentest job where I found a web server that hosted the TimeLive application. I had never heard of this application, and since I was looking at a login page, I opened a browser to my favourite search engine. The following is a brief explanation of things that I shouldn&#8217;t have found.<span id="more-3493"></span></p>
<p>According to the vendor web site (<a href="http://www.livetecs.com/" title="http://www.livetecs.com/">http://www.livetecs.com/</a>): &#8220;TimeLive Web timesheet suite is an integrated suite for time record, time tracking and time billing software.&#8221;</p>
<p>My local default password list did not have an entry for this software so my next search query was to look for default credentials.  Sadly I didn&#8217;t find any, but I did find a reference (and a handy screen shot, shown below) that referred to the URI /home/systemsetting.aspx. </p>
<div id="attachment_3500" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-3494"><div class="lb-album"><a href="#image-3494"><img src="https://labs.portcullis.co.uk/wp-content/uploads/2014/02/System_Settings-300x145.jpg" alt="/home/systemsetting.aspx" class="size-medium wp-image-3500"><span></span></a></div>              
<a href="#imageclose-3494" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-3494">
                   <img src="https://labs.portcullis.co.uk/wp-content/uploads/2014/02/System_Settings.jpg" alt="image-3494">
                   </div></a><p class="wp-caption-text">/home/systemsetting.aspx</p></div>
<p>A close look at the screenshot showed a database connection string so I thought I would check the server&#8230;</p>
<p>I was able to access the URI without any authentication and was presented with a page that looked very similar to the screen shot. In fact the only difference I noticed was the database connection string. Time to fire up a database tool&#8230;</p>
<p>So those credentials worked &#8211; I really shouldn&#8217;t be able to access that information! There is a tick-box on the page to encrypt the connection string but the default is clearly to not have that enabled.</p>
<p>A closer look at the page showed me two text input boxes to specify (and confirm) the System Admin password. There was no box to provide the current System Admin password(!).</p>
<p>There were also some fields relating to the SMTP settings.</p>
<p>Without knowing anything about how the client used that service I decided it was probably not a good idea to play with the settings so I went to tell the client contact about the database connection string issue. The only way he was able to lockdown access to that page was by altering the filesystem Access Control Lists (ACLs) for the file systemsetting.aspx. The application had no method for restricting access. The contact also stated that the password change functionality would have worked.</p>
<p>After I had finished the pentest job and the report was completed I thought I would check the latest version of TimeLive to see if the database connection string issue was still present.</p>
<p>I downloaded a trial version and installed it into a Windows virtual machine. This version was several releases newer than the one I had seen so I wasn&#8217;t optimistic. However the same URI gave me the database connection string but wait&#8230;what&#8217;s this?</p>
<p>The TimeLive application bundles it&#8217;s own MS-SQL database environment and a default install uses the sa account. I connected to the database (reading the connection details from the web page) and confirmed that I could access xp_cmdshell. I (command)-promptly ran whoami and found that yes, I was SYSTEM on the host.</p>
<p>I remembered what my client contact had set about having to modify the underlying Operating System (OS) file ACL permissions to prevent access, so I had a look at the ACLs on several application files. Any local user logged into the host had full permissions on all files belonging to the application, with the exception of the actual database files (which are created by the database engine). Within one of those files I found the database connection string displayed in the web browser, so configuring the web server to block access to /home/systemsetting.aspx would not prevent local host users from being able to elevate their privileges. </p>
<p>I had a quick play with the options offered by systemsettings.aspx and was able to make changes without being logged in. These settings included an email address (presumably where system alerts are sent) and the authentication options for the application. Looks like it can hook into Active Directory (either Microsoft&#8217;s or OpenLDAP), so a bad guy could either specify a non-existent login server (to cause a Denial of Service condition), or presumably set up their own that replies to all logins as OK, while capturing those usernames and passwords for later use.</p>
<p>As an added bonus, the application defaults to HTTP and not HTTPS, meaning that any data transmitted over the network between clients and the server is not encrypted.</p>
<p>As I was browsing the application files I noticed the word upload. I though &#8220;that&#8217;s worth a quick look&#8221; <img src="https://labs.portcullis.co.uk/wp-includes/images/smilies/icon_wink.gif" alt=";-)" class="wp-smiley" /> </p>
<p>I thought I would look for horizontal privilege escalation so I created two different low-level user accounts to see if user1 could access files from user2. Not being familiar with the application I had to play around with the application before I found where a user could upload files. </p>
<p>After uploading a test file (there was no limitation on file types as the upload feature was for generic project resources) I searched for the file on the file system and checked the ACL settings. Thanks to inherited permissions, uploaded files had &#8220;Read and Execute&#8221; enabled.</p>
<p>I found that it was possible to upload a .aspx file (as a low-level user) that included VisualBasic code to run calc.exe. When I browsed to the uploaded file, it happily ran it, running under the NETWORK_SERVICE account (which is what the web server was configured to use for applications). It turns out that you don&#8217;t need to be logged into the application to access that page, so if a user uploads a maliciously crafted file (by being tricked by an attacker, via malware or by that user being malicious) an unauthenticated attacker simply needs to browse to that content to trigger the coded behaviour.</p>
<p>As a result of this, a security advisory was sent to the vendor, and the following CVEs assigned:</p>
<p>* CVE-2014-1217<br />
* CVE-2014-2042</p>
<p>The moral of this story is that it is important to examine the properties of files installed by an application, as well as the configuration settings used by default. A quick Internet search for the application name and terms like default password or configuration might reveal some interesting results and so is also worth doing.</p>
<p>The post <a href="https://labs.portcullis.co.uk/blog/investigating-the-timelive-application/">Investigating the TimeLive application</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://labs.portcullis.co.uk/blog/investigating-the-timelive-application/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>winlanfoe</title>
		<link>https://labs.portcullis.co.uk/tools/winlanfoe/</link>
		<comments>https://labs.portcullis.co.uk/tools/winlanfoe/#comments</comments>
		<pubDate>Thu, 24 Oct 2013 06:54:11 +0000</pubDate>
		<dc:creator><![CDATA[RGH]]></dc:creator>
				<category><![CDATA[Tools]]></category>

		<guid isPermaLink="false">https://labs.portcullis.co.uk/?p=2073</guid>
		<description><![CDATA[<p>Winlanfoe is a tool that parses the output from enum4linux and displays Domain/Workgroup membership, IP address, Operating System (OS) information and if a host is a domain controller. It is intended to provide an overview of the Samba network structure as reported by enum4linux. The name is derived from &#8220;Windows LAN Info&#8221; The auto-find mode [&#8230;]</p><p>The post <a href="https://labs.portcullis.co.uk/tools/winlanfoe/">winlanfoe</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>Winlanfoe is a tool that parses the output from <a title="enum4linux" href="/tools/enum4linux/">enum4linux</a> and displays Domain/Workgroup membership, IP address, Operating System (OS) information and if a host is a domain controller. It is intended to provide an overview of the Samba network structure as reported by enum4linux.<span id="more-2073"></span></p>
<p>The name is derived from &#8220;Windows LAN Info&#8221;</p>
<p>The auto-find mode (-f parameter) uses the results from the command:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ find | grep -i enum4linux
</pre>
<h2>Dependencies</h2>
<p>winlanfoe is a simple Perl script that uses one module from CPAN (which is typically installed by default).</p>
<p>Run &#8216;cpan&#8217; as root then install the File::Basename module:</p>
<pre class="brush: bash; gutter: false; title: ; notranslate">
# cpan
cpan[1]#&gt; install File::Basename
</pre>
<h2>Example output 1: Usage information</h2>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ winlanfoe.pl
winlanfoe.pl v0.4 (https://labs.portcullis.co.uk/application/winlanfoe/)
Copyright (C) 2012 Richard Hatch (rgh@portcullis-security.com)

Parses enum4linux output for Windows for hostname, workgroup/domain, domain-member, OS.

Usage:
 ./winlanfoe.pl enum4linux-10.0.0.1.out [ enum4linux-10.0.0.2.out ]
or
 ./winlanfoe.pl -f   # To search the current directory tree for enum4linux files
</pre>
<h2>Example output 2: A single Windows 2008 R2 SP1 host</h2>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ winlanfoe.pl w2008r2-enum4linux.out
winlanfoe.pl v0.4 (https://labs.portcullis.co.uk/application/winlanfoe/)
Copyright (C) 2012 Richard Hatch (rgh@portcullis-security.com)

Note: OS Version is taken from enum4linux. You might get more precise results with:
# msfcli auxiliary/scanner/smb/smb_version RHOSTS=1.2.3.4 e, or examining nessus output

Domain: CORP, Hostname: W2008R2DC, IP: 172.16.1.10, OS: Windows Server 2008 R2 Enterprise 7601 Service Pack 1, Domain Controller
</pre>
<h2>Example output 3: The auto-find results mode</h2>
<pre class="brush: bash; gutter: false; title: ; notranslate">
$ winlanfoe.pl -f
winlanfoe.pl v0.4 (https://labs.portcullis.co.uk/application/winlanfoe/)
Copyright (C) 2012 Richard Hatch (rgh@portcullis-security.com)

Note: OS Version is taken from enum4linux. You might get more precise results with:
# msfcli auxiliary/scanner/smb/smb_version RHOSTS=1.2.3.4 e, or examining nessus output

Domain: CORP,      Hostname: WIN7ALICE,    IP: 172.16.1.11,  OS: Windows 7 Ultimate 7600,
Domain: CORP,      Hostname: W2008R2DC,    IP: 172.16.1.10,  OS: Windows Server 2008 R2 Enterprise 7601 Service Pack 1, Domain Controller

Wrkgrp: WORKGROUP, Hostname: OFFICEMONKEY, IP: 172.16.1.102, OS: Windows 5.1 (XP),
Wrkgrp: WORKGROUP, Hostname: WIN2K3SP1,    IP: 172.16.1.101, OS: Windows Server 2003 3790 Service Pack 1,
</pre>
<div class="wpfilebase-file-default" onclick="if('undefined' == typeof event.target.href) document.getElementById('wpfb-file-link-2').click();">
  <div class="icon"><a href="https://labs.portcullis.co.uk/download/winlanfoe-0.4.tgz" target="_blank" title="Download Winlanfoe"><img align="middle" src="https://labs.portcullis.co.uk/wp-includes/images/crystal/archive.png" alt="Winlanfoe" /></a></div>
  <div class="filetitle">
    <a href="https://labs.portcullis.co.uk/download/winlanfoe-0.4.tgz" title="Download winlanfoe-0.4.tgz" target="_blank" id="wpfb-file-link-2">winlanfoe-0.4.tgz</a>
    
    <br />
    October 10, 2013<br />
    Version: 0.4<br />
  </div>
  <div class="info">
    11.2 KiB<br />
    MD5 hash: 217be9b7cfa757aa4ad87113781387e3 <br />
    <a href="#" onclick="return wpfilebase_filedetails(2);">Details</a>
  </div>
  <div class="details" id="wpfilebase-filedetails2" style="display: none;">
  
  <table border="0">
   
   
   
   
   
   
   <tr><td><strong>Date:</strong></td><td>October 10, 2013</td></tr>
  </table>
  </div>
 <div style="clear: both;"></div>
</div>
<p>The post <a href="https://labs.portcullis.co.uk/tools/winlanfoe/">winlanfoe</a> appeared first on <a href="https://labs.portcullis.co.uk">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://labs.portcullis.co.uk/tools/winlanfoe/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
	</channel>
</rss>
