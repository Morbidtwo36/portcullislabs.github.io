<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Portcullis Labs &#187; TDR</title>
	<atom:link href="https://portcullislabs.github.io/author/tdr/feed/" rel="self" type="application/rss+xml" />
	<link>https://portcullislabs.github.io</link>
	<description>Research and Development</description>
	<language>en-US</language>
		<sy:updatePeriod>hourly</sy:updatePeriod>
		<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.8.5</generator>
	<item>
		<title>A study in scarlet</title>
		<link>https://portcullislabs.github.io/blog/a-study-in-scarlet/</link>
		<comments>https://portcullislabs.github.io/blog/a-study-in-scarlet/#comments</comments>
		<pubDate>Thu, 20 Jul 2017 12:28:58 +0000</pubDate>
		<dc:creator><![CDATA[TDR]]></dc:creator>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[analysis]]></category>
		<category><![CDATA[blue team]]></category>
		<category><![CDATA[phishing]]></category>
		<category><![CDATA[red team]]></category>

		<guid isPermaLink="false">https://portcullislabs.github.io/?p=5917</guid>
		<description><![CDATA[<p>In the modern age, where computers are used for nearly everything we do, the damage that can be caused to a company by cyber-attacks is substantial, with companies losing millions in regulatory fines, compensation and declining share prices. While some of these breaches have been caused by vulnerabilities within the target company&#8217;s infrastructure/software, a large [&#8230;]</p><p>The post <a href="https://portcullislabs.github.io/blog/a-study-in-scarlet/">A study in scarlet</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></description>
				<content:encoded><![CDATA[<p>In the modern age, where computers are used for nearly everything we do, the damage that can be caused to a company by cyber-attacks is substantial, with companies losing millions in regulatory fines, compensation and declining share prices. While some of these breaches have been caused by vulnerabilities within the target company&#8217;s infrastructure/software, a large quantity of them began with a phishing attack.<span id="more-5917"></span></p>
<p>Generally speaking, phishing is a social engineering technique that involves sending fraudulent emails to individuals in an attempt to coerce them into providing confidential information or network access. Spear phishing is a more targeted form of this, where attackers will target specific individuals within an organisation and use information gathered from publicly available resources, such as social media, to make the malicious emails seem more genuine. This attack technique is very effective, with previous research showing victims being up to 4.5 times more likely to believe the contents of targeted emails. Additionally, targeting specific individuals with more access within an organisation, such as managers or system administrators, gives the attacker a greater chance of finding sensitive information than that provided by standard phishing.</p>
<p>The best defence against phishing attacks is to have employees that are aware of the threat and the methods of identifying them. That being said, it&#8217;s important to support your employees in this effort, minimising risk and the potential for human error, which is why employers should be doing everything they can to ensure that the emails do not reach their targets and, when they do, that they are easy to identify and report. This can be achieved by looking at the cyber kill chain, as documented by Lockheed Martin, and implementing sensible security controls at each of the stages that relate specifically to a phishing attack.</p>
<h2>Delivery</h2>
<p>The first part of the cyber kill chain where we can actively identify these attacks is at the delivery stage &#8211; when a malicious email hits the external mail server of an organisation. The following security controls can be put in place at this stage of an attack to identify and mitigate the majority of phishing attacks.</p>
<h3>Mail content scanning</h3>
<p>The most obvious place to search for indicators of a phishing attempt is the content of the emails themselves. By analysing information gathered about common attacks used by malicious actors, it is possible to identify potential phishing attacks before they reach the intended target. The contents of these emails can then be modified to make it easier for users to identify them.</p>
<p>As attackers use phishing as a method of gaining unauthorised access to systems or data, a common attack vector is to include a hyperlink to a web application that they control. Modern mail clients capable of rendering HTML emails make this attack method even more effective, as attackers are able to change the text that is displayed to the user in place of the hyperlink. To help the user identify the threat and limit the risk of this method of attack, hyperlinks should be rewritten to display to the user where their browser will take them if they click on the link.</p>
<p>As phishing attempts will generally come from a network location external to their intended targets, another very simple but effective method of improving a user&#8217;s likelihood of identifying a phishing attack is the addition of a warning to the email, stating that it is from an external user. Users seeing that emails have come from an external location are much more likely to exercise caution when following hyperlinks.</p>
<h3>Attachments</h3>
<p>Malicious attachments sent via phishing email are a very real and dangerous threat as, at worst, they could allow an attacker to bypass all external protections and provide them with direct access to a company&#8217;s internal network. The most secure method to avoid the risk of this threat would be to block all email attachments coming into a company, however, for the majority of businesses this is not practical and would severely limit their ability to communicate with clients/third-parties. The following security controls can help to mitigate the potential damage that could be caused by malicious attachments:</p>
<ul>
<li>File rewrite &#8211; a number of security solutions on the market are able to convert files into a safe format, for example, rewriting a Microsoft Docx file into a PDF so that no Macros can be executed</li>
<li>Moderator review &#8211; One very effective method of mitigating this threat is to hold all emails from external addresses that contain attachments in a quarantine system until they have undergone administrator review. This will allow them to examine the contents of the emails to determine whether or not they are malicious</li>
<li>Password protected attachments &#8211; As security solutions have no feasible way of decrypting password protected files, there is no way of automatically validating the whether or not their content is malicious. Due to this, it is important to make sure they are either blocked from entering your organisation or, if there is a business requirement for such attachments, at a minimum they should undergo sandboxing or moderator review</li>
</ul>
<h3>Domain names</h3>
<p>A common attack technique used to trick users into providing sensitive information is to use a domain that is close to a company&#8217;s legitimate domain. In order to counter this type of attack, security solutions can be employed to review how similar a sending domain is to the company&#8217;s legitimate domain, blocking emails from all domains that are above a certain level of similarity.</p>
<p>Another attack technique that has been discussed a large amount recently is the use of Internationalised Domain Names (IDN). IDNs are domain names that contain at least one character that is not within the normal ASCII character set. In order to facilitate this, domains can be registered as specially formatted ASCII strings, which are preceded by the characters &#8220;xn--&#8221;. This representation is what is actually registered with domain providers and is called Punycode. Using IDNs, attackers can register domains that look very similar to legitimate sites by changing ASCII characters for Unicode characters (e.g. www.go√≥gle.com could be registered using the Punycode www.xn--gogle-1ta.com). As these IDN domains are actually registered using the Punycode for the domain name, mitigating the threat of this attack technique can be achieved by blocking all domain names that begin with the characters &#8220;xn--&#8221;.</p>
<p>A further way of using a domain to identify malicious activity is to analyse what it appears to be used for. A number of security solutions on the market assign categories to domains, usually based on analysis of the services running on the systems (e.g. the content that is hosted on a web server). Using these solutions, it is also possible to report domains that have been identified as being used in phishing or other malicious activities. As the majority of these solutions operate using a cloud based central server, once a domain has been marked as malicious it will be impractical for attackers to use it in further attacks. Additionally, as attackers are unlikely to want to have their personal details registered to accounts for use in these services, it is likely that they will be unable to have their domains categorised when they set up their phishing. Blocking emails from domains that are not yet categorised can be just as effective at ensuring that phishing attempts do not reach their target.</p>
<h3>Email validation</h3>
<p>The wide range of open source software available to us makes it simple to set up and use a mail server for a domain of our choosing. This, however, provides attackers with the opportunity to send emails as if they were coming from a legitimate site &#8211; name@yourcompanynamehere.com for example. A number of technologies are available that will help to ensure that attackers are not able to spoof emails in this way:</p>
<ul>
<li>Sender Policy Framework (SPF) &#8211; SPF is an email validation system which allows domain administrators to define the hosts that are allowed to send emails for their domain, through the use of a specially formatted DNS TXT record:</li>
</ul>
<div id="attachment_5920" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-5918"><div class="lb-album"><a href="#image-5918"><img src="https://portcullislabs.github.io/wp-content/uploads/2017/07/SPF-300x90.jpg" alt="An example SPF record entry" class="size-medium wp-image-5920"><span></span></a></div>              
<a href="#imageclose-5918" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-5918">
                   <img src="https://portcullislabs.github.io/wp-content/uploads/2017/07/SPF.jpg" alt="image-5918">
                   </div></a><p class="wp-caption-text">An example SPF record entry</p></div>
<ul>
<li>Domain Keys Identified Mail (DKIM) &#8211; DKIM also uses a specially formatted DNS TXT record to validate the sender of an email, through the use of public/private key cryptography. The sending mail server adds a digital signature to outgoing emails, which can be verified using a public key that is published within the DNS record. This email validation method also provides data integrity for the emails, as any alterations made in transit will affect the validation of the digital signature.</li>
</ul>
<div id="attachment_5921" style="width: 310px" class="wp-caption alignnone"><a name="imageclose-5919"><div class="lb-album"><a href="#image-5919"><img src="https://portcullislabs.github.io/wp-content/uploads/2017/07/DKIM-1-300x69.jpg" alt="An example DKIM signature in an email header" class="size-medium wp-image-5921"><span></span></a></div>              
<a href="#imageclose-5919" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-5919">
                   <img src="https://portcullislabs.github.io/wp-content/uploads/2017/07/DKIM-1.jpg" alt="image-5919">
                   </div></a><p class="wp-caption-text">An example DKIM signature in an email header</p></div>
<ul>
<li>Domain-based Message Authentication, Reporting and Conformance (DMARC) &#8211; DMARC takes the 2 validation systems defined above and builds on them to create a much more robust system. It allows domain administrators to define which validation systems are to be used by mail servers for the domain (either SPF, DKIM or both) and how mail servers should handle emails that do not pass the validation process.</li>
</ul>
<p>By utilising these security controls and ensuring that our receiving mail server is checking the DNS records against the information in emails, we are able to ensure that attackers are unable to spoof emails from legitimate domains.</p>
<h3>Malicious email reporting</h3>
<p>If a malicious email does manage to get through all of the security controls at the perimeter, it is likely that at least some of their intended targets will fall for the scam. With that in mind, it is important that users have a method of notifying the people responsible for the security of your organisation that a malicious email has slipped through the net. Multiple solutions for this are available, such as the creation of a plugin for the company mail client or a mailing list that is used to report malicious emails. In tandem to this, policies and procedures should be put into place, which detail the process administrators and security staff should follow to inform employees that there is a phishing attack underway and how to identify it.</p>
<div id="attachment_5922" style="width: 231px" class="wp-caption alignnone"><a name="imageclose-5920"><div class="lb-album"><a href="#image-5920"><img src="https://portcullislabs.github.io/wp-content/uploads/2017/07/DKIM-2.jpg" alt="Mail client plugin" class="size-full wp-image-5922"><span></span></a></div>              
<a href="#imageclose-5920" class="css3lightbox-close">
				   <div class="lb-overlay" id="image-5920">
                   <img src="https://portcullislabs.github.io/wp-content/uploads/2017/07/DKIM-2.jpg" alt="image-5920">
                   </div></a><p class="wp-caption-text">Mail client plugin</p></div>
<h2>Exploitation, installation and command &amp; control</h2>
<p>A number of security controls can be used to mitigate the threat of phishing attacks across the next 3 stages of the cyber kill chain &#8211; Exploitation, Installation and Command &amp; Control. If an attack has managed to progress this far along the cyber kill chain it is imperative that it is identified and stopped to ensure that the attacker is not able to gain a foothold on an internal network.</p>
<h3>End point protection</h3>
<p>The most obvious method of blocking malicious applications from running on a target user&#8217;s system is to install an End Point Protection application. There are a number of options for this on the market, each of them able to detect and protect against millions of variants of malware and other unwanted applications. These products can help to stop an attack at either the Exploitation or Installation stages of the cyber kill chain by identifying and blocking malicious files/activity.</p>
<h3>Outbound proxies</h3>
<p>A common method of attack used in phishing attempts is to provide a link within the email that, when followed, will display a page asking for credentials or other sensitive information. In order to stop attackers using this technique, a network proxy can be used to block traffic to unknown domains. One possible solution to this issue is to only allow access to the top ranked sites, however, for some organisations this may not be practical. In situations such as this, a moderator/administrator should review any unknown domains to ensure that they are not malicious.</p>
<p>In addition to mitigating the threat of users disclosing sensitive information, these solutions can help to break the cyber kill chain at the installation and command &amp; control (C2) stages, by stopping malware from using HTTP connections to unknown domains to download Remote Access Tools (RATs) or as a C2 channel.</p>
<h3>Sandboxing</h3>
<p>Sandboxing is the practice of using a system that is not connected to the live network (usually a virtual machine) to test files for malicious activity. As most attachments used in phishing attacks will have similar behaviour (e.g. connecting back to a command &amp; control node) after being opened, sandboxing can be used to identify them within a safe environment to ensure that no live systems are affected. By using sandboxing technologies we can analyse the behaviour of files against indicators of malicious activity at all three of the stages of the kill chain.</p>
<h2>Threat intelligence</h2>
<p>While having all of the security solutions described above can help to identify and mitigate the threat of phishing attacks, the individuals behind the attacks are always developing and adapting their methodologies. Taking this into account, it is of utmost importance that the indicators of attack that we are looking for evolve with them. By feeding any information gathered from previous attacks into cloud-based threat intelligence platforms, the security community&#8217;s understanding of how attackers are operating will grow, which will in turn improve our ability to stop them.</p>
<h2>Summary</h2>
<p>While the threat of phishing attacks and the damage they can do is significant, both financially and to a company&#8217;s reputation, by looking at the timeline of these attacks it is possible to identify many security controls that can be used to mitigate them. By utilising these controls, through a defence-in-depth approach to security, we are able to limit the number of malicious emails that reach their targeted users. Furthermore, by using information about recognised indicators of attack, we are able to alter the contents of emails to assist users in the identification of emails and content that could potentially cause a security breach.</p>
<p>The post <a href="https://portcullislabs.github.io/blog/a-study-in-scarlet/">A study in scarlet</a> appeared first on <a href="https://portcullislabs.github.io">Portcullis Labs</a>.</p>]]></content:encoded>
			<wfw:commentRss>https://portcullislabs.github.io/blog/a-study-in-scarlet/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
	</channel>
</rss>
